/* slave version: 2.13.0.5362.b41c71a4 Tue Oct 29 2019 12:46:22 */

new function a(){"use strict";var e,t,r,o,u,c,s,n,i,l,h,d,f,p,v,_,g,m,y,E,b,T,S,M,w,C,k,F,D,R,P,L,O,N,A,U,x,I,B,W,H,Q,j,K,q,V,Y,X,G,z,Z,J,$,ee,te,ne,ie,se,re,oe,ae,ue,ce,le,he,de,fe,pe,ve,_e,ge,me,ye,Ee,be,Te,Se,Me,we,Ce,ke,Fe,De,Re,Pe,Le,Oe,Ne,Ae,Ue,xe,Ie,Be,We,He,Qe,je,Ke,qe,Ve,Ye=this,Xe=(function $e(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(i===undefined){var s=Object.getPrototypeOf(e);return null===s?undefined:$e(s,t,n)}if("value"in i)return i.value;var r=i.get;return r===undefined?undefined:r.call(n)},function(){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}}()),Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function ze(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function Ze(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function Je(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e=self,t=Date.now?Date.now():+new Date,r=e.performance||{},o=[],u={},c=function c(e,t){for(var n=0,i=o.length,s=[];n<i;n++)o[n][e]==t&&s.push(o[n]);return s},s=function s(e,t){for(var n,i=o.length;i--;)(n=o[i]).entryType!=e||void 0!==t&&n.name!=t||o.splice(i,1)},r.now||(r.now=r.webkitNow||r.mozNow||r.msNow||function(){return(Date.now?Date.now():+new Date)-t}),r.mark||(r.mark=r.webkitMark||function(e){var t={name:e,entryType:"mark",startTime:r.now(),duration:0};o.push(t),u[e]=t}),r.measure||(r.measure=r.webkitMeasure||function(e,t,n){var i,s;if(n!==undefined&&u[n]===undefined)throw new SyntaxError("Failed to execute 'measure' on 'Performance': The mark '"+n+"' does not exist.");if(t!==undefined&&u[t]===undefined)throw new SyntaxError("Failed to execute 'measure' on 'Performance': The mark '"+t+"' does not exist.");i=u[t]?u[t].startTime:0,s=u[n]?u[n].startTime:r.now(),o.push({name:e,entryType:"measure",startTime:i,duration:s-i})}),r.getEntriesByType||(r.getEntriesByType=r.webkitGetEntriesByType||function(e){return c("entryType",e)}),r.getEntriesByName||(r.getEntriesByName=r.webkitGetEntriesByName||function(e){return c("name",e)}),r.clearMarks||(r.clearMarks=r.webkitClearMarks||function(e){s("mark",e)}),r.clearMeasures||(r.clearMeasures=r.webkitClearMeasures||function(e){s("measure",e)}),e.performance=r,"function"==typeof define&&(define.amd||define.ajs)&&define("performance",[],function(){return r}),function(e){if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}),!Object.defineProperty||!function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}()){var s=Object.defineProperty;Object.defineProperty=function(e,t,n){if(s)try{return s(e,t,n)}catch(i){}if(e!==Object(e))throw TypeError("Object.defineProperty called on non-object");return Object.prototype.__defineGetter__&&"get"in n&&Object.prototype.__defineGetter__.call(e,t,n.get),Object.prototype.__defineSetter__&&"set"in n&&Object.prototype.__defineSetter__.call(e,t,n.set),"value"in n&&(e[t]=n.value),e}}var t,u,n,i,c;"function"!=typeof Object.defineProperties&&(Object.defineProperties=function(e,t){if(e!==Object(e))throw TypeError("Object.defineProperties called on non-object");var n;for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&Object.defineProperty(e,n,t[n]);return e}),"function"!=typeof Object.create&&(Object.create=function(e,t){if("object"!==("undefined"==typeof e?"undefined":Ge(e)))throw TypeError();function n(){}n.prototype=e;var i=new n;if(e&&(i.constructor=n),t!==undefined){if(t!==Object(t))throw TypeError();Object.defineProperties(i,t)}return i}),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw TypeError("Object.keys called on non-object");var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push(t);return n}),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var n,i;if(null==this)throw new TypeError(" this is null or not defined");var s=Object(this),r=s.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(1<arguments.length&&(n=t),i=0;i<r;){var o;i in s&&(o=s[i],e.call(n,o,i,s)),i++}}),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw TypeError("Bind must be called on a function");var t=[].slice,n=t.call(arguments,1),i=this,s=function s(){return i.apply(this.prototype&&this instanceof r?this:e,n.concat(t.call(arguments)))};function r(){}return r.prototype=i.prototype,s.prototype=new r,s}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Array.from||(Array.from=(t=Object.prototype.toString,u=function u(e){return"function"==typeof e||"[object Function]"===t.call(e)},n=function n(e){var t=Number(e);return isNaN(t)?0:0!==t&&isFinite(t)?(0<t?1:-1)*Math.floor(Math.abs(t)):t},i=Math.pow(2,53)-1,c=function c(e){var t=n(e);return Math.min(Math.max(t,0),i)},function(e){var t=Object(e);if(null==e)throw new TypeError("Array.from requires an array-like object - not null or undefined");var n,i=1<arguments.length?arguments[1]:void undefined;if("undefined"!=typeof i){if(!u(i))throw new TypeError("Array.from: when provided, the second argument must be a function");2<arguments.length&&(n=arguments[2])}for(var s,r=c(t.length),o=u(this)?Object(new this(r)):new Array(r),a=0;a<r;)s=t[a],o[a]=i?"undefined"==typeof n?i(s,a):i.call(n,s,a):s,a+=1;return o.length=r,o})),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null==this)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var i=arguments[1],s=0;s<n;){var r=t[s];if(e.call(i,r,s,t))return r;s++}return undefined},configurable:!0,writable:!0}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(e,t){if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),i=n.length>>>0;if(0===i)return!1;for(var s,r,o=0|t,a=Math.max(0<=o?o:i-Math.abs(o),0);a<i;){if((s=n[a])===(r=e)||"number"==typeof s&&"number"==typeof r&&isNaN(s)&&isNaN(r))return!0;a++}return!1}}),Element.prototype.matches||(Element.prototype.matches=Element.prototype.matchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||Element.prototype.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),i=1;i<arguments.length;i++){var s=arguments[i];if(null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(n[r]=s[r])}return n},writable:!0,configurable:!0}),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),self.MutationObserver=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver}(),function(e){if(!e.WeakMap){var s=Object.prototype.hasOwnProperty,r=function r(e,t,n){Object.defineProperty?Object.defineProperty(e,t,{configurable:!0,writable:!0,value:n}):e[t]=n};e.WeakMap=function(){function e(){if(void 0===this)throw new TypeError("Constructor WeakMap requires 'new'");if(r(this,"_id",function t(e){return e+"_"+n()+"."+n()}("_WeakMap")),0<arguments.length)throw new TypeError("WeakMap iterable is not supported")}function i(e,t){if(!o(e)||!s.call(e,"_id"))throw new TypeError(t+" method called on incompatible receiver "+("undefined"==typeof e?"undefined":Ge(e)))}function n(){return Math.random().toString().substring(2)}return r(e.prototype,"delete",function(e){if(i(this,"delete"),!o(e))return!1;var t=e[this._id];return!(!t||t[0]!==e||(delete e[this._id],0))}),r(e.prototype,"get",function(e){if(i(this,"get"),o(e)){var t=e[this._id];return t&&t[0]===e?t[1]:void 0}}),r(e.prototype,"has",function(e){if(i(this,"has"),!o(e))return!1;var t=e[this._id];return!(!t||t[0]!==e)}),r(e.prototype,"set",function(e,t){if(i(this,"set"),!o(e))throw new TypeError("Invalid value used as weak map key");var n=e[this._id];return n&&n[0]===e?n[1]=t:r(e,this._id,[e,t]),this}),r(e,"_polyfill",!0),e}()}function o(e){return Object(e)===e}}("undefined"!=typeof self?self:"undefined"!=typeof window?window:undefined),n=Ye,i=function(){function e(){Je(this,e)}return Xe(e,[{key:"create",value:function(e){var t=["(",e,")()"];if(window.Blob)return new window.Blob(t,{type:"application/javascript"});if(window.MSBlobBuilder){for(var n=new window.MSBlobBuilder,i=0;i<t.length;i++)n.append(t[i]);return n.getBlob("application/javascript")}throw new Error("Unable to create Blob. Neither Blob nor BlobBuilder are supported by the browser.")}}]),e}(),n.BlobFactory=i,l=Ye,h=function(){function e(){Je(this,e)}return Xe(e,[{key:"create",value:function(e){var t=window.URL||window.webkitURL;if(t)return t.createObjectURL(e);throw new Error("Unable to create BlobUrl. Neither Url nor webkitUrl are supported by the browser")}}]),e}(),l.BlobUrlFactory=h,function(e){function t(){this._listeners=[]}e.CDEvent||(t.prototype={subscribe:function(e){this._listeners.push(e)},publish:function(e){for(var t=0,n=this._listeners.length;t<n;t++)this._listeners[t](e)},unsubscribe:function(e){for(var t=0,n=this._listeners.length;t<n;t++)if(e===this._listeners[t]){this._listeners.splice(t,1);break}}},e.CDEvent=t)}(Ye),d=Ye,f=function(){function e(){Je(this,e),this._pairs=[],this.size=0}return Xe(e,[{key:"has",value:function(e){return-1<this._indexOf(e)}},{key:"get",value:function(e){var t=this._indexOf(e);return-1<t?this._pairs[t][1]:undefined}},{key:"set",value:function(e,t){var n=this._indexOf(e);-1<n?this._pairs[n][1]=t:(this._pairs.push([e,t]),this.size++)}},{key:"delete",value:function(e){var t=this._indexOf(e);return-1<t&&(this._pairs.splice(t,1),this.size--,!0)}},{key:"forEach",value:function(e){for(var t=0;t<this._pairs.length;t++)e(this._pairs[t][1],this._pairs[t][0])}},{key:"clear",value:function(){this._pairs=[]}},{key:"_indexOf",value:function(e){for(var t=0;t<this._pairs.length;t++)if(this._pairs[t][0]===e)return t;return-1}}]),e}(),d.Map=self.Map||f,function(e){function t(e,t){this._portNativeWorker=e,this._useShared=t}t.prototype={start:function(){this._useShared&&this._portNativeWorker.port.start()},postMessage:function(){var e=this._portNativeWorker.port;this._useShared?e.postMessage.apply(e,arguments):this._portNativeWorker.postMessage.apply(this._portNativeWorker,arguments)},close:function(){this._useShared?this._portNativeWorker.port.close():this._portNativeWorker.terminate()},setonmessage:function(e){this._useShared?this._portNativeWorker.port.onmessage=e:this._portNativeWorker.onmessage=e}},e.CDPort=t}(Ye),p=Ye,v=function(){function e(){Je(this,e),this._set=[],this.size=0}return Xe(e,[{key:"add",value:function(e){return this._set.push(e),this.size++,this}},{key:"has",value:function(e){return-1<this._set.indexOf(e)}},{key:"delete",value:function(e){for(var t=0;t<this._set.length;t++)if(this._set[t]===e)return this._set.splice(t,1),this.size--,!0;return!1}},{key:"forEach",value:function(e){for(var t=0;t<this._set.length;t++)e(this._set[t])}},{key:"clear",value:function(){this._set=[]}}]),e}(),p.Set=self.Set||v,Ye.DataMappingDefs={ELEMENT_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","length","elementValues","selected","hashedValue","relativeTime"],ELEMENT_MAP:["elementHash","tagName","id","name","type","leftPosition","topPosition","width","height","className","href","title","alt","selectValues","elementValue","checked","timestamp","dataAutomationId"],CLIPBOARD_EVENT_MAP:["eventSequence","timestamp","clipboardEventType","elementHash","copiedText"],KEY_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","charCode","character","keyComboType","isCtrl","isShift","isAlt","isMetaKey","keyLocation","code","key","isRepeat","keyRegion","relativeTime"],MOUSE_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","pageX","pageY","screenX","screenY","button","wheelDelta","clientX","clientY","eventDetail","buttonNew","relativeTime"],WINDOW_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","screenWidth","screenHeight","clientWidth","clientHeight","documentWidth","documentHeight","scrollTop","scrollLeft","windowInnerWidth","windowInnerHeight","windowOuterWidth","windowOuterHeight"],TOUCH_EVENT_MAP:["eventSequence","timestamp","eventType","isTrusted","elementHash","clientX","clientY","touchIndex","touchSizeMajor","touchSizeMinor","pageX","pageY","screenX","screenY","relativeTime"],PINCH_ZOOM_EVENT_MAP:["eventSequence","timestamp","focusX","focusY","scaleFactor"],ACCELEROMETER_EVENT_MAP:["eventSequence","timestamp","x","y","z"],GESTURE_EVENT_MAP:["eventSequence","timestamp","eventType","scale","rotation","pointerType","overallVelocity","direction","pageX","pageY","screenX","screenY","clientX","clientY"],GYRO_EVENT_MAP:["eventSequence","timestamp","absolute","alpha","beta","gamma"],ORIENTATION_EVENT_MAP:["eventSequence","timestamp","absolute","alpha","beta","gamma"],SCRIPT_EVENT_MAP:["eventSequence","timestamp","eventType","scriptId","namespaceURI","outerHTML","scriptSource","scriptType"],SCREEN_ORIENTATION_EVENT_MAP:["eventSequence","timestamp","orientation"],TAP_EVENT_MAP:["eventSequence","timestamp","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],LONGPRESS_EVENT_MAP:["eventSequence","timestamp","screenX","screenY","pageX","pageY","clientX","clientY","isTrusted","elementHash","touchIndex","touchSizeMajor","touchSizeMinor"],TAB_EVENT_MAP:["eventSequence","timestamp","type","id","href","referrer","currentTabsList"],NETINFO_EVENT_MAP:["eventSequence","timestamp","connectionType","effectiveType","downlinkMax","downlink","rtt","isSaveData"],STORAGE_EVENT_MAP:["eventSequence","timestamp","keys","action","tabsOpened"],PRINT_EVENT_MAP:["eventSequence","timestamp","printDialogState"],HISTORY_NAVIGATION_EVENT_MAP:["eventSequence","timestamp","navigationDirection"],AMBIENT_LIGHT_EVENT_MAP:["eventSequence","timestamp","illuminance"],BEFORE_INSTALL_PROMPT_EVENT_MAP:["eventSequence","timestamp","platforms","relativeTime"],CROSS_MUID_EVENT_MAP:["eventSequence","timestamp","eventType","domainUrl","muid"]},_=Ye,g=function(){function n(e,t){Je(this,n),this._cdUtils=e,this._scriptName=t,this._cdUtils.addEventListener(window,"error",this._handleException.bind(this))}return Xe(n,[{key:"_handleException",value:function(e){if(this._scriptName&&this._scriptName===e.filename){var t=this._buildErrorMessage(e);log.error("caught unhandled exception. "+t)}}},{key:"_buildErrorMessage",value:function(e){if(!e.error)return e.message;var t=e.error.toString(),n=e.error.stack?e.error.stack:"";return t+", Line: "+e.lineno+", Column: "+e.colno+". Stacktrace: "+n}}]),n}(),_.GlobalExceptionHandler=g,m=Ye,y=function(){function e(){Je(this,e)}return Xe(e,null,[{key:"create",value:function(){if(self.XMLHttpRequest&&Object.prototype.hasOwnProperty.call(XMLHttpRequest.prototype,"withCredentials"))return new XMLHttpRequest;if(self.XDomainRequest)return new XDomainRequest;if(self.XMLHttpRequest)return new XMLHttpRequest;throw new Error("There is no supported http request object")}}]),e}(),m.HttpRequestFactory=y,E=Ye,b=function(){function t(e){if(Je(this,t),!e)throw new Error("utils param must be defined");this._msgListeners=new E.Map,self.window&&e.addEventListener&&(this._windowId="Window_"+e.generateUUID(),e.addEventListener(self.window,"message",this._onMessageReceived.bind(this),!0))}return Xe(t,[{key:"subscribe",value:function(e,t){var n=2<arguments.length&&arguments[2]!==undefined&&arguments[2],i=null;this._msgListeners.has(e)?i=this._msgListeners.get(e):(i=new E.Set,this._msgListeners.set(e,i)),i.add({callback:t,isOneTime:n})}},{key:"unsubscribe",value:function(e,t){if(e&&this._msgListeners.has(e)){var n=this._msgListeners.get(e);n&&n.forEach(function(e){t===e.callback&&n["delete"](e)}),0===n.size&&this._msgListeners["delete"](e)}}},{key:"publish",value:function(e,t){if(!e)throw new Error("invalid argument msgType must be defined");this._publishMessage(e,t)}},{key:"publishAsync",value:function(e,t){if(!e)throw new Error("invalid argument msgType must be defined");self.window&&self.window.postMessage({msgID:this._windowId,msgType:e,message:t},window.location.href)}},{key:"_publishMessage",value:function(e,t){var n=this._msgListeners.get(e);n&&n.forEach(function(e){e.callback(t),e.isOneTime&&n["delete"](e)})}},{key:"_onMessageReceived",value:function(e){e.data.msgID&&e.data.msgID===this._windowId&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),this._publishMessage(e.data.msgType,e.data.message))}}]),t}(),E.MessageBus=b,Ye.MessageBusEventType={TouchEvent:"touchEvent",KeyEvent:"keyEvent",ConfigurationLoadedEvent:"ConfigurationLoadedEvent",NewSessionStartedEvent:"NewSessionStartedEvent",WupDispatchRateUpdatedEvent:"WupDispatchRateUpdatedEvent",ApiContextChangeEvent:"ApiContextChangeEvent",ApiResetSessionEvent:"ApiResetSessionEvent",ApiCustomerMetadataEvent:"ApiCustomerMetadataEvent",ApiChangeStateEvent:"ApiChangeStateEvent",ApiSetCsidEvent:"ApiSetCsidEvent",ApiSetPsidEvent:"ApiSetPsidEvent",ServerStateUpdatedEvent:"ServerStateUpdatedEvent",StateChangedEvent:"StateChangedEvent"},T=Ye,S=function(){function t(e){Je(this,t),this._perfDataQ=e,this._now=window.performance&&window.performance.now?window.performance.now.bind(window.performance):T.CDUtils.dateNow.bind(Date),this._monitors=new T.Map}return Xe(t,[{key:"startMonitor",value:function(e){log.debug("PerfMonitor:startMonitor on "+e),this._monitors.set(e,this._now())}},{key:"stopMonitor",value:function(e){var t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:"main";if(this._monitors.has(e)){var n=this._now()-this._monitors.get(e);this._perfDataQ.addToQueue("perf",{orig:t,name:e,val:n}),log.debug("PerfMonitor:stopMonitor on "+e+": time = "+n),this._monitors["delete"](e)}}},{key:"cancelMonitor",value:function(e){log.debug("PerfMonitor:cancelMonitor on "+e),this._monitors.has(e)&&this._monitors["delete"](e)}},{key:"reportMonitor",value:function(e,t){var n=2<arguments.length&&arguments[2]!==undefined?arguments[2]:"main";log.debug("PerfMonitor:reportMonitor on "+e),this._perfDataQ.addToQueue("perf",{orig:n,name:e,val:t})}}]),t}(),T.PerfMonitor=S,M=Ye,w=function(){function e(){Je(this,e),this._buffer=[]}return Xe(e,[{key:"hasItems",value:function(){return 0<this.length()}},{key:"length",value:function(){return this._buffer.length}},{key:"enqueue",value:function(e){this._buffer.push(e)}},{key:"enqueueToHead",value:function(e){this._buffer.unshift(e)}},{key:"dequeue",value:function(e){return this._buffer.shift()}},{key:"getItem",value:function(e){return this._buffer[e]}}]),e}(),M.Queue=w,function(s){function e(){this._msgListeners=new s.Map}s.WorkerCommunicator||(e.prototype.setMessagingPort=function(e){this._messagePort=e;var s=this;e.setonmessage(function(e){var t=e.data,n=[],i=s._msgListeners.get(t.msgType);i&&i.forEach(function(e){e.callback(t.data),e.isOneTime&&n.push(e)}),n.forEach(function(e){i["delete"](e)})})},e.prototype.sendAsync=function(e,t,n,i,s){i&&n&&this.addMessageListener(n,i,s),this._messagePort.postMessage({msgType:e,data:t})},e.prototype.addMessageListener=function(e,t,n){var i=null;this._msgListeners.has(e)?i=this._msgListeners.get(e):(i=new s.Set,this._msgListeners.set(e,i)),i.add({callback:t,isOneTime:n})},s.WorkerCommunicator=e)}(Ye),C=Ye,k=function(){function n(e){Je(this,n),this._nativeWorker=e;var t=!!window.SharedWorker&&this._nativeWorker instanceof window.SharedWorker;this.port=new C.CDPort(this._nativeWorker,t)}return Xe(n,[{key:"close",value:function(){this.port&&this.port.close()}}]),n}(),C.WorkerWrapper=k,F=Ye,D=function(){function e(){Je(this,e)}return Xe(e,[{key:"create",value:function(e){var t=new(window.Worker||window.SharedWorker)(e);return new F.WorkerWrapper(t)}}]),e}(),F.WorkerWrapperFactory=D,Ye.EnumDefs={Events:{isTrusted:{"false":0,"true":1,undefined:2,"null":2},elementEventType:{input:0,initial:1,focus:2,blur:3,change:4,click:5,submit:6},clipboardEventType:{copy:0,paste:1,cut:2},keyEventType:{keyup:0,keydown:1,keypress:2},mouseEventType:{mousemove:0,mousedown:1,mouseup:2,click:3,dblclick:4,mouseleave:5,mouseenter:6,wheel:7,mouseout:8,mouseover:9},windowEventType:{DOMContentLoaded:0,scroll:1,resize:2,focus:3,blur:4,tabFocus:5,tabBlur:6},touchEventIEType:{pointerdown:"touchstart",pointerup:"touchend",pointermove:"touchmove",MSPointerDown:"touchstart",MSPointerUp:"touchend",MSPointerMove:"touchmove"},touchEventType:{touchstart:0,touchmove:1,touchend:2,touchcancel:3},pinchZoomEventType:{pointerdown:0,pointermove:1,pointerup:2},getstureEventType:{pinch:0,press:1,swipe:2,rotate:3},scriptEventType:{load:0},screenOrientationType:{undefined:0,"portrait-primary":1,"landscape-primary":2,"portrait-secondary":3,"landscape-secondary":4},tabEventType:{openTab:0,newTab:1,closeTab:2},storageEventType:{storage:0},printEventType:{printDialogOpened:1,printDialogClosed:0},crossmuidEventType:{found:0,"new":1}},SNUM_CHANGE_TYPE:{none:"none",init:"init",configuration:"config",configurationFromSlave:"configFromSlave",customerApi:"customerApi",pageTimeout:"timeout",unknown:"unknown"},MasterSlaveMessage:{dataFromSlave:"dataFromSlave",registerSlave:"registerSlave",logPerfSlave:"logPerfSlave",updateSlaveConf:"updateSlaveConf",updateSlaveState:"updateSlaveState",updateMasterContext:"updateMasterContext",resetSessionTriggerFromSlave:"resetSessionTriggerFromSlave",mouseChallengeTriggerFromSlave:"mouseChallengeTriggerFromSlave",onBeforeUnload:"onbeforeunload",slaveHandShake:"SlaveHandShake",cdHandShake:"CDHandShake",slaveAlive:"slaveAlive"},SystemFrameName:{rtcframe:"cd__rtcframe",fontDetectionFrame:"cd__fontDetectionFrame"},State:{stopped:"stopped",starting:"starting",started:"started",paused:"paused",faulted:"faulted"}},(R=Ye).DomUtils={outerHTML:function(e){return e.outerHTML||(new XMLSerializer).serializeToString(e)},onDocumentBody:function(e,t){e.document.body?t():(window.addEventListener?window.addEventListener("DOMContentLoaded",t,!0):window.attachEvent("onload",t),log.debug("DomUtils:onDocumentBody - no document body found, listening"))},onPageLoad:function(e,t){R.CDUtils.addEventListener(e,"load",t,!0),(e.contentWindow&&"complete"===e.contentWindow.document.readyState||e.document&&"complete"===e.document.readyState)&&t()},waitUntilDocumentIsReady:function(i){var s=this;return new Promise(function(e,t){try{s.onWindowDocumentReady(i,function(){return e()})}catch(n){t(n)}})},onWindowDocumentReady:function(e,t){var n=window.addEventListener?"DOMContentLoaded":"load";if("complete"===e.document.readyState||"interactive"===e.document.readyState)t();else{var i=function i(){R.CDUtils.removeEventListener(e,n,i,!0),t()};R.CDUtils.addEventListener(e,n,i,!0)}},isWindowDocumentReady:function(e){return e&&"complete"===e.document.readyState},canAccessIFrame:function(e){var t=null;try{t=(e.contentDocument||e.contentWindow.document).body.innerHTML}catch(n){}return null!==t},matches:function(e,t){return(e.matches||e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector||function(e){for(var t=(this.document||this.ownerDocument).querySelectorAll(e),n=t.length;0<=--n&&t.item(n)!==this;);return-1<n}).call(e,t)}},L=null,O=function(s,e,r){var o=function o(){return e};if(function t(){return-1<e.toString().indexOf("[native code]")}())r(o());else{var a=0,u=function u(){if(L.contentWindow){for(var e=L.contentWindow,t=s.split("."),n=e,i=0;i<t.length;i++)n=n[t[i]];r(n)}else a<45?(setTimeout(u,a),a++):r(o())};L||((L=document.createElement("IFRAME")).style.display="none",document.documentElement.appendChild(L)),u()}},(P=Ye).CDUtils={scriptVersion:"@@scriptVersion",isPassiveSupported:function et(){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(n){}return e}(),dateNow:Date.now,isUndefinedNull:function(e){return null===e||e===undefined||"undefined"==typeof e},addEventListener:function(e,t,n){var i=3<arguments.length&&arguments[3]!==undefined&&arguments[3],s=!(4<arguments.length&&arguments[4]!==undefined)||arguments[4],r=5<arguments.length&&arguments[5]!==undefined&&arguments[5];this.isPassiveSupported?e.addEventListener(t,n,{capture:i,passive:s,once:r}):e.addEventListener?e.addEventListener(t,n,i):e.attachEvent("on"+t,n)},matchRegEx:function(e,t){return new RegExp(e).test(t)},removeEventListener:function(e,t,n){var i=3<arguments.length&&arguments[3]!==undefined&&arguments[3];e.removeEventListener?e.removeEventListener(t,n,i):e.detachEvent("on"+t,n)},clearTextFromNumbers:function(e){return e?e.replace(/(\d)/g,"*"):""},maskText:function(e){return e.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d\u0000-\u0080]/g,"*")},getDropDownListValues:function(e){for(var t=[],n=0;n<e.length;n++){var i=e.options[n].text||e.options[n].value;t.push(P.CDUtils.maskText(i))}return t},getDocUrl:function(){var e=window.location;return e.protocol+"//"+e.hostname+(e.port?":"+e.port:"")+P.CDUtils.clearTextFromNumbers(e.pathname)},getHash:function(e){for(var t=0,n=0,i=e.length;n<i;n++)t=(t<<5)-t+e.charCodeAt(n),t&=t;return t},getTruncatedHash:function(e,t){return e?this.murmurhash3(e).toString().substring(t):""},murmurhash3:function(e,t){var n,i,s,r,o,a,u,c;for(n=3&e.length,i=e.length-n,s=t,o=3432918353,a=461845907,c=0;c<i;)u=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,s=27492+(65535&(r=5*(65535&(s=(s^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<13|s>>>19))+((5*(s>>>16)&65535)<<16)&4294967295))+((58964+(r>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&e.charCodeAt(c+2))<<16;case 2:u^=(255&e.charCodeAt(c+1))<<8;case 1:s^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(c)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*a+(((u>>>16)*a&65535)<<16)&4294967295}return s^=e.length,s=2246822507*(65535&(s^=s>>>16))+((2246822507*(s>>>16)&65535)<<16)&4294967295,s=3266489909*(65535&(s^=s>>>13))+((3266489909*(s>>>16)&65535)<<16)&4294967295,(s^=s>>>16)>>>0},generateUUID:function(){var n=P.CDUtils.dateNow();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return n=Math.floor(n/16),("x"==e?t:3&t|8).toString(16)})},convertToArrayByMap:function(e,t){for(var n=[null],i=0,s=e.length;i<s;i++)n[i+1]=t[e[i]];return n},getMapCode:function(e){var t=String.fromCharCode(e);return/[0-9]/.test(t)?49:/[a-zA-Z]/.test(t)?65:/[^\u0000-\u0080]/.test(t)?66:e},getPostUrl:function(e,t,n,i,s,r,o){var a=P.HttpRequestFactory.create();a instanceof self.XMLHttpRequest?(a.open(t,e,!0),o!==undefined&&(a.timeout=o),a.withCredentials=!1!==r,"POST"===t&&a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.onreadystatechange=function(){if(4===a.readyState){if(204===a.status)return;200===a.status?i&&i(a.responseText):s&&s(a.responseText)}},a.ontimeout=function(){s&&s("timeout",n)},a.send(n)):(a.onload=function(){i&&i(a.responseText)},a.onerror=function(){s&&s()},a.onprogress=function(){},a.ontimeout=function(){},a.open(t,e,!0),setTimeout(function(){a.send(n)},0))},minutesToMilliseconds:function(e){return 60*e*1e3},cutDecimalPointDigits:function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},DomUtils:P.DomUtils,EnumDefs:P.EnumDefs,StorageUtils:{counter:0,getAndUpdateEventSequenceNumber:function(){return this.counter++},deserialize:function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(t){return e||null}},getFromLocalStorage:function(e,t){try{var n=this.deserialize(window.localStorage.getItem(e));return n?n.exp&&P.CDUtils.dateNow()-n.time>n.exp?null:t===undefined||t?n.val:n:null}catch(i){return null}},saveToLocalStorage:function(e,t,n){var i={val:t};n&&(i.exp=n,i.time=P.CDUtils.dateNow());try{window.localStorage.setItem(e,JSON.stringify(i))}catch(s){return null}return i},removeFromLocalStorage:function(e){try{window.localStorage.removeItem(e)}catch(t){return null}},getFromSessionStorage:function(e){try{var t=this.deserialize(window.sessionStorage.getItem(e));return t||null}catch(n){return null}},saveToSessionStorage:function(e,t){try{return t?(window.sessionStorage.setItem(e,JSON.stringify(t)),t):window.sessionStorage.removeItem(e)}catch(n){return null}},removeFromSessionStorage:function(e){try{window.sessionStorage.removeItem(e)}catch(t){return null}},getCookie:function(e){var t=new RegExp("(?:^|; )"+encodeURIComponent(e)+"=([^;]*)").exec(document.cookie);return t?decodeURIComponent(t[1]):""},setCookie:function(e,t,n){var i="";if(n){var s=new Date;s.setTime(s.getTime()+n),i="; expires="+s.toUTCString()}for(var r=0,o=location.hostname,a=o.split("."),u="",c=!1;r<=a.length-1&&!c;)"localhost"===(o=a.slice(-1-++r).join("."))?u="":""!==o&&(u="; domain=."+o),c=this.setCookieWithAttributes(e,t,i,u);return c||(u="; domain="+location.hostname,c=this.setCookieWithAttributes(e,t,i,u)),c},setCookieWithAttributes:function(e,t,n,i){return document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+n+i+"; path=/",this.getCookie(e)==t},validateBcId:function(e){return/^([0-9]{13,}-)?[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e)?e:null}},getNativeWindowFn:O,JQueryUtils:{isJQueryAvailable:function(){return window.jQuery!==undefined},addEventListener:function(e,t,n){jQuery(e).on(t,n)},removeEventListener:function(e,t,n){jQuery(e).off(t,n)}}},Date.now?O("Date.now",Date.now,function(e){P.CDUtils.dateNow=e}):P.CDUtils.dateNow=function(){return(new Date).getTime()},function(e){var t,n;if(!Function.prototype.cdCallAsync&&(Object.extend=function(e,t){if(e&&t&&"object"==("undefined"==typeof t?"undefined":Ge(t)))for(var n in t)if(t.hasOwnProperty(n))try{""!=n&&Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}catch(i){e[n]=t[n]}return e},e.btoa=self.btoa?self.btoa.bind(self):function(e){for(var t,n,i=String(e),s="",r=0,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.charAt(0|r)||(o="=",r%1);s+=o.charAt(63&t>>8-r%1*8)){if(255<(n=i.charCodeAt(r+=.75)))throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");t=t<<8|n}return s},self.importScripts==undefined)){var o=(t=[],n="Window_"+e.CDUtils.generateUUID(),e.CDUtils.addEventListener(window,"message",function i(e){e.data==n&&(e.stopPropagation&&e.stopPropagation(),e.returnValue&&(e.returnValue=!1),e.cancelBubble&&(e.cancelBubble=!0),t.shift()())},!0),function(e){t.push(e),window.postMessage(n,self.location.href)});Function.prototype.cdCallAsync=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];var s=this;o(function(){s.apply(e||window,n)})},Function.prototype.cdCallAsyncWithErrorHandling=function(t,n){for(var e=arguments.length,i=Array(2<e?e-2:0),s=2;s<e;s++)i[s-2]=arguments[s];var r=this;o(function(){try{r.apply(t||window,i)}catch(e){n&&n(e)}})}}}(Ye),function(e){if(!e.Logger){var t=function(){function n(e,t){Je(this,n),this._logBridge=e,this._logLevel=t||n.LOG_LEVEL.INFO}return Xe(n,[{key:"trace",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.DEBUG)}},{key:"debug",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.DEBUG)}},{key:"info",value:function(e){this._sendToLogBridge(e,n.LOG_LEVEL.INFO)}},{key:"warn",value:function(e,t){this._sendToLogBridge(e,n.LOG_LEVEL.WARN,t)}},{key:"error",value:function(e,t){this._sendToLogBridge(e,n.LOG_LEVEL.ERROR,t)}},{key:"isDebug",value:function(){return this._logLevel==n.LOG_LEVEL.DEBUG}},{key:"updateLogConfig",value:function(e){this._logLevel=e.get("logLevel")||this._logLevel}},{key:"_sendToLogBridge",value:function(e,t,n){t>=this._logLevel&&(n&&n.stack&&(e+=" ;stack: "+n.stack),this._logBridge.log(e,t))}}]),n}();Object.extend(t,{LOG_LEVEL:{DEBUG:10,INFO:20,WARN:30,ERROR:40,CRITICAL:50,OFF:80}}),e.Logger=t,e.log={setLogger:function(e){this._logger=e},isDebug:function(){return this._logger.isDebug()},error:function(e,t){this._logger.error(e,t||null)},warn:function(e,t){this._logger.warn(e,t||null)},trace:function(e){this._logger.trace(e)},debug:function(e){this._logger.debug(e)},info:function(e){this._logger.info(e)}}}}(Ye),Ye.WorkerCommand={requestConfigurationsCommand:"requestConfigurationsCommand",startNewSessionCommand:"startNewSessionCommand",resumeSessionCommand:"resumeSessionCommand",changeContextCommand:"changeContextCommand",updateCsidCommand:"updateCsidCommand",updatePsidCommand:"updatePsidCommand",updateLogUrlCommand:"updateLogUrl",sendDataCommand:"sendDataCommand",sendLogCommand:"sendLogCommand"},Ye.WorkerEvent={NewSessionStartedEvent:"NewSessionStartedEvent",ConfigurationLoadedEvent:"ConfigurationLoadedEvent",ServerStateUpdatedEvent:"ServerStateUpdatedEvent"},N=Ye,A=function(){function t(e){Je(this,t),N.isUnsupportedMode=!0,this._unsPort=e,this._unsFrameHandler={startFeatures:function(){},startFeature:function(){},stopFeatures:function(){},stopFeature:function(){},updateFeatureConfig:function(){}}}return Xe(t,[{key:"getUnsPort",value:function(){return this._unsPort}},{key:"getUnsFrameHandler",value:function(){return this._unsFrameHandler}},{key:"adjustFeatureList",value:function(e){function t(e){for(var t in e)e.hasOwnProperty(t)&&!e[t].runInUns&&delete e[t]}t(e.defaultFeatures),t(e.nonDefaultFeatures),t(e.perSessionFeatures),t(e.perContextFeatures),t(e.perPageReloadFeatures),t(e.nonDefaultFeatures),e.perSessionFeatures.IsUnsupportedFeature={configKey:"isUnsupportedReport",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){var e=function(e){function t(){return Je(this,t),ze(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return Ze(t,N.AbstractFeature),Xe(t,[{key:"startFeature",value:function(){this._dataQ.addToQueue("static_fields",["is_supported",!1],!1)}}]),t}();this._features.perSessionFeatures.IsUnsupportedFeature.instance=new e(this._dataQ)},instance:null}}}]),t}(),N.UnsupportedMgr=A,U=Ye,x=function(){function n(e,t){Je(this,n),this._dataQ=e,this._perfMonitor=t}return Xe(n,[{key:"preFeature",value:function(e){this._perfMonitor.startMonitor(e)}},{key:"postFeature",value:function(e,t){this._perfMonitor.stopMonitor(e,t)}},{key:"cancelMonitor",value:function(e){this._perfMonitor.cancelMonitor(e)}},{key:"stopFeature",value:function(){}},{key:"updateFeatureConfig",value:function(){}}]),n}(),U.AbstractFeature=x,I=Ye,B=function(){function t(e){Je(this,t),this._perfMonitor=e,this.isPassive=I.CDUtils.isPassiveSupported}return Xe(t,[{key:"getEventTimestamp",value:function(){return I.CDUtils.dateNow()}},{key:"getTimestampFromEvent",value:function(e){return e.timeStamp?I.CDUtils.cutDecimalPointDigits(e.timeStamp,3):0}},{key:"handlerProlog",value:function(e){log.isDebug()&&this._perfMonitor.startMonitor(e)}},{key:"handlerEpilog",value:function(e){log.isDebug()&&this._perfMonitor.stopMonitor(e)}},{key:"handlerCancelog",value:function(e){log.isDebug()&&this._perfMonitor.cancelMonitor(e)}},{key:"updateFeatureConfig",value:function(){}}]),t}(),I.Events=B,W=Ye,H=function(e){function o(e,t,n,i,s){Je(this,o);var r=ze(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s));return r._configurationRepository=e,r._utils=t,r._dataQueue=n,r._contextMgr=i,r._elementHashWMap=new WeakMap,r._collectPosition=!0,r._collectClassName=!0,r._collectTitle=!0,r._collectHref=!0,r._collectDataAutomationId=!0,r._maxElemValLength=30,r._XPathHashProducer=new W.XPathHashProducer,r}return Ze(o,W.Events),Xe(o,[{key:"getElement",value:function(e){if(this._utils.isUndefinedNull(e)||e===document||e===document.body)return-1;var t=-1;if(this._elementHashWMap.has(e))t=this._elementHashWMap.get(e).hash;else{this.handlerProlog("t.E_get");var n=this._XPathHashProducer.produce(e);t=n?this._utils.getHash(n):-1,this._elementHashWMap.set(e,{hash:t,contextList:[this._contextMgr.contextName]}),this._sendElementToServer(e,t),this.handlerEpilog("t.E_get")}return t}},{key:"resendElementPerContext",value:function(e){if(this._elementHashWMap.has(e)){var t=this._elementHashWMap.get(e),n=t.hash;t.contextList.indexOf(this._contextMgr.contextName)<0&&(t.contextList.push(this._contextMgr.contextName),this._elementHashWMap.set(e,{hash:t.hash,contextList:t.contextList}),this._sendElementToServer(e,n))}else log.error("received for resendElementPerContext bad element, not in hash map. id="+e.id)}},{key:"isListed",value:function(e){return this._elementHashWMap.has(e)}},{key:"getElementData",value:function(e){return this._elementHashWMap.get(e)}},{key:"getElementContextList",value:function(e){return this._elementHashWMap.get(e).contextList}},{key:"_sendElementToServer",value:function(e,t){var n=this._collectPosition?e.getBoundingClientRect&&e.getBoundingClientRect():null,i=-1,s=-1,r=-1,o=-1;n&&(i=Math.round(n.left),s=Math.round(n.top),r=Math.round(n.right-n.left),o=Math.round(n.bottom-n.top));var a=this._verifyNoPrivateData(e.id||""),u=this._verifyNoPrivateData(e.name||""),c=this._collectClassName&&e.getAttribute&&this._verifyNoPrivateData(e.getAttribute("class"))||"",l=this._collectTitle&&this._verifyNoPrivateData(e.title)||"",h=this._verifyNoPrivateData(e.nodeName)||"",d=this._collectHref&&this._verifyNoPrivateData(e.href)||"";0<d.length&&(d=this._utils.clearTextFromNumbers(d));var f=this._collectDataAutomationId&&e.getAttribute&&this._verifyNoPrivateData(e.getAttribute("data-automation-id"))||"",p="";"SELECT"===e.nodeName&&(p=this._utils.getDropDownListValues(e).join(";"));var v=e.value||e.textContent||e.innerHTML||"";v=v.length>this._maxElemValLength?"":("string"!=typeof v&&(v=v.toString()),this._utils.maskText(v));var _=this._utils.isUndefinedNull(e.checked)?-1:e.checked?1:0,g=this.getEventTimestamp();this._dataQueue.addToQueue("elements",[this._contextMgr.contextId,t,h||"",a||"",u||"",e.type||"",i||0,s||0,r||0,o||0,c||"",d||"",l||"",e.alt||"",p||"",v||"",_,g,f],!1),log.isDebug()&&log.debug("adding element id:"+a+", name:"+u+", type:"+e.type+", width:"+r+", height:"+o+", left:"+i+", top:"+s+", hash: "+t)}},{key:"_verifyNoPrivateData",value:function(e){return/\d\d\d/.test(e)?this._utils.clearTextFromNumbers(e):e}},{key:"updateFeatureConfig",value:function(){this._collectPosition="boolean"==typeof this._configurationRepository.get("isElementsPosition")?this._configurationRepository.get("isElementsPosition"):this._collectPosition,this._collectClassName="boolean"==typeof this._configurationRepository.get("isElementsClassName")?this._configurationRepository.get("isElementsClassName"):this._collectClassName,this._collectTitle="boolean"==typeof this._configurationRepository.get("isElementsTitle")?this._configurationRepository.get("isElementsTitle"):this._collectTitle,this._collectHref="boolean"==typeof this._configurationRepository.get("isElementsHref")?this._configurationRepository.get("isElementsHref"):this._collectHref,this._collectDataAutomationId="boolean"==typeof this._configurationRepository.get(W.ConfigurationFields.collectElementDataAutomationId)?this._configurationRepository.get(W.ConfigurationFields.collectElementDataAutomationId):this._collectDataAutomationId,this._maxElemValLength=this._configurationRepository.get("maxElValLen")?this._configurationRepository.get("maxElValLen"):this._maxElemValLength}}]),o}(),W.Elements=H,function(s){function e(t,e,n,i){var r,o=this;this._utils=t,this._elements=e,this._dataQueue=n,this._perfMonitor=i;var a=function a(e){return t.dateNow()},u=o._utils.StorageUtils,c=s.EnumDefs.Events.mouseEventType,l=s.EnumDefs.Events.isTrusted;this.getMouseEvent=function(e){var t=e.which;"mouseup"===e.type?r=t:"click"===e.type&&0===t&&(t=r);var n=c[e.type];o._utils.isUndefinedNull(n)&&(n=-1);var i=e.deltaY||e.deltaX||e.deltaZ||e.wheelDelta||0,s=o.getTimestampFromEvent(e);o._dataQueue.addToQueue("mouse_events",[null,u.getAndUpdateEventSequenceNumber(),a(e),n,l[e.isTrusted],"mousemove"===e.type?0:o._elements.getElement(e.target),e.pageX?Math.round(e.pageX):-1,e.pageY?Math.round(e.pageY):-1,e.screenX?Math.round(e.screenX):-1,e.screenY?Math.round(e.screenY):-1,null===t||t===undefined?-1:t,Math.round(i),e.clientX?Math.round(e.clientX):-1,e.clientY?Math.round(e.clientY):-1,e.detail||0,null===e.button||e.button===undefined?-1:e.button,s])}}(e.prototype=Object.create(s.Events.prototype)).startFeature=function(e){var t=this;try{this._perfMonitor.stopMonitor("t.timeTillDataCollect"),e||(e=window.self);var n=e.document||e.contentDocument;this._utils.addEventListener(n,"mousemove",this.getMouseEvent,!0),this._utils.addEventListener(n,"mousedown",this.getMouseEvent,!0),this._utils.addEventListener(n,"mouseup",this.getMouseEvent,!0),this._utils.addEventListener(n,"click",this.getMouseEvent,!0),this._utils.addEventListener(n,"dblclick",this.getMouseEvent,!0),this._isIE=!!document.documentMode||/edge/.test(window.navigator.userAgent.toLowerCase()),this._isIE?s.CDUtils.DomUtils.onDocumentBody(e,function(){t._utils.addEventListener(n.body,"mouseleave",t.getMouseEvent),t._utils.addEventListener(n.body,"mouseenter",t.getMouseEvent)}):(this._utils.addEventListener(n,"mouseleave",this.getMouseEvent),this._utils.addEventListener(n,"mouseenter",this.getMouseEvent)),this._utils.addEventListener(n,"wheel",this.getMouseEvent,!0)}catch(i){log.error("MouseEvents:startFeature failed. msg:"+i.message,i)}},e.prototype.stopFeature=function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;this._utils.removeEventListener(t,"mousemove",this.getMouseEvent,!0),this._utils.removeEventListener(t,"mousedown",this.getMouseEvent,!0),this._utils.removeEventListener(t,"mouseup",this.getMouseEvent,!0),this._utils.removeEventListener(t,"click",this.getMouseEvent,!0),this._utils.removeEventListener(t,"dblclick",this.getMouseEvent,!0),this._isIE?(this._utils.removeEventListener(t.body,"mouseleave",this.getMouseEvent),this._utils.removeEventListener(t.body,"mouseenter",this.getMouseEvent)):(this._utils.removeEventListener(t,"mouseleave",this.getMouseEvent),this._utils.removeEventListener(t,"mouseenter",this.getMouseEvent)),this._utils.removeEventListener(t,"wheel",this.getMouseEvent,!0)}catch(n){log.error("MouseEvents:stopFeature failed. msg:"+n.message,n)}},s.MouseEvents=e}(Ye),Q=Ye,j=function(e){function o(e,t,n,i,s){Je(this,o);var r=ze(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,i));return r._utils=e,r._dataQ=n,r._elements=t,r._msgBus=s,r._onAllBrowsersTouchEventBinded=r._onAllBrowsersTouchEvent.bind(r),r}return Ze(o,Q.Events),Xe(o,[{key:"startFeature",value:function(e){e||(e=window.self),this._bind(e)}},{key:"stopFeature",value:function(e){e||(e=window.self),this._unbind(e)}},{key:"_addToCommunicationQueue",value:function(e,t,n,i){e!==Q.EnumDefs.Events.touchEventType.touchstart&&e!==Q.EnumDefs.Events.touchEventType.touchend||this._msgBus.publish(Q.MessageBusEventType.TouchEvent,{action:e});var s=this.getEventTimestamp(i),r=Q.EnumDefs.Events.isTrusted[i.isTrusted],o=this._elements.getElement(i.target),a=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._utils.isUndefinedNull(e)&&(e=-1),this._utils.isUndefinedNull(t)&&(t=-1);var u=this.getTimestampFromEvent(i);this._dataQ.addToQueue("touch_events",Q.CDUtils.convertToArrayByMap(Q.DataMappingDefs.TOUCH_EVENT_MAP,{eventSequence:a,timestamp:s,eventType:e,isTrusted:r,elementHash:o,clientX:n.clientX?Math.round(n.clientX):0,clientY:n.clientY?Math.round(n.clientY):0,touchIndex:t,touchSizeMajor:n.radiusX?2*n.radiusX:0,touchSizeMinor:n.radiusY?2*n.radiusY:0,pageX:n.pageX||0,pageY:n.pageY||0,screenX:n.screenX||0,screenY:n.screenY||0,relativeTime:u}))}},{key:"_bind",value:function(e){var t=e.document||e.contentDocument,n=void 0;if(window.TouchEvent?n=["touchstart","touchmove","touchend","touchcancel"]:window.PointerEvent&&(n=["pointerdown","pointermove","pointerup"]),this._listeningToEvents=n,this._listeningToEvents)for(var i=0;i<this._listeningToEvents.length;i++)this._utils.addEventListener(t,this._listeningToEvents[i],this._onAllBrowsersTouchEventBinded)}},{key:"_unbind",value:function(e){var t=e.document||e.contentDocument;if(this._listeningToEvents)for(var n=0;n<this._listeningToEvents.length;n++)this._utils.removeEventListener(t,this._listeningToEvents[n],this._onAllBrowsersTouchEventBinded)}},{key:"_onAllBrowsersTouchEvent",value:function(e){return this.handlerProlog("t.TE"),this._onIeTouchEvent(e),this._onTouchEvent(e),this.handlerEpilog("t.TE"),!0}},{key:"_onTouchEvent",value:function(e){if((null===e.pointerType||e.pointerType===undefined)&&e.changedTouches!==undefined)for(var t=Q.EnumDefs.Events.touchEventType[e.type],n=0;n<e.changedTouches.length;n++){var i=e.changedTouches[n],s=i.identifier%1e4;this._addToCommunicationQueue(t,s,i,e)}}},{key:"_onIeTouchEvent",value:function(e){if(null!=e.pointerType&&("touch"===e.pointerType||"pen"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH||e.pointerType===e.MSPOINTER_TYPE_PEN)){var t=Q.EnumDefs.Events.touchEventIEType[e.type]||"touchcancel",n=e.pointerId?e.pointerId%1e4:0,i=Q.EnumDefs.Events.touchEventType[t];this._addToCommunicationQueue(i,n,e,e)}}}]),o}(),Q.TouchEvents=j,K=Ye,q=["clientX","clientY"],V=["screenX","screenY"],Y=function Y(t,n,s){function i(e,t){var n=t[s[0]]-e[s[0]],i=t[s[1]]-e[s[1]];return Math.sqrt(n*n+i*i)}return{getScale:function(){return function e(){return i(t[0],t[1])/i(n[0],n[1])}()},getFocusPoint:function(){return function n(e,t){return Object.assign({},{x:(e[s[0]]+t[s[0]])/2,y:(e[s[1]]+t[s[1]])/2})}(t[1],t[0])}}},X=function(e){function o(e,t,n,i,s){Je(this,o);var r=ze(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,i));return r._utils=e,r._dataQ=n,r._elements=t,r._msgBus=s,r._evGesturesCache=[],r._prevEventDiff=-1,r._prevEvGestureSet=[],r._prevTouchEvents=[],r._onAllBrowsersPinchZoomEventBinded=r._onAllBrowsersPinchZoomEvent.bind(r),r}return Ze(o,K.Events),Xe(o,[{key:"startFeature",value:function(e){e||(e=window.self),this._bind(e),this._isReady=!0}},{key:"stopFeature",value:function(e){e||(e=window.self),this._unbind(e)}},{key:"_addToCommunicationQueue",value:function(e,t,n,i){e!==K.EnumDefs.Events.pinchZoomEventType.pointerdown&&e!==K.EnumDefs.Events.pinchZoomEventType.pointerup||this._msgBus.publish("pinchEvent",{action:e});var s=this.getEventTimestamp(i),r=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._dataQ.addToQueue("pinch_events",K.CDUtils.convertToArrayByMap(K.DataMappingDefs.PINCH_ZOOM_EVENT_MAP,{eventSequence:r,timestamp:s,focusX:n.x,focusY:n.y,scaleFactor:t}))}},{key:"_bind",value:function(e){var t=e.document||e.contentDocument,n=void 0;if(window.PointerEvent?n=["pointerdown","pointermove","pointerup"]:window.TouchEvent&&(n=["touchstart","touchend","touchcancel","touchmove"]),this._listeningToEvents=n,this._listeningToEvents)for(var i=0;i<this._listeningToEvents.length;i++)this._utils.addEventListener(t,this._listeningToEvents[i],this._onAllBrowsersPinchZoomEventBinded)}},{key:"_unbind",value:function(e){var t=e.document||e.contentDocument;if(this._listeningToEvents)for(var n=0;n<this._listeningToEvents.length;n++)this._utils.removeEventListener(t,this._listeningToEvents[n],this._onAllBrowsersPinchZoomEventBinded);this._evGesturesCache=[],this._prevEventDiff=-1}},{key:"_onAllBrowsersPinchZoomEvent",value:function(e){switch(this.handlerProlog("t.TE"),e.type){case"pointerdown":this._onPointerDownEvent(e);break;case"pointermove":this._onPointerMoveEvent(e);break;case"pointerup":this._onPointerUpEvent(e);break;case"touchstart":this._onTouchStartEvent(e);break;case"touchend":this._onTouchEndEvent(e);break;case"touchmove":this._onTouchMoveEvent(e)}return this.handlerEpilog("t.TE"),!0}},{key:"_onPointerDownEvent",value:function(e){this._evGesturesCache.push(e)}},{key:"_onPointerMoveEvent",value:function(e){for(var t=0;t<this._evGesturesCache.length;t++)if(e.pointerId==this._evGesturesCache[t].pointerId){this._evGesturesCache[t]=e;break}if(2==this._evGesturesCache.length&&this._evGesturesCache[0].pointerId!=this._evGesturesCache[1].pointerId){var n=Math.abs(this._evGesturesCache[0].clientX-this._evGesturesCache[1].clientX);if(0<this._prevEventDiff&&(this._prevEventDiff,this._prevEventDiff,2==this._prevEvGestureSet.length)){var i=Y(this._evGesturesCache,this._prevEvGestureSet,q),s=i.getScale();this._addToCommunicationQueue(K.EnumDefs.Events.pinchZoomEventType[e.type],s,i.getFocusPoint(),e)}this._prevEventDiff=n,this._prevEvGestureSet=this._evGesturesCache.slice(0)}else 2<this._evGesturesCache.length&&(this._evGesturesCache=[],this._prevEvGestureSet=[])}},{key:"_onPointerUpEvent",value:function(e){for(var t=0;t<this._evGesturesCache.length;t++)if(this._evGesturesCache[t].pointerId==e.pointerId){this._evGesturesCache.splice(t,1);break}this._evGesturesCache.length<2&&(this._prevEventDiff=-1,this._prevEvGestureSet=[])}},{key:"_onTouchStartEvent",value:function(e){this._prevTouchEvents[0]=e.touches.item(0),this._prevTouchEvents[1]=e.touches.item(1)}},{key:"_onTouchEndEvent",value:function(e){this._prevTouchEvents=[]}},{key:"_onTouchCancelEvent",value:function(e){}},{key:"_onTouchMoveEvent",value:function(e){if(2==e.touches.length){if(2==this._prevTouchEvents.length){var t=[e.touches.item(0),e.touches.item(1)],n=Y(t,this._prevTouchEvents.splice(0),V),i=n.getScale();this._addToCommunicationQueue(K.EnumDefs.Events.pinchZoomEventType[e.type],i,n.getFocusPoint(),e)}this._prevTouchEvents[0]=e.touches.item(0),this._prevTouchEvents[1]=e.touches.item(1)}}}]),o}(),K.PinchZoomEvents=X,G=Ye,z=function(e){function o(e,t,n,i,s){Je(this,o);var r=ze(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,s));return r._configurationRepository=e,r._utils=t,r._dataQ=i,r._elements=n,r._activeTouchActions={},r._tapMaxSlop=r._configurationRepository.get("tapEventsTapMaxSlop")||20,r._longPressTimeout=r._configurationRepository.get("tapEventsLongPressTimeout")||500,r._handleStartEventBind=r._handleStartEvent.bind(r),r._handleMoveEventBind=r._handleMoveEvent.bind(r),r._handleEndEventBind=r._handleEndEvent.bind(r),r._handleCancelEventBind=r._handleCancelEvent.bind(r),r._eventDefinitions=o.getSupportedTouchEvents(),r}return Ze(o,G.Events),Xe(o,[{key:"startFeature",value:function(e){e||(e=window.self),this._bind(e)}},{key:"stopFeature",value:function(e){e||(e=window.self),this._unbind(e)}},{key:"updateFeatureConfig",value:function(){this._tapMaxSlop=this._configurationRepository.get("tapEventsTapMaxSlop")!==undefined?this._configurationRepository.get("tapEventsTapMaxSlop"):this._tapMaxSlop,this._longPressTimeout=this._configurationRepository.get("tapEventsLongPressTimeout")!==undefined?this._configurationRepository.get("tapEventsLongPressTimeout"):this._longPressTimeout}},{key:"_bind",value:function(e){if(this._eventDefinitions){var t=e.document||e.contentDocument;this._utils.addEventListener(t,this._eventDefinitions.startEvent,this._handleStartEventBind),this._utils.addEventListener(t,this._eventDefinitions.moveEvent,this._handleMoveEventBind),this._utils.addEventListener(t,this._eventDefinitions.endEvent,this._handleEndEventBind),this._utils.addEventListener(t,this._eventDefinitions.cancelEvent,this._handleCancelEventBind)}else log.debug("TapEvents:_bind - No event definitions. Might be a legacy browser. Aborting bind operation.")}},{key:"_unbind",value:function(e){if(this._eventDefinitions){var t=e.document||e.contentDocument;this._utils.removeEventListener(t,this._eventDefinitions.startEvent,this._handleStartEventBind),this._utils.removeEventListener(t,this._eventDefinitions.moveEvent,this._handleMoveEventBind),this._utils.removeEventListener(t,this._eventDefinitions.endEvent,this._handleEndEventBind),this._utils.removeEventListener(t,this._eventDefinitions.cancelEvent,this._handleCancelEventBind)}}},{key:"_handleStartEvent",value:function(e){this.handlerProlog("t.TapStartE");for(var t=this._getEventData(e),n=0;n<t.length;n++)this._activeTouchActions[t[n].identifier]={startTime:this.getEventTimestamp(),startX:t[n].touchData.pageX,startY:t[n].touchData.pageY,offsetX:0,offsetY:0};this.handlerEpilog("t.TapStartE")}},{key:"_handleMoveEvent",value:function(e){this.handlerProlog("t.TapMoveE");for(var t=this._getEventData(e),n=0;n<t.length;n++){var i=this._activeTouchActions[t[n].identifier];i.offsetX=Math.abs(t[n].touchData.pageX-i.startX),i.offsetY=Math.abs(t[n].touchData.pageY-i.startY)}this.handlerEpilog("t.TapMoveE")}},{key:"_handleEndEvent",value:function(e){this.handlerProlog("t.TapEndE");for(var t=this._getEventData(e),n=0;n<t.length;n++){var i=this._activeTouchActions[t[n].identifier];i.offsetX<this._tapMaxSlop&&i.offsetY<this._tapMaxSlop&&(this.getEventTimestamp()-i.startTime<this._longPressTimeout?this._sendEvent("tap_events",G.DataMappingDefs.TAP_EVENT_MAP,t[n].identifier,t[n].touchData,t[n].eventArgs):this._sendEvent("longpress_events",G.DataMappingDefs.LONGPRESS_EVENT_MAP,t[n].identifier,t[n].touchData,t[n].eventArgs)),delete this._activeTouchActions[t[n].identifier]}this.handlerEpilog("t.TapEndE")}},{key:"_handleCancelEvent",value:function(e){this.handlerProlog("t.TapCancelE");for(var t=this._getEventData(e),n=0;n<t.length;n++)delete this._activeTouchActions[t[n].identifier];this.handlerEpilog("t.TapCancelE")}},{key:"_getEventData",value:function(e){if(e.changedTouches==undefined)return null==e.pointerType||"touch"!=e.pointerType&&"pen"!=e.pointerType&&e.pointerType!=e.MSPOINTER_TYPE_TOUCH&&e.pointerType!=e.MSPOINTER_TYPE_PEN?[]:[{identifier:e.pointerId?e.pointerId:0,touchData:e,eventArgs:e}];for(var t=[],n=0;n<e.changedTouches.length;n++){var i=e.changedTouches[n],s=i.identifier;t.push({identifier:s,touchData:i,eventArgs:e})}return t}},{key:"_sendEvent",value:function(e,t,n,i,s){var r=this.getEventTimestamp(),o=G.EnumDefs.Events.isTrusted[s.isTrusted],a=this._elements.getElement(s.target),u=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();this._utils.isUndefinedNull(n)&&(n=0),this._dataQ.addToQueue(e,G.CDUtils.convertToArrayByMap(t,{eventSequence:u,timestamp:r,screenX:i.screenX?Math.round(i.screenX):0,screenY:i.screenY?Math.round(i.screenY):0,pageX:i.pageX||0,pageY:i.pageY||0,clientX:i.clientX||0,clientY:i.clientY||0,isTrusted:o,elementHash:a,touchIndex:n%1e4,touchSizeMajor:i.radiusX?2*i.radiusX:0,touchSizeMinor:i.radiusY?2*i.radiusY:0}))}}],[{key:"getSupportedTouchEvents",value:function(){return window.TouchEvent?{startEvent:"touchstart",moveEvent:"touchmove",endEvent:"touchend",cancelEvent:"touchcancel"}:window.PointerEvent?{startEvent:"pointerdown",moveEvent:"pointermove",endEvent:"pointerup",cancelEvent:"pointercancel"}:void log.debug("TapEvents:_createEventsToListenList - No touch support for browser.")}}]),o}(),G.TapEvents=z,Z=Ye,J=function(e){function p(e,t,n,i,s,r){Je(this,p);var o=ze(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,s));return o._configurationRepository=e,o._utils=t,o._elements=n,o._dataQueue=i,o._perfMonitor=s,o._msgBus=r,o.comboCode=[67,86,65,88,90,80,83],o._onKeyEvent=o._onKeyEvent.bind(o),o._onTestKeyEvent=o._onTestKeyEvent.bind(o),o}return Ze(p,Z.Events),Xe(p,[{key:"startFeature",value:function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;this._bind(t,this._onKeyEvent,!1),this._configurationRepository.get("isCaptureKeyEvents")&&this._bind(t,this._onTestKeyEvent,!0)}catch(n){log.error("KeyEvents:startFeature failed, msg: "+n.message,n)}}},{key:"stopFeature",value:function(e){try{e||(e=window.self);var t=e.document||e.contentDocument;this._unbind(t,this._onKeyEvent,!1),this._configurationRepository.get("isCaptureKeyEvents")&&this._unbind(t,this._onTestKeyEvent,!0)}catch(n){log.error("KeyEvents:stopFeature failed, msg: "+n.message,n)}}},{key:"_maskKeyAndCode",value:function(e){if(1===e.key.length){var t=this._utils.getMapCode(e.key.charCodeAt(0));e.key=String.fromCharCode(t)}-1!==e.code.indexOf("Numpad")?e.code="Numpad":-1!==e.code.indexOf("Digit")?e.code="Digit":-1!==e.code.indexOf("Key")&&(e.code="Key")}},{key:"_analyzeKey",value:function(e){var t=-1;return t="keypress"!==e.type&&95<e.which?e.which<106?96:e.which||e.keyCode:this._utils.getMapCode(e.which||e.keyCode),this._utils.isUndefinedNull(t)&&(t=-1),t}},{key:"updateFeatureConfig",value:function(e){try{if(this._configurationRepository.get("isCaptureKeyEvents")){e||(e=window.self);var t=e.document||e.contentDocument;this._unbind(t,this._onTestKeyEvent,!0),this._bind(t,this._onTestKeyEvent,!0)}}catch(n){log.error("KeyEvents:startFeature failed, msg: "+n.message,n)}}},{key:"_bind",value:function(e,t,n){e.addEventListener("keyup",t,n),e.addEventListener("keydown",t,n),e.addEventListener("keypress",t,n)}},{key:"_unbind",value:function(e,t,n){e.removeEventListener("keyup",t,n),e.removeEventListener("keydown",t,n),e.removeEventListener("keypress",t,n)}},{key:"_onTestKeyEvent",value:function(e){this._handleKeyEvent(e,"test_key_events")}},{key:"_onKeyEvent",value:function(e){this.handlerProlog("t.KE");var t=Z.EnumDefs.Events.keyEventType[e.type];t!==Z.EnumDefs.Events.keyEventType.keydown&&t!==Z.EnumDefs.Events.keyEventType.keyup||this._msgBus.publish(Z.MessageBusEventType.KeyEvent,{action:t}),this._handleKeyEvent(e,"key_events"),this.handlerEpilog("t.KE")}},{key:"_handleKeyEvent",value:function(e,t){var n=this._analyzeKey(e),i=Z.EnumDefs.Events.isTrusted[e.isTrusted],s=this.getEventTimestamp(e),r=-1===n||"keypress"!==e.type?"":String.fromCharCode(n),o=this._elements.getElement(e.target),a=Z.EnumDefs.Events.keyEventType[e.type];this._utils.isUndefinedNull(a)&&(a=-1);var u=e.ctrlKey&&"keyup"!==e.type||e.metaKey?this.comboCode.indexOf(e.which):-1,c="Meta"===e.key||"OS"===e.key||"Win"===e.key||e.metaKey||91===e.keyCode||92===e.keyCode,l=this._utils.StorageUtils.getAndUpdateEventSequenceNumber(),h={key:e.key||"",code:e.code||""};this._maskKeyAndCode(h);var d="-1";this._configurationRepository.get(Z.ConfigurationFields.collectKeyRegionValue)&&(d=p._getKeyRegion(e)),log.isDebug()&&log.trace("onKeyEvent: got event: "+a+", at time:"+s+", key: "+h.key+", code:"+h.code+", old charCode:"+n);var f=this.getTimestampFromEvent(e);this._dataQueue.addToQueue(t,Z.CDUtils.convertToArrayByMap(Z.DataMappingDefs.KEY_EVENT_MAP,{eventType:a,eventSequence:l,timestamp:s,charCode:n,character:r||"",elementHash:o,keyComboType:u,isTrusted:i,isCtrl:e.ctrlKey||!1,isShift:e.shiftKey||!1,isAlt:e.altKey||!1,isMetaKey:c||!1,keyLocation:e.location||0,code:h.code||"",key:h.key||"",location:e.location||"",isRepeat:e.repeat||!1,keyRegion:d,relativeTime:f}))}}],[{key:"_getKeyRegion",value:function(e){var t=e.which||e.keyCode;for(var n in Z.KeyRegionsTable)if(Z.KeyRegionsTable.hasOwnProperty(n)&&-1<Z.KeyRegionsTable[n].indexOf(t))return n;return"-1"}}]),p}(),Z.KeyEvents=J,Ye.KeyRegionsTable={0:[192,49,50,51],1:[52,53,54,55],2:[56,57,48],3:[81,87,69,65,83,68,90,88,67],4:[82,84,70,71,86,66],5:[89,85,72,74,78,77],6:[73,79,80,75,76,188,190],7:[186,189,187,191,219,220,221,222]},$=Ye,ee=function(e){function s(e,t,n){Je(this,s);var i=ze(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,n));return i._onScriptExecuteEventFunc=i._onScriptExecuteEvent.bind(i),i._dataQueue=t,i._utils=e,i}return Ze(s,$.Events),Xe(s,[{key:"_onScriptExecuteEvent",value:function(e){if(e&&e.target&&("load"!==e.type||"script"===e.target.nodeName.toLowerCase()))try{this.handlerProlog("t.SE_E");var t=this.getEventTimestamp(e),n=this._utils.StorageUtils.getAndUpdateEventSequenceNumber(),i=$.EnumDefs.Events.scriptEventType[e.type];this._utils.isUndefinedNull(i)&&(i=-1),log.isDebug()&&log.trace("got event "+e.type+", "+i+", scriptSrc: "+e.target.src+" at time "+t),this._dataQueue.addToQueue("script_events",$.CDUtils.convertToArrayByMap($.DataMappingDefs.SCRIPT_EVENT_MAP,{eventSequence:n,timestamp:t,eventType:i,scriptId:e.target.id||"",namespaceURI:e.target.namespaceURI||"",outerHTML:e.target.outerHTML||"",scriptSource:e.target.src||"",scriptType:e.target.type||""})),this.handlerEpilog("t.SE_E")}catch(s){this.handlerCancelog("t.SE_E"),log.error("error on getScriptExecuteEvent "+s.toString())}}},{key:"startFeature",value:function(){this._utils.addEventListener(document,"load",this._onScriptExecuteEventFunc,!0)}},{key:"stopFeature",value:function(){this._utils.removeEventListener(document,"load",this._onScriptExecuteEventFunc,!0)}}]),s}(),$.ScriptEvents=ee,te=Ye,ne=function(){function i(e,t,n){Je(this,i),this._historyBuffer=[],this._isTouchInProgress=!1,this._touchStartCount=0,this._isPostTouch=!1,this._touchEndTime=0,this._dataQueue=t,this._configurationRepository=e,this._msgBus=n,this._msgBus.subscribe(te.MessageBusEventType.TouchEvent,this._onTouch.bind(this)),this._msgBus.subscribe(te.MessageBusEventType.KeyEvent,this._onTouch.bind(this)),this._isMotionAroundTouchEnabled=this._configurationRepository.get("isMotionAroundTouchEnabled")===undefined||this._configurationRepository.get("isMotionAroundTouchEnabled"),this._aroundTouchInterval=this._configurationRepository.get("motionPaddingAroundTouchMSec")!==undefined?this._configurationRepository.get("motionPaddingAroundTouchMSec"):1e3}return Xe(i,[{key:"addToQueue",value:function(e,t,n,i){var s=te.CDUtils.dateNow();if(this._isPostTouch&&s-this._touchEndTime>this._aroundTouchInterval&&(log.debug("SensorsDataQueue: stopped post touch events, time has passed ("+this._aroundTouchInterval+" millisec)"),this._isPostTouch=!1),!this._isMotionAroundTouchEnabled||this._isTouchInProgress||this._isPostTouch)this._dataQueue.addToQueue(e,t,n,i);else{this._historyBuffer.push({name:e,data:t,addCtxId:n,isImmediateWup:i,timestamp:s});for(var r=0,o=this._historyBuffer.length;r<o&&s-this._historyBuffer[0].timestamp>this._aroundTouchInterval;r++)this._historyBuffer.shift()}}},{key:"onConfigUpdate",value:function(){this._aroundTouchInterval=this._configurationRepository.get("motionPaddingAroundTouchMSec")!==undefined?this._configurationRepository.get("motionPaddingAroundTouchMSec"):this._aroundTouchInterval,this._isMotionAroundTouchEnabled=this._configurationRepository.get("isMotionAroundTouchEnabled")!==undefined?this._configurationRepository.get("isMotionAroundTouchEnabled"):this._isMotionAroundTouchEnabled}},{key:"_sendBuffer",value:function(){var e=te.CDUtils.dateNow();log.debug("sending history sensors buffer ts="+e);for(var t=0,n=this._historyBuffer.length;t<n;t++)e-this._historyBuffer[t].timestamp<=this._aroundTouchInterval&&this._dataQueue.addToQueue(this._historyBuffer[t].name,this._historyBuffer[t].data,this._historyBuffer[t].addCtxId,this._historyBuffer[t].isImmediateWup);this._historyBuffer=[]}},{key:"_onTouch",value:function(e){return this._isMotionAroundTouchEnabled&&(this._isTouchInProgress||e.action!==te.EnumDefs.Events.touchEventType.touchstart&&e.action!==te.EnumDefs.Events.keyEventType.keydown?e.action===te.EnumDefs.Events.touchEventType.touchend||e.action===te.EnumDefs.Events.keyEventType.keyup?(this._touchStartCount--,this._touchStartCount<=0&&(this._isTouchInProgress=!1,this._isPostTouch=!0,this._touchEndTime=te.CDUtils.dateNow(),log.debug("stopped touch event in sensors data q ts="+te.CDUtils.dateNow()))):e.action!==te.EnumDefs.Events.touchEventType.touchstart&&e.action!==te.EnumDefs.Events.keyEventType.keydown||this._touchStartCount++:(log.debug("Started touch event in sensors data q ts="+te.CDUtils.dateNow()),this._isTouchInProgress=!0,this._touchStartCount=1,this._sendBuffer())),!1}}]),i}(),te.SensorsDataQueue=ne,ie=Ye,se=function(){function e(){Je(this,e),this._initialize()}return Xe(e,[{key:"_initialize",value:function(){this._nodeParentHash=new WeakMap,this._nodeNameOccurencesPerParent=[],this._nodeNameOccurencesPerParent.push({})}},{key:"getUniqueElementName",value:function(e){return e.nodeName.toLowerCase()+(e.id||"")+(e.name||"")+(e.href||"")+(e.getAttribute&&e.getAttribute("class")||"")+(e.title||"")}},{key:"produce",value:function(e){var t=[],n=e,i=(e.id||"")+(e.name||"")+(e.nodeName||"")+(e.className||"")+(e.title||"")+(e.href||""),s=!1;if(e.parentNode&&this._nodeParentHash.has(e.parentNode)){var r=e.nodeName.toLowerCase(),o=this._nodeParentHash.get(e.parentNode),a=o.occurrencesIndex,u=0;return this._nodeNameOccurencesPerParent[a]&&("undefined"!=typeof this._nodeNameOccurencesPerParent[a][r]?u=this._nodeNameOccurencesPerParent[a][r]=++this._nodeNameOccurencesPerParent[a][r]:this._nodeNameOccurencesPerParent[a][r]=0),i+=o.hash+","+this.getUniqueElementName(e)+(u||"")}s=!!e.parentNode&&e.parentNode;for(var c=0;e&&1===e.nodeType;e=e.parentNode){for(var l=0,h=e.previousSibling;h;h=h.previousSibling)h.nodeType!==Node.DOCUMENT_TYPE_NODE&&h.nodeName===e.nodeName&&(c=++l);var d=this.getUniqueElementName(e),f=l||"";t.splice(0,0,d+f)}i+=t.length?"/"+t.join():"";var p=[];if(0<t.length&&(p=t.slice(0,t.length-1)),s){var v={};v[n.nodeName.toLowerCase()]=c;var _=this._nodeNameOccurencesPerParent.push(v)-1;this._nodeParentHash.set(s,{hash:"/"+p.join(),occurrencesIndex:_})}return i}}]),e}(),ie.XPathHashProducer=se,re=Ye,oe=function(e){function s(e,t,n){Je(this,s);var i=ze(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,n));return i._timeoutValue=1e3,i._scriptsRepository=t,i._runDetectionLoopBinded=i._runDetectionLoop.bind(i),i}return Ze(s,re.AbstractFeature),Xe(s,[{key:"_checkScriptsData",value:function(){for(var e=document.scripts,t=0;t<e.length;t++){var n={src:e[t].src,text:e[t].text};this._scriptsRepository.exists(n)||(this._scriptsRepository.add(n),this._dataQ.addToQueue("scripts",[null,n.src,n.textHash]))}}},{key:"_runDetectionLoop",value:function(){this._checkScriptsData(),this._timer=setTimeout(this._runDetectionLoopBinded,this._timeoutValue),this._timeoutValue<536870911&&(this._timeoutValue*=4)}},{key:"startFeature",value:function(){this.preFeature("scripts"),this._runDetectionLoop(),this.postFeature("scripts")}},{key:"stopFeature",value:function(){this._timer&&clearTimeout(this._timer)}}]),s}(),re.ScriptsFeature=oe,ae=Ye,ue=function(){function t(e){Je(this,t),this._utils=e,this._scriptList=[]}return Xe(t,[{key:"count",value:function(){return this._scriptList.length}},{key:"exists",value:function(e){/\d\d\d/.test(e.src)&&(e.src=this._utils.clearTextFromNumbers(e.src));for(var t=this._utils.getHash(e.text),n=0;n<this._scriptList.length;n++)if(e.src&&e.src===this._scriptList[n].src||t&&t===this._scriptList[n].textHash)return!0;return!1}},{key:"add",value:function(e){e.textHash=this._utils.getHash(e.text),/\d\d\d/.test(e.src)&&(e.src=this._utils.clearTextFromNumbers(e.src)),this._scriptList.push({src:e.src,textHash:e.textHash})}}]),t}(),ae.ScriptsRepository=ue,ce=Ye,le=function(e){function r(e,t,n,i){Je(this,r);var s=ze(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,t,n));return s._configurationRepository=e,s._metaDataSiteMapper=i,s._metaDataSiteMapper.updateObserver(s.onSiteMapperMatch.bind(s)),s}return Ze(r,ce.AbstractFeature),Xe(r,[{key:"startFeature",value:function(){this._metaDataSiteMapper.initTracking()}},{key:"stopFeature",value:function(){this._metaDataSiteMapper.stopTracking()}},{key:"onSiteMapperMatch",value:function(e){log.debug("Metadata Collector mapper match - "+JSON.stringify(e)),e.metaVal&&this._dataQ.addToQueue("metadata_map",[null,e.metaVal,ce.CDUtils.dateNow()])}},{key:"updateFeatureConfig",value:function(){this._metaDataSiteMapper.onConfigUpdate(this._configurationRepository)}}]),r}(),ce.MetadataCollector=le,he=Ye,de=function(){function i(e,t,n){Je(this,i),this._framesCache=e,this._framesDetector=t,this._framesDetector.frameAdded.subscribe(this._onFrameAdded.bind(this)),this._framesDetector.frameRemoved.subscribe(this._onFrameRemoved.bind(this)),this._framesDetector.frameInaccessible.subscribe(this._onFrameInaccessible.bind(this)),this._featuresList=[],this._cdUtils=n,this._framesDetector.addToIgnoreList(he.EnumDefs.SystemFrameName.rtcframe),this._framesDetector.addToIgnoreList(he.EnumDefs.SystemFrameName.fontDetectionFrame),this._framesDetector.start(window.self),this._buildFramesCache()}return Xe(i,[{key:"startFeatures",value:function(e){try{if(this._buildFeaturesMap(e),0===this._featuresList.length)return;log.debug("startFeatures:Running features on "+this._framesCache.count+" frames"),this._startFeaturesOnFrames(this._framesCache.frames,e)}catch(t){log.debug("Failed to start features in FrameHandler.startFeatures: "+t.message,t)}}},{key:"startFeature",value:function(e){try{this._featuresList.push(e),e.isRunning=!0,this._startFeaturesOnFrames(this._framesCache.frames,[e])}catch(t){log.debug("Failed to start feature in FrameHandler.startFeature: "+t.message,t)}}},{key:"stopFeatures",value:function(e){try{this._stopFeaturesOnFrames(e,this._framesCache.frames)}catch(t){log.debug("Failed to stop features in FrameHandler.stopFeatures: "+t.message,t)}}},{key:"stopFeature",value:function(e){try{e.isRunning=!1,this._stopFeaturesOnFrames([e],this._framesCache.frames)}catch(t){log.debug("Failed to stop feature in FrameHandler.stopFeature: "+t.message,t)}}},{key:"updateFeatureConfig",value:function(e){e.instance.updateFeatureConfig&&this._updateFeaturesConfigOnFrames([e],this._framesCache.frames)}},{key:"_onFrameAdded",value:function(e){try{log.debug("Frame:"+e.name+", id:"+e.id+". was loaded."),this._framesCache.exists(e)?this._framesCache.unRegisterFrameFeatures(e,this._featuresList):this._framesCache.add(e),this._startFeaturesOnFrames([e],this._featuresList)}catch(t){log.warn("Failed to start features on frame "+e.id+": "+t.message,t)}}},{key:"_onFrameRemoved",value:function(e){try{log.debug("Frame:"+e.name+", id:"+e.id+". was removed."),this._stopFeaturesOnFrames(this._featuresList,[e])}catch(t){log.warn("Failed to stop features on frame "+e.id+": "+t.message,t)}}},{key:"_onFrameInaccessible",value:function(e){log.debug("Frame:"+e.name+", id:"+e.id+". was detected as inaccessible.")}},{key:"_buildFeaturesMap",value:function(e){var t=this;this._featuresList=[],e.forEach(function(e){t._featuresList.push(e)})}},{key:"_buildFramesCache",value:function(){var t=this;this._framesDetector.frames.forEach(function(e){t._framesCache.exists(e)||t._framesCache.add(e)})}},{key:"_startFeaturesOnFrames",value:function(e,s){var r=this;e.forEach(function(e){try{if(!r._cdUtils.DomUtils.canAccessIFrame(e))return;for(var t=0;t<s.length;t++){var n=s[t];n.shouldRun&&!r._framesCache.hasFeature(e,n)&&(r._framesCache.registerFrameFeature(e,n),he.CDUtils.DomUtils.isWindowDocumentReady(e.contentWindow)&&(log.debug("_startFeaturesOnFrames: run feature on frame:"+e.name+", id:"+e.id+". feature:"+n.configKey),r._runFeatureOnFrame.cdCallAsync(r,e,n),n.isRunning=!0))}}catch(i){log.error("An error has occurred while starting features on frame "+e.name+" with id: "+e.id+". Error: "+i.message,i)}})}},{key:"_runFeatureOnFrame",value:function(e,t){try{this._cdUtils.DomUtils.canAccessIFrame(e)?t.instance.startFeature(e.contentWindow):log.debug("Not starting features on frame "+e.name+" with id: "+e.id+" as it is not accessible")}catch(n){log.error("An error has occurred while starting feature "+t.configKey+" on frame "+e.name+" with id: "+e.id+". Error: "+n.message,n)}}},{key:"_stopFeaturesOnFrames",value:function(s,e){var r=this;try{e.forEach(function(e){try{if(!r._cdUtils.DomUtils.canAccessIFrame(e))return;if(e.contentWindow&&e.contentWindow.document)for(var t=0,n=s.length;t<n;t++)r._framesCache.hasFeature(e,s[t])&&r._stopFeatureOnFrame.cdCallAsync(r,e,s[t]),s[t].isRunning=!1}catch(i){log.error("An error has occurred while stopping features on frame "+e.name+" with id: "+e.id+". Error: "+i.message,i)}r._framesCache.exists(e)&&r._framesCache.unRegisterFrameFeatures(e,s),r._framesCache.remove(e)})}catch(t){log.warn("Failed stopping features on frames "+t.message,t)}}},{key:"_stopFeatureOnFrame",value:function(e,t){try{this._cdUtils.DomUtils.canAccessIFrame(e)?t.instance.stopFeature(e.contentWindow):log.debug("Not stopping feature "+t.configKey+" on frame "+e.name+" with id: "+e.id+" as it is not accessible")}catch(n){log.error("An error has occurred while stopping feature "+t.configKey+" "+func+" on frame "+e.name+" with id: "+e.id+". Error: "+n.message,n)}}},{key:"_updateFeaturesConfigOnFrames",value:function(s,e){var r=this;e.forEach(function(e){try{if(!r._cdUtils.DomUtils.canAccessIFrame(e))return;for(var t=0,n=s.length;t<n;t++)r._framesCache.hasFeature(e,s[t])&&r._updateFeatureConfigOnFrame.cdCallAsync(r,e,s[t])}catch(i){log.error("An error has occurred while updating features configuration on frame "+e.name+" with id: "+e.id+". Error: "+i.message,i)}})}},{key:"_updateFeatureConfigOnFrame",value:function(e,t){try{this._cdUtils.DomUtils.canAccessIFrame(e)?t.instance.updateFeatureConfig(e.contentWindow):log.debug("Not updating feature "+t.configKey+" config on frame "+e.name+" with id: "+e.id+" as it is not accessible")}catch(n){log.error("An error has occurred while updating feature "+t.configKey+" config on frame "+e.name+" with id: "+e.id+". Error: "+n.message,n)}}}]),i}(),he.FramesHandler=de,fe=Ye,pe=function(){function e(){Je(this,e),this._frames=new fe.Map}return Xe(e,[{key:"add",value:function(e){this._frames.set(e,{registered:!0,features:new fe.Map})}},{key:"remove",value:function(e){this.exists(e)&&0===this._frames.get(e).features.size&&this._frames["delete"](e)}},{key:"get",value:function(e){return this._frames.get(e)}},{key:"exists",value:function(e){return this._frames.has(e)&&this._frames.get(e).registered}},{key:"registerFrameFeature",value:function(e,t){this.exists(e)&&this._frames.get(e).features.set(t.configKey,!0)}},{key:"unRegisterFrameFeature",value:function(e,t){this.exists(e,t)&&this._frames.get(e).features["delete"](t.configKey)}},{key:"unRegisterFrameFeatures",value:function(e,t){for(var n=0;n<t.length;n++){var i=t[n];this.unRegisterFrameFeature(e,i)}}},{key:"hasFeature",value:function(e,t){return this.exists(e)&&this._frames.get(e).features.has(t.configKey)}},{key:"frames",get:function(){var n=[];return this._frames.forEach(function(e,t){n.push(t)}),n}},{key:"count",get:function(){return this._frames.size}}]),e}(),fe.FramesCache=pe,ve=Ye,_e=function(){function n(e,t){Je(this,n),this._mutationObserverFactory=e,this._cdUtils=t,this._windowMutationObservers=new ve.Map,this._loadedFrames=new ve.Map,this._framesToIgnore=new ve.Set,this._frameSelector="frame, iframe",this._frameLoadedCallback=this._onFrameLoad.bind(this),this.frameAdded=new ve.CDEvent,this.frameRemoved=new ve.CDEvent,this.frameInaccessible=new ve.CDEvent}return Xe(n,[{key:"start",value:function(e){var t=this;this._monitorWindow(e),this._findFrames(e.document).forEach(function(e){t._processNewFrame(e)})}},{key:"stop",value:function(){this._windowMutationObservers.forEach(function(e){e.disconnect()}),this._windowMutationObservers.clear(),this._loadedFrames.clear(),this._framesToIgnore.clear()}},{key:"addToIgnoreList",value:function(e){this._framesToIgnore.add(e)}},{key:"_monitorWindow",value:function(e){if(!this._windowMutationObservers.has(e)){var t=new this._mutationObserverFactory(this._mutationObserved.bind(this));t.observe(e.document,{childList:!0,subtree:!0}),this._windowMutationObservers.set(e,t)}}},{key:"_unMonitorWindow",value:function(e){var t=this._windowMutationObservers.get(e);t&&t.disconnect(),this._windowMutationObservers["delete"](e)}},{key:"_mutationObserved",value:function(e){var t=this;e.forEach(function(e){t._processMutation(e)})}},{key:"_processMutation",value:function(e){this._processAddedNodes(e.addedNodes),this._processRemovedNodes(e.removedNodes)}},{key:"_processAddedNodes",value:function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(this._cdUtils.DomUtils.matches(i,this._frameSelector))this._processNewFrame(i);else{if(!i.hasChildNodes())continue;this._findFrames(i).forEach(function(e){t._processNewFrame(e)})}}}},{key:"_processNewFrame",value:function(e){this._framesToIgnore.has(e.id)||this._loadedFrames.has(e)||(this._cdUtils.addEventListener(e,"load",this._frameLoadedCallback),this._cdUtils.DomUtils.canAccessIFrame(e)?this._cdUtils.DomUtils.isWindowDocumentReady(e.contentWindow)&&this._addFrame(e):this.frameInaccessible.publish(e))}},{key:"_addFrame",value:function(e){var t=this;this._monitorWindow(e.contentWindow),this._findFrames(e.contentWindow.document).forEach(function(e){t._processNewFrame(e)}),this._loadedFrames.set(e,e.contentDocument),this.frameAdded.publish(e)}},{key:"_processRemovedNodes",value:function(e){for(var t=this,n=0;n<e.length;n++){var i=e[n];if(this._cdUtils.DomUtils.matches(i,this._frameSelector))this._removeFrame(i);else{if(!i.hasChildNodes())continue;this._findFrames(i).forEach(function(e){t._removeFrame(e)})}}}},{key:"_removeFrame",value:function(e){this._unMonitorWindow(e.contentWindow),this._cdUtils.removeEventListener(e,"load",this._frameLoadedCallback),this._loadedFrames["delete"](e)&&this.frameRemoved.publish(e)}},{key:"_onFrameLoad",value:function(e){var t=e.target;this._loadedFrames.has(t)&&this._removeFrame(t),this._processNewFrame(t)}},{key:"_findFrames",value:function(e){for(var t=[],n=[],i=e.querySelectorAll(this._frameSelector),s=0;s<i.length;s++)n.push(i[s]);for(var r=0;r<n.length;r++){var o,a=n[r];t.push(a),this._cdUtils.DomUtils.canAccessIFrame(a)?0<(o=this._findFrames(a.contentWindow.document)).length&&(t=t.concat(o)):this.frameInaccessible.publish(a)}return t}},{key:"frames",get:function(){var n=[];return this._loadedFrames.forEach(function(e,t){n.push(t)}),n}}]),n}(),ve.FramesDetector=_e,(ge=Ye).FeaturesList={defaultFeatures:{MouseEvents:{configKey:"isMouseEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.MouseEvents.instance=new ge.MouseEvents(this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null},KeyEvents:{configKey:"isKeyEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.KeyEvents.instance=new ge.KeyEvents(this._configurationRepository,this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},TouchEvents:{configKey:"isTouchEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.defaultFeatures.TouchEvents.instance=new ge.TouchEvents(this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},MetadataCollector:{configKey:"isMetadataCollect",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){var e=new ge.SiteMapper(MutationObserver,this._utils,"metadataConfig",null,!1);this._features.defaultFeatures.MetadataCollector.instance=new ge.MetadataCollector(this._configurationRepository,this._dataQ,this._perfMonitor,e)},instance:null},TabsEvents:{configKey:"isTabsEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.defaultFeatures.TabsEvents.instance=new ge.TabsEvents(this._utils,this._dataQ)},instance:null}},perSessionFeatures:{DoNotTrack:{configKey:"isDoNotTrack",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.DoNotTrack.instance=new ge.DoNotTrackFeature(this._dataQ,this._perfMonitor)},instance:null},BrowserProps:{configKey:"collectBrowserProps",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.BrowserProps.instance=new ge.BrowserPropsFeature(this._dataQ,this._perfMonitor,ge.PointerHoverDetector,this._utils,this._configurationRepository)},instance:null},IsPrivateBrowsing:{configKey:"isPrivateBrowsing",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.IsPrivateBrowsing.instance=new ge.IsPrivateBrowsingFeature(this._dataQ,this._perfMonitor,new ge.PrivateBrowsingDetector)},instance:null},IpDetectorFeature:{configKey:"isIpCollection",shouldRun:!0,isFrameRelated:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.IpDetectorFeature.instance=new ge.IpDetectorFeature(this._dataQ,this._perfMonitor,this._configurationRepository)},instance:null},FontsDetectionFeature:{configKey:"isFonts",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.FontsDetectionFeature.instance=new ge.FontsDetectionFeature(this._utils,this._dataQ,this._perfMonitor,ge.FontsDetector)},instance:null},GraphicDetectFeature:{configKey:"isVMDetection",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.GraphicDetectFeature.instance=new ge.GraphicDetectFeature(this._dataQ,this._perfMonitor)},instance:null},AudioFeature:{configKey:"isAudioDetection",shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.AudioFeature.instance=new ge.AudioFeature(this._utils,this._dataQ,this._perfMonitor)},instance:null},BrowserDetect:{configKey:"isBrowserDetect",shouldRun:!0,isFrameRelated:!1,runInUns:!0,isRunning:!1,init:function(){this._features.perSessionFeatures.BrowserDetect.instance=new ge.BrowserDetect(this._dataQ,this._perfMonitor)},instance:null},FilesFeature:{configKey:"isFilesFeature",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.FilesFeature.instance=new ge.FilesFeature(this._configurationRepository,this._utils,this._sessionService,this._muidMgr,this._perfMonitor,this._cidCache)},instance:null},UserPermissions:{configKey:"isUserPermissions",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.UserPermissions.instance=new ge.UserPermissions(this._dataQ,this._perfMonitor)},instance:null},MediaDevicesFeature:{configKey:"isMediaDevices",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.perSessionFeatures.MediaDevicesFeature.instance=new ge.MediaDevicesFeature(this._dataQ,this._perfMonitor)},instance:null}},perContextFeatures:{ContextPropsFeature:{configKey:"isContextPropsFeature",shouldRun:!0,isFrameRelated:!1,isRunning:!1,runInUns:!0,init:function(){this._features.perContextFeatures.ContextPropsFeature.instance=new ge.ContextPropsFeature(this._dataQ,this._perfMonitor,this._utils)},instance:null},ScriptsFeature:{configKey:"isScriptsFeature",shouldRun:!0,isFrameRelated:!1,isRunning:!1,runInUns:!0,init:function(){this._features.perContextFeatures.ScriptsFeature.instance=new ge.ScriptsFeature(this._dataQ,this._scriptsRepository,this._perfMonitor)},instance:null}},perPageReloadFeatures:{},nonDefaultFeatures:{AccelerometerEvents:{configKey:"isAccelerometerEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.AccelerometerEvents.instance=new ge.AccelerometerEvents(this._configurationRepository,this._utils,this._sensorDataQ,this._perfMonitor)},instance:null},PinchZoomEvents:{configKey:"isPinchZoomEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.nonDefaultFeatures.PinchZoomEvents.instance=new ge.PinchZoomEvents(this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},ScriptEvents:{configKey:"isScriptExecuteEve",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.ScriptEvents.instance=new ge.ScriptEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},MouseChallengeFeature:{configKey:"isChallengeFeature",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){var e=new ge.SiteMapper(MutationObserver,this._utils,"challengeConfig");this._features.nonDefaultFeatures.MouseChallengeFeature.instance=new ge.MouseChallengeFeature(this._configurationRepository,this._utils,this._dataQ,e)},instance:null},NetInfoEvents:{configKey:"isNetInfoEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.NetInfoEvents.instance=new ge.NetInfoEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},ScreenOrientationEvents:{configKey:"isScreenOrientationEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.ScreenOrientationEvents.instance=new ge.ScreenOrientationEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},TapEvents:{configKey:"isTapEvents",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,init:function(){this._features.nonDefaultFeatures.TapEvents.instance=new ge.TapEvents(this._configurationRepository,this._utils,this._elements,this._dataQ,this._perfMonitor)},instance:null},VideoEvents:{configKey:"isVideoEvents",shouldRun:!1,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.VideoEvents.instance=new ge.VideoEvents(this._configurationRepository,this._utils,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},StorageEvents:{configKey:"isStorageEvents",shouldRun:!1,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.StorageEvents.instance=new ge.StorageEvents(this._utils,this._elements,this._dataQ,this._perfMonitor,this._msgBus)},instance:null},PrintEvents:{configKey:"isPrintEvents",shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.PrintEvents.instance=new ge.PrintEvents(this._utils,this._dataQ,this._perfMonitor)},instance:null},HistoryNavigationEvents:{configKey:"isHistoryNavigationEvent",shouldRun:!1,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.HistoryNavigationEvents.instance=new ge.HistoryNavigationEvents(this._dataQ,this._perfMonitor)},instance:null},LightSensorEvents:{configKey:"isLightSensor",shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,init:function(){this._features.nonDefaultFeatures.LightSensorEvents.instance=new ge.LightSensorEvents(this._dataQ,this._configurationRepository)},instance:null}}},me=Ye,ye=function(){function i(e,t,n){Je(this,i),this._features=e,this._frameHandler=t,this._configurationRepository=n,this.buildFrameRelatedLists()}return Xe(i,[{key:"buildFrameRelatedLists",value:function(){this._frameRelatedDefaultFeatures=this._collectFrameRelated(this._features.defaultFeatures),this._frameRelatedNonDefaultFeatures=this._collectFrameRelated(this._features.nonDefaultFeatures)}},{key:"runDefault",value:function(){log.info("Running default features"),this._runFeatures(this._features.defaultFeatures,this._frameRelatedDefaultFeatures)}},{key:"stopDefault",value:function(){log.info("Stopping default features"),this._stopFeatures(this._features.defaultFeatures,this._frameRelatedDefaultFeatures)}},{key:"runPerSessionFeatures",value:function(){log.info("Running per session features"),this._configurationRepository.isConfigurationUpdatedFromServer()?this._startFeatures(this._features.perSessionFeatures):log.info("We didn't receive configurations from the server yet. Skipping per session features start until configuration arrives.")}},{key:"stopPerSessionFeatures",value:function(){log.info("Stopping per session features"),this._stopFeatures(this._features.perSessionFeatures)}},{key:"runNonDefault",value:function(){log.info("Running non default features"),this._configurationRepository.isConfigurationUpdatedFromServer()?this._runFeatures(this._features.nonDefaultFeatures,this._frameRelatedNonDefaultFeatures):log.info("We didn't receive configurations from the server yet. Skipping non default features start until configuration arrives.")}},{key:"stopNonDefault",value:function(){log.info("Stopping non default features"),this._stopFeatures(this._features.nonDefaultFeatures,this._frameRelatedNonDefaultFeatures)}},{key:"runPerContextFeatures",value:function(e){log.info("Running per context features"),this._configurationRepository.isConfigurationUpdatedFromServer()?(this._runFeatures(this._features.perContextFeatures),"cd_auto"!==e.name&&this._frameRelatedDefaultFeatures&&this._frameHandler.startFeatures(this._frameRelatedDefaultFeatures)):log.info("We didn't receive configurations from the server yet. Skipping per context features start until configuration arrives.")}},{key:"stopPerContextFeatures",value:function(){log.info("Stopping per context features"),this._stopFeatures(this._features.perContextFeatures)}},{key:"stopAllFeatures",value:function(){log.info("Stopping all features"),this.stopDefault(),this.stopNonDefault(),this.stopPerSessionFeatures(),this.stopPerContextFeatures()}},{key:"updateRunByConfig",value:function(e){log.info("Updating features configuration"),this._updateFeatures(this._features.defaultFeatures,e),this._updateFeatures(this._features.nonDefaultFeatures,e),this._updateFeatures(this._features.perContextFeatures,e)}},{key:"_runFeatures",value:function(e,t){var n=this;for(var i in e)e.hasOwnProperty(i)&&e[i].shouldRun&&!e[i].isFrameRelated&&(e[i].instance.startFeature.cdCallAsync(e[i].instance,window.self),e[i].isRunning=!0);if(t){for(var s=0,r=t.length;s<r;s++)t[s].shouldRun&&(t[s].instance.startFeature.cdCallAsync(t[s].instance,window.self),t[s].isRunning=!0);this._frameHandler.startFeatures(t),me.CDUtils.DomUtils.onPageLoad(window,function(){n._frameHandler.startFeatures(t)})}}},{key:"_stopFeatures",value:function(e,t){for(var n in e)e.hasOwnProperty(n)&&(e[n].isFrameRelated||(e[n].instance.stopFeature&&e[n].instance.stopFeature.cdCallAsync(e[n].instance),e[n].isRunning=!1));if(t){for(var i=0,s=t.length;i<s;i++)t[i].instance.stopFeature.cdCallAsync(t[i].instance),t[i].isRunning=!1;this._frameHandler.stopFeatures(t)}}},{key:"_actOnFeature",value:function(e,t){e.isFrameRelated&&this._frameHandler[t](e),e.instance[t]&&e.instance[t].cdCallAsync(e.instance)}},{key:"_startFeatures",value:function(e){for(var t in e){var n=e[t],i=this._configurationRepository.get(n.configKey);"boolean"==typeof i&&(n.shouldRun=i),n.shouldRun&&(this._actOnFeature(n,"startFeature"),n.isRunning=!0)}}},{key:"_updateFeatures",value:function(e,t){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n],s=t.get(i.configKey);"boolean"==typeof s&&(i.shouldRun=s),i.isRunning&&!i.shouldRun?(this._actOnFeature(i,"stopFeature"),i.isRunning=!1):!i.isRunning&&i.shouldRun&&(this._actOnFeature(i,"startFeature"),i.isRunning=!0),i.isRunning&&this._actOnFeature(i,"updateFeatureConfig")}}},{key:"_collectFrameRelated",value:function(e){var t=[];for(var n in e)e.hasOwnProperty(n)&&e[n].isFrameRelated&&t.push(e[n]);return t}}]),i}(),me.FeatureService=ye,function(e){function i(e,t,n,i,s,r,o,a,u,c,l,h,d){this._features=e,this._configurationRepository=t,this._utils=n,this._elements=i,this._mutationObserver=s,this._dataQ=r,this._sessionService=o,this._muidMgr=a,this._perfMonitor=u,this._sensorDataQ=c,this._msgBus=l,this._scriptsRepository=h,this._cidCache=d}Object.extend(i,{BUILD_DEFAULT_ONLY:1,BUILD_NON_DEFAULT_ONLY:2,BUILD_PER_SESSION_ONLY:4,BUILD_PER_PAGE_RELOAD_ONLY:8,BUILD_PER_CONTEXT_ONLY:16}),i.BUILD_ALL=i.BUILD_DEFAULT_ONLY|i.BUILD_NON_DEFAULT_ONLY|i.BUILD_PER_SESSION_ONLY|i.BUILD_PER_PAGE_RELOAD_ONLY|i.BUILD_PER_CONTEXT_ONLY,i.prototype.buildFeatures=function(e){function t(e){for(var t in e)e.hasOwnProperty(t)&&e[t].init.apply(n)}var n=this;e&i.BUILD_DEFAULT_ONLY&&t(this._features.defaultFeatures),e&i.BUILD_PER_SESSION_ONLY&&t(this._features.perSessionFeatures),e&i.BUILD_NON_DEFAULT_ONLY&&t(this._features.nonDefaultFeatures),e&i.BUILD_PER_PAGE_RELOAD_ONLY&&t(this._features.perPageReloadFeatures),e&i.BUILD_PER_CONTEXT_ONLY&&t(this._features.perContextFeatures)},e.FeaturesBuilder=i}(Ye),Ee=Ye,be=function(){function i(e,t,n){Je(this,i),this._utils=e,this._contextSiteMapper=t,this.contextName="",this.referrer="",this.historyLen=-1,this.onContextChange=new Ee.CDEvent,this._contextSiteMapper.updateObserver(this.onSiteMapperMatch.bind(this)),this._workerComm=n}return Xe(i,[{key:"contextData",value:function(){return{contextId:this.contextId,url:this.url,name:this.contextName,referrer:this.referrer,hLength:this.historyLen,timestamp:this.timestamp}}},{key:"setContext",value:function(e){this.contextName=e.name,this._genContext(),this.url=e.url,this.referrer=e.referrer,this.historyLen=e.hLength,this.timestamp=e.timestamp,this._publishContext()}},{key:"changeContext",value:function(e){e?e!==this.contextName?(this.contextName=e,this._updateContext(),this._publishContext(),log.info("Context changed to "+e)):log.warn("Received context "+e+" but this is already the current context. Aborting operation."):log.error("Received an invalid context name "+e+". Aborting context change operation")}},{key:"onSiteMapperMatch",value:function(e){e.contextName!==this.contextName&&this.changeContext(e.contextName)}},{key:"_updateContext",value:function(){this._genContext(),this.url=this._utils.getDocUrl(),this.referrer=Ee.CDUtils.clearTextFromNumbers(document.referrer),this.historyLen=window.history.length,this.timestamp=this._utils.dateNow()}},{key:"_genContext",value:function(){this.contextId=this._utils.StorageUtils.getCookie("cdContextId"),this.contextId?this.contextId=parseInt(this.contextId):this.contextId=0,this._utils.StorageUtils.setCookie("cdContextId",this.contextId+1)}},{key:"_publishContext",value:function(){var e={contextName:this.contextName};this._workerComm.sendAsync(Ee.WorkerCommand.changeContextCommand,e),this.onContextChange.publish(this.contextData())}},{key:"initContextHandling",value:function(){this._contextSiteMapper.initTracking()}},{key:"clearContextHandling",value:function(){this._contextSiteMapper.stopTracking()}},{key:"onConfigUpdate",value:function(e){this._contextSiteMapper.onConfigUpdate(e)}},{key:"onSessionReset",value:function(){this._publishContext()}}]),i}(),Ee.ContextMgr=be,Te=Ye,Se=function(){function s(e,t,n,i){if(Je(this,s),!t)throw new Error("messageBus param must be defined");this._configurationLoadedCallback=null,this._configurationRepository=e,this._messageBus=t,this._cidCache=n,i&&i.addMessageListener(Te.WorkerEvent.ConfigurationLoadedEvent,this._onConfigurationLoadedEvent.bind(this))}return Xe(s,[{key:"updateLogUrlToWorker",value:function(e,t,n,i){if(i&&this._configurationRepository.set("logAddress",i),this._configurationRepository.get("logAddress")){var s={logAddress:this._configurationRepository.get("logAddress")+"?cid="+this._cidCache.get()+"&cdsnum="+e+"&csid="+t+"&ds=js&sdkVer="+Te.CDUtils.scriptVersion};n.sendAsync(Te.WorkerCommand.updateLogUrlCommand,s)}}},{key:"setServerUrl",value:function(e){this._configurationRepository.set("serverAddress",e);var t=e.indexOf("cid=")+4,n=e.indexOf("&",t);n=-1==n?undefined:n,this._cidCache.set(e.substring(t,n))}},{key:"setConfigurationLoadedCallback",value:function(e){this._configurationLoadedCallback=e}},{key:"_onConfigurationLoadedEvent",value:function(e){this._configurationRepository.loadConfigurations(e),this._configurationLoadedCallback&&this._configurationLoadedCallback(this._configurationRepository.get(Te.ConfigurationFields.isEnabled)),this._messageBus.publish(Te.MessageBusEventType.ConfigurationLoadedEvent,this._configurationRepository)}}]),s}(),Te.ConfigurationService=Se,function(t){t.ConfigurationFields={resetSessionApiThreshold:"resetSessionApiThreshold",dataWupDispatchRateSettings:"dataWupDispatchRateSettings",logWupDispatchRateSettings:"logWupDispatchRateSettings",forceDynamicDataWupDispatchSettings:"forceDynamicDataWupDispatchSettings",wupStatisticsLogIntervalMs:"wupStatisticsLogIntervalMs",serverCommunicationSettings:"serverCommunicationSettings",wupResponseTimeout:"wupResponseTimeout",wupMessageRequestTimeout:"wupMessageRequestTimeout",logMessageRequestTimeout:"logMessageRequestTimeout",collectKeyRegionValue:"collectKeyRegionValue",ipDetectorTimeout:"ipDetectorTimeout",crossDomainsList:"crossDomainsList",crossDomainsTimeout:"crossDomainsTimeout",isMutationObserver:"isMutationObserver",isEnabled:"isEnabled",slaveChannelHandshakeTimeout:"slaveChannelHandshakeTimeout",slaveAliveMessageInterval:"slaveAliveMessageInterval",collectElementDataAutomationId:"collectElementDataAutomationId"},t.ConfigurationDefaultTemplates={defaultDynamicWupDispatchRateConfiguration:{type:"dynamic"},defaultIncrementalWupDispatchRateConfiguration:{type:"incremental",initialRateValueMs:500,incrementStepMs:500,incrementStopMs:5e3,incrementStartWupSendCount:20}};var e=function(){function e(){Je(this,e),this._requireParseFields=new t.Map,this._requireParseFields.set(t.ConfigurationFields.dataWupDispatchRateSettings,t.ConfigurationFields.dataWupDispatchRateSettings),this._requireParseFields.set(t.ConfigurationFields.logWupDispatchRateSettings,t.ConfigurationFields.logWupDispatchRateSettings),this._requireParseFields.set(t.ConfigurationFields.serverCommunicationSettings,t.ConfigurationFields.serverCommunicationSettings),this._requireParseFields.set(t.ConfigurationFields.crossDomainsList,t.ConfigurationFields.crossDomainsList),this._configurationList={},this.configDefault={logLevel:t.Logger.LOG_LEVEL.INFO,isCrossdomain:!1,crossDomainsList:[],crossDomainsTimeout:5e3,orientationEventsSamplePeriod:300,orientationEventsThreshold:1,stateChangeEnabled:!1,accelerometerEventsSamplePeriod:0,dataQPassWorkerInterval:500,gyroEventsSamplePeriod:0,gyroEventsThreshold:.3,isContextPropsFeature:!0,isEnabled:!0,isResetEveryLoad:!1,isScrollCollect:!0,isUnsupportedReport:!0,isVMDetection:!0,isAudioDetection:!1,isHistoryNavigationEvent:!1,wupStatisticsLogIntervalMs:3e4,resetSessionApiThreshold:2e4,wupMessageRequestTimeout:5e3,logMessageRequestTimeout:5e3,slaveChannelHandshakeTimeout:1e4,slaveAliveMessageInterval:100,forceDynamicDataWupDispatchSettings:!0,dataWupDispatchRateSettings:t.ConfigurationDefaultTemplates.defaultDynamicWupDispatchRateConfiguration,logWupDispatchRateSettings:{type:"constant",initialRateValueMs:2500},serverCommunicationSettings:{sendRetryRate:1e3,queueLoadThreshold:100},ipDetectorTimeout:2e3,collectKeyRegionValue:!1,isMutationObserver:!0,collectElementDataAutomationId:!0},this.loadConfigurations(this.configDefault)}return Xe(e,[{key:"isConfigurationUpdatedFromServer",value:function(){return!this._isDefaultConfiguration}},{key:"loadConfigurations",value:function(e){for(var t in this._isDefaultConfiguration=e===this.configDefault,e)if(e.hasOwnProperty(t)){var n=e[t];if(this._requireParseFields.has(t)){var i=this._tryParseConfigurationValue(n);i&&(n=i)}this._configurationList[t]=n}}},{key:"get",value:function(e){return this._configurationList[e]}},{key:"set",value:function(e,t){this._configurationList[e]=t}},{key:"getAll",value:function(){return this._configurationList}},{key:"_tryParseConfigurationValue",value:function(e){if("string"!=typeof e)return null;try{return JSON.parse(e)}catch(t){}return null}}]),e}();t.ConfigurationRepository=e}(Ye),function(o){function e(e,t,n,i,s){var r=this;this._sendQToServerWorker=function(){try{this._Q.length&&(this._serverWorkerCommunicator.sendAsync(this._msgToWorker,this._Q),this._Q=[])}catch(e){log.error("Failed sending data to worker. "+e),this._sendQInSingleMessagesToServerWorker()}},this._sendQInSingleMessagesToServerWorker=function(){for(var e=0;e<this._Q.length;e++)try{this._serverWorkerCommunicator.sendAsync(this._msgToWorker,this._Q[e])}catch(t){log.error("Failed sending single message data to worker. "+t)}this._Q=[]},this._onUnload=function(){this._Q.push({eventName:"flushData"}),this._sendQToServerWorker()},this._serverWorkerCommunicator=e,this._contextManager=t,this._passToWorkerInterval=s||0,this._intervalConfigKey=n,this._msgToWorker=i,this._Q=[],this._passToWorkerInterval&&(this._intervalId=setInterval(this._sendQToServerWorker.bind(this),this._passToWorkerInterval)),o.CDUtils.addEventListener(window,"beforeunload",function(){r._onUnload()},!0)}e.prototype.addToQueue=function(e,t,n,i){(n=!(n!==undefined&&null!==n&&!0!==n))&&t.push&&(t[0]=this._contextManager.contextId),0!==this._passToWorkerInterval?(this._Q.push({eventName:e,data:t,shouldFlush:i}),i&&this._sendQToServerWorker()):this._serverWorkerCommunicator.sendAsync(this._msgToWorker,{eventName:e,data:t,shouldFlush:i})},e.prototype.updateWithConfig=function(e){var t=e.get(this._intervalConfigKey);t!==undefined&&t!==this._passToWorkerInterval&&(this._passToWorkerInterval=t,clearInterval(this._intervalId),this._intervalId=null,0!==this._passToWorkerInterval&&(this._intervalId=setInterval(this._sendQToServerWorker.bind(this),this._passToWorkerInterval)))},o.DataQ=e}(Ye),Me=Ye,we=function(){function i(e,t,n){Je(this,i),this._featureMgr=e,this._dataQ=n,this._configurationRepository=t,this._pauseResumeEnabled=t.get("stateChangeEnabled")||!1,this._sdkState=i.STATE.RUNNING}return Xe(i,[{key:"onResume",value:function(){this._sdkState===i.STATE.PAUSED?(log.info("Resuming JS SDK"),this._featureMgr.updateRunByConfig(this._configurationRepository),this._sdkState=i.STATE.RUNNING):log.warn("PauseResumeManager:onResume - resume api called when SDK already running")}},{key:"onPause",value:function(){this._sdkState===i.STATE.RUNNING?(log.info("Pausing JS SDK"),this._featureMgr.stopAllFeatures(),this._sdkState=i.STATE.PAUSED):log.warn("Pause api called when SDK already paused")}},{key:"onStateChange",value:function(e){e.toState&&this._verifyApiAllowed(e.toState)&&("pause"===e.toState?this.onPause():"run"===e.toState?this.onResume():log.warn("stateChange api called with non valid toState: "+e.toState))}},{key:"isCustomerApiEnabled",value:function(){return this._sdkState===i.STATE.RUNNING}},{key:"_verifyApiAllowed",value:function(e){return!!this._pauseResumeEnabled||(this._dataQ.addToQueue("forbidden_api_call",[null,e]),!1)}},{key:"onConfigUpdate",value:function(){this._pauseResumeEnabled=this._configurationRepository.get("stateChangeEnabled")||!1,!1===this._configurationRepository.get("isEnabled")&&this.onPause()}}]),i}(),Object.extend(we,{STATE:{RUNNING:0,PAUSED:1}}),Me.PauseResumeManager=we,Ce=Ye,ke=function(){function r(e,t,n,i){var s=!(4<arguments.length&&arguments[4]!==undefined)||arguments[4];Je(this,r),this._mutationObserver=e,this._siteMapKey=n,this._keyUrl=n+"_isUrlNonMasked",this._stopOnFirstMappingMatch=s,this._siteMap=null,this._observers=[],this._utils=t,this._onMatchCB=i,this._maxMappings=200,this._maxTriggers=10}return Xe(r,[{key:"updateObserver",value:function(e){this._onMatchCB=e}},{key:"_observeChange",value:function(e,t){if(e)try{var n=window.document.querySelector(e);if(n){var i=new this._mutationObserver(function(e){0<e.length&&t()});i.observe(n,{childList:!0,characterData:!0,attributes:!0,subtree:!0}),this._observers.push(i)}else log.error("Selector:"+JSON.stringify(e)+" not found on page. Check "+this._siteMapKey+" configuration")}catch(s){log.error("SiteMapper._observeChange: "+s.message,s)}}},{key:"initTracking",value:function(){var s=this,r=function r(){try{for(var e=0;e<s._siteMap.mappings.length;e++){var t=s._siteMap.mappings[e];if(!t.url||-1<s._url.indexOf(t.url))if(t.selector){var n=window.document.querySelector(t.selector);if(n)if(t.byText){if((n.innerText!==undefined&&-1!==n.innerText.indexOf(t.byText)||n.value===t.byText||n.textContent===t.byText)&&(s._onMatchCB(t),s._stopOnFirstMappingMatch))return}else if(s._onMatchCB(t),s._stopOnFirstMappingMatch)return}else if(-1<s._url.indexOf(t.url)&&(s._onMatchCB(t),s._stopOnFirstMappingMatch))return}}catch(i){log.error("SiteMapper:testQuerySelector failed. ex:"+i.message,i)}};if(!this._siteMap){var e=this._utils.StorageUtils.getFromSessionStorage(this._siteMapKey);e&&e.triggers.length<=this._maxTriggers&&e.mappings.length<=this._maxMappings&&(this._siteMap=e),this._isNonMaskedUrl=this._utils.StorageUtils.getFromSessionStorage(this._keyUrl)}this._siteMap&&(this._url=this._isNonMaskedUrl?window.document.location.href:this._utils.getDocUrl(),this._utils.DomUtils.onDocumentBody(window,function(){s._mutationObserver&&s._siteMap.triggers.forEach(function(e){(!e.url||-1<s._url.indexOf(e.url))&&s._observeChange(e.selector,r)}),r()}))}},{key:"onConfigUpdate",value:function(e){try{if(!this._siteMap&&e.get(this._siteMapKey)){this.stopTracking();var t=e.get(this._siteMapKey)&&JSON.parse(e.get(this._siteMapKey));this._isNonMaskedUrl=e.get("useNonMaskedUrlInMappings"),t&&t.triggers.length<=this._maxTriggers&&t.mappings.length<=this._maxMappings?(this._siteMap=t,this._utils.StorageUtils.saveToSessionStorage(this._siteMapKey,this._siteMap),this._utils.StorageUtils.saveToSessionStorage(this._keyUrl,this._isNonMaskedUrl),this.initTracking()):log.warn("Configuration "+this._siteMapKey+" contains an illegal amount of triggers or mappings. Max Allowed Triggers: "+this._maxTriggers+", Max Allowed Mappings: "+this._maxMappings)}}catch(n){log.error("SiteMapper:onConfigUpdate: "+n.message,n)}}},{key:"stopTracking",value:function(){for(var e=0;e<this._observers.length;e++)this._observers[e].disconnect();this._observers=[],this._siteMap=null}}]),r}(),Ce.SiteMapper=ke,Fe=Ye,De=null,Re=function Re(e){return null===De&&(De=new Pe(e)),De},Pe=function(){function t(e){Je(this,t),this._utils=e,this.handle=this._handle.bind(this),this.subscribers=[],this.subscribe=this.subscribe.bind(this),this._selector=null,this._elementBindingWMap=new WeakMap}return Xe(t,[{key:"start",value:function(e,n){var i=this,t=(n=n||window.self).document||n.contentDocument;this._selector=e,Array.from(t.querySelectorAll(e)).forEach(function(e){if(i.hasjQueryAutoTab(e,n)){if(i._elementBindingWMap.get(e))return;var t=function t(e){i.handle(e,n)};i._utils.addEventListener(e,"keypress",t),i._elementBindingWMap.set(e,{isBinded:!0,listener:t})}})}},{key:"_stop",value:function(e){var n=this,t=(e=e||window.self).document||e.contentDocument;Array.from(t.querySelectorAll(this._selector)).forEach(function(e){var t=n._elementBindingWMap.get(e);t&&t.isBinded&&(n._utils.removeEventListener(e,"keypress",t.listener),n._elementBindingWMap["delete"](e))})}},{key:"stop",value:function(e){return this._stop(e),!0}},{key:"subscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)if(this.subscribers[t].handler===e)return;this.subscribers.push({handler:e})}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)this.subscribers[t].handler===e&&delete this.subscribers[t]}},{key:"hasjQueryAutoTab",value:function(e,t){if(!t.jQuery||!t.jQuery._data)return!1;if("undefined"==typeof t.jQuery._data(e,"events"))return!1;for(var n=Object.keys(t.jQuery._data(e,"events")),i=0;i<n.length;i++)if(-1!==n[i].indexOf("autotab"))return!0;return!1}},{key:"_handle",value:function(e,t){var n=this.hasjQueryAutoTab(e.target,t)?"autotab":"";if("autotab"===n){var i="insertText",s=e.key;if(8!=e.keyCode||(i="deleteContentBackward",s=null,"autotab"!==n))for(var r=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:s,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:i,isComposing:!1,isTrusted:!0,jQueryMask:n,returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timestamp:e.timestamp,type:"input",view:null,which:0}),o=0;o<this.subscribers.length;o++)this.subscribers[o].handler(r)}}}]),t}(),Fe.CustomInputFieldsEventHandler=Re,Le=Ye,Oe=null,Ne=function Ne(e){return null===Oe&&(Oe=new Ae(e)),Oe},Ae=function(){function t(e){Je(this,t),this._utils=e,this.handle=this._handle.bind(this),this.subscribers=[],this.subscribe=this.subscribe.bind(this),this._selector=null,this._elementBindingWMap=new WeakMap}return Xe(t,[{key:"start",value:function(e,n){var i=this,t=(n=n||window.self).document||n.contentDocument;this._selector=e,Array.from(t.querySelectorAll(e)).forEach(function(e){if(i.hasUnmaskEvent(e,n)){if(i._elementBindingWMap.get(e))return;var t=function t(e){i.handle(e,n)};i._utils.addEventListener(e,"keypress",t),i._elementBindingWMap.set(e,{isBinded:!0,listener:t})}})}},{key:"_stop",value:function(e){var n=this,t=(e=e||window.self).document||e.contentDocument;Array.from(t.querySelectorAll(this._selector)).forEach(function(e){var t=n._elementBindingWMap.get(e);t&&t.isBinded&&(n._utils.removeEventListener(e,"keypress",t.listener),n._elementBindingWMap["delete"](e))})}},{key:"stop",value:function(e){return this._stop(e),!0}},{key:"subscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)if(this.subscribers[t].handler===e)return;this.subscribers.push({handler:e})}},{key:"unsubscribe",value:function(e){for(var t=0;t<this.subscribers.length;t++)this.subscribers[t].handler===e&&delete this.subscribers[t]}},{key:"hasUnmaskEvent",value:function(e,t){if(!t.jQuery||!t.jQuery._data)return!1;var n=t.jQuery._data(e,"events");if("undefined"==typeof n)return!1;for(var i=Object.keys(n),s=0;s<i.length;s++)if("unmask"===i[s])return!0;return!1}},{key:"_handle",value:function(e,t){var n=this.hasUnmaskEvent(e.target,t)?"maskedInput":"";if("maskedInput"===n)for(var i=e.key,s=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:i,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:"insertText",isComposing:!1,isTrusted:!0,jQueryMask:n,returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timestamp:e.timestamp,type:"input",view:null,which:0}),r=0;r<this.subscribers.length;r++)this.subscribers[r].handler(s)}}]),t}(),Le.CustomMaskedInputFieldsEventHandler=Ne,Ye.CDWPTCD=function(n){var r={};function __webpack_require__(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,__webpack_require__),t.l=!0,t.exports}return __webpack_require__.m=n,__webpack_require__.c=r,__webpack_require__.d=function(e,t,n){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(t,e){if(1&e&&(t=__webpack_require__(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(__webpack_require__.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)__webpack_require__.d(n,r,function(e){return t[e]}.bind(null,r));return n},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e["default"]}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="",__webpack_require__(__webpack_require__.s=47)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(DataCollector,function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(1))["default"]),r(DataCollector,[{key:"startFeature",value:function startFeature(){}},{key:"stopFeature",value:function stopFeature(){}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){}},{key:"sendToQueue",value:function sendToQueue(){}}]),DataCollector);function DataCollector(e){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,DataCollector),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(DataCollector.__proto__||Object.getPrototypeOf(DataCollector)).call(this,e))}t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=n(2),s=n(3);var a=(r(Event,[{key:"getEventTimestamp",value:function getEventTimestamp(){return this.getExports().CDUtils.dateNow()}},{key:"getTimestampFromEvent",value:function getTimestampFromEvent(e){return e.timeStamp?this.getExports().CDUtils.cutDecimalPointDigits(e.timeStamp,3):0}},{key:"handlerProlog",value:function handlerProlog(e){log.isDebug()&&this._perfMonitor.startMonitor(e)}},{key:"handlerEpilog",value:function handlerEpilog(e){log.isDebug()&&this._perfMonitor.stopMonitor(e)}},{key:"handlerCancelog",value:function handlerCancelog(e){log.isDebug()&&this._perfMonitor.cancelMonitor(e)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){}}]),Event);function Event(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Event),this._perfMonitor=e,this.session=(0,i.inject)("Session")}t["default"]=(0,s.WithExportsMixin)(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serviceContainer=undefined,t.inject=function inject(e){var t="service:"+e;return i.lookup(t)},t.register=function register(e,t){var n="service:"+e;i.lookup(n)||(i.register(n,t),(0,r["default"])(t));return i.lookup(n)};var r=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(3));var i=null;t.serviceContainer=function na(e){i=i||e};var s=function s(e){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var t="service:"+e;return i.lookup(t)||(i.register(t,this),(0,r["default"])(this)),i.lookup(t)};t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i={};t.injectExports=function Fa(e){i=e},t.WithExportsMixin=function Ga(e){return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(_class2,e),r(_class2,[{key:"getExports",value:function getExports(){return i}}]),_class2;function _class2(){return function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_class2),function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(_class2.__proto__||Object.getPrototypeOf(_class2)).apply(this,arguments))}};t["default"]=function(e){e.exports=i}},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=null,i=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(Container,[{key:"register",value:function register(e,t){var n=this.normalize(e);if(r.hasOwnProperty(n))throw new Error(n+" has already been registered");r[n]=t}},{key:"keys",value:function keys(){return Object.keys(r)}},{key:"lookup",value:function lookup(e){var t=this.normalize(e);return r.hasOwnProperty(t)?r[t]:null}},{key:"normalize",value:function normalize(e){return e.toLowerCase()}},{key:"toString",value:function toString(){return this.keys().join(",")}}]),Container);function Container(){var e=0<arguments.length&&arguments[0]!==undefined?arguments[0]:{};!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Container),r=Object.create(e)}t["default"]=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=_interopRequireDefault(n(16)),i=_interopRequireDefault(n(10)),s=_interopRequireDefault(n(8)),o=_interopRequireDefault(n(11)),u=_interopRequireDefault(n(12)),l=_interopRequireDefault(n(1)),c=_interopRequireDefault(n(6)),d=_interopRequireDefault(n(0)),f=_interopRequireDefault(n(7)),v=_interopRequireDefault(n(13)),h=_interopRequireDefault(n(14)),E=_interopRequireDefault(n(9)),p=_interopRequireDefault(n(17)),m=_interopRequireDefault(n(18)),_=n(2),g=n(11),y=_interopRequireDefault(g),b=n(13),C=_interopRequireDefault(b),w=n(14),O=_interopRequireDefault(w),S=n(12),M=_interopRequireDefault(S);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var B={};B.Index=r["default"],B.WindowEventCollector=i["default"],B.OrientationEventCollector=s["default"],B.InputEvents=o["default"],B.FormEvents=u["default"],B.Event=l["default"],B.ElementEventCollector=c["default"],B.DataCollector=d["default"],B.ClipboardEventCollector=f["default"],B.ClickEvents=v["default"],B.ChangeEvents=h["default"],B.BeforeInstallPromptEventCollector=E["default"];var k={defaultFeatures:[{name:"ClipboardEvents",className:B.ClipboardEventCollector,init:function init(){return function(){var e=new B.ClipboardEventCollector.Builder(this._utils,this._elements,this._dataQ,this._perfMonitor);e.withMessageBus((0,_.inject)("MessageBus")).withCutEventEmitter((0,_.inject)("CutEventEmitter")).withCopyEventEmitter((0,_.inject)("CopyEventEmitter")).withPasteEventEmitter((0,_.inject)("PasteEventEmitter")),this._features.defaultFeatures.ClipboardEvents.instance=e.build()}}},{name:"ElementEvents",className:B.ElementEventCollector,init:function init(r){return function(){var e=new r.SiteMapper(MutationObserver,this._utils,"jQueryElementListenerConfig",null,!1),t=(0,p["default"])((0,_.inject)("StandardInputEventsEmitter"),(0,_.inject)("StandardOnClickEventsEmitter"),(0,_.inject)("StandardOnChangeEventsEmitter"),(0,_.inject)("StandardOnFormEventsEmitter")),n=new B.ElementEventCollector.Builder(this._configurationRepository,this._utils,this._elements,this._dataQ,this._perfMonitor);n.withjQueryElementListenerSiteMapper(e),n.withMessageBus((0,_.inject)("MessageBus")),n.withMutationEmitter((0,_.inject)("MutationEmitter")),n.withjQueryElementsHandler(t),n.withInputEvents(y["default"],g.inputSelectors),n.withStandardInputEventsEmitter((0,_.inject)("StandardInputEventsEmitter")),n.withSyntheticMaskInputEventsHandler((0,_.inject)("SyntheticMaskInputEventsHandler")),n.withSyntheticAutotabInputEventsHandler((0,_.inject)("SyntheticAutotabInputEventsHandler")),n.withClickEvents(C["default"],b.onClickSelectors),n.withStandardOnClickEventsEmitter((0,_.inject)("StandardOnClickEventsEmitter")),n.withChangeEvents(O["default"],w.onChangeSelectors),n.withStandardOnChangeEventsEmitter((0,_.inject)("StandardOnChangeEventsEmitter")),n.withFormEvents(M["default"],S.onFormSelectors),n.withStandardOnFormEventsEmitter((0,_.inject)("StandardOnFormEventsEmitter")),this._features.defaultFeatures.ElementEvents.instance=n.build()}}},{name:"WindowEvents",className:B.WindowEventCollector,init:function init(){return function(){var e=new B.WindowEventCollector.Builder(this._configurationRepository,this._utils,this._dataQ,this._perfMonitor);e.withMessageBus((0,_.inject)("MessageBus")),e.withFocusEventEmitter((0,_.inject)("FocusEventEmitter")),e.withBlurEventEmitter((0,_.inject)("BlurEventEmitter")),e.withResizeEventEmitter((0,_.inject)("ResizeEventEmitter")),e.withDOMContentLoadedEventEmitter((0,_.inject)("DOMContentLoadedEventEmitter")),e.withVisibilityChangeEventEmitter((0,_.inject)("VisibilityChangeEventEmitter")),e.withScrollEventEmitter((0,_.inject)("ScrollEventEmitter")),this._features.defaultFeatures.WindowEvents.instance=e.build()}}}],perContextFeatures:[{name:"ElementEvents",className:B.ElementEventCollector,init:function init(){this._features.perContextFeatures.ElementEvents.instance=this._features.defaultFeatures.ElementEvents.instance}}],nonDefaultFeatures:[{name:"CrossDomain",className:m["default"],init:function init(t){return function(){var e=new m["default"].Builder(this._configurationRepository,this._dataQ,this._perfMonitor,this._utils,t.Map,t.DataMappingDefs.CROSS_MUID_EVENT_MAP,t.EnumDefs.Events.crossmuidEventType);e.withMessageBus((0,_.inject)("MessageBus")),e.withWindowMessageEventEmitter((0,_.inject)("WindowMessageEventEmitter")),this._features.nonDefaultFeatures.CrossDomain.instance=e.build()}}},{name:"OrientationEvents",className:B.OrientationEventCollector,init:function init(){return function(){this._features.nonDefaultFeatures.OrientationEvents.instance=new B.OrientationEventCollector(this._configurationRepository,this._utils,this._sensorDataQ,this._perfMonitor,(0,_.inject)("MessageBus"),(0,_.inject)("DeviceOrientationEventEmitter"))}}},{name:"BeforeInstallPromptEvents",className:B.BeforeInstallPromptEventCollector,init:function init(){return function(){this._features.nonDefaultFeatures.BeforeInstallPromptEvents.instance=new B.BeforeInstallPromptEventCollector(this._dataQ,this._utils,(0,_.inject)("MessageBus"),(0,_.inject)("BeforeInstallPromptEventEmitter"))}}}]},T=function T(t,n){var r=!0;return Object.keys(t).forEach(function(e){n.hasOwnProperty(e)&&n[e]===t[e]&&(r=!1)}),r};t["default"]=function(i,s){k.defaultFeatures.forEach(function(e){var t="defaultFeatures",n=e.className.getDefaultSettings()[t];if(!("object"===(void 0===s?"undefined":a(s))&&0<Object.keys(s).length&&T(s,n))){var r=e.name;n.init=e.init(i),i.FeaturesList[t][r]=n}}),k.perContextFeatures.forEach(function(e){var t="perContextFeatures",n=e.className.getDefaultSettings()[t];if(!("object"===(void 0===s?"undefined":a(s))&&0<Object.keys(s).length&&T(s,n))){var r=e.name;n.init=e.init,i.FeaturesList[t][r]=n}}),k.nonDefaultFeatures.forEach(function(e){var t="nonDefaultFeatures",n=e.className.getDefaultSettings()[t];if(!("object"===(void 0===s?"undefined":a(s))&&0<Object.keys(s).length&&T(s,n))){var r=e.name;n.init=e.init(i),i.FeaturesList[t][r]=n}})}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s={defaultFeatures:{configKey:"isElementsEvent",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,instance:null},perContextFeatures:{configKey:"isElementsEvent",shouldRun:!0,isFrameRelated:!1,runInUns:!1,isRunning:!0,instance:null}},a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ElementEventCollector,i["default"]),r(ElementEventCollector,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return s}},{key:"Builder",get:function get(){function Builder(e,t,n,r,i){_classCallCheck(this,Builder),this.configurationRepository=e,this.utils=t,this.elements=n,this.dataQ=r,this.perfMonitor=i}return r(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return this.messageBus=e,this}},{key:"withMutationEmitter",value:function withMutationEmitter(e){return this.mutationEmitter=e,this}},{key:"withjQueryElementListenerSiteMapper",value:function withjQueryElementListenerSiteMapper(e){return this.jQueryElementListenerSiteMapper=e,this}},{key:"withjQueryElementsHandler",value:function withjQueryElementsHandler(e){return this.JqueryElementsHandler=e,this}},{key:"withInputEvents",value:function withInputEvents(e,t){return this.InputEvents=e,this.inputSelectors=t,this}},{key:"withStandardInputEventsEmitter",value:function withStandardInputEventsEmitter(e){return this.StandardInputEventsEmitter=e,this}},{key:"withSyntheticMaskInputEventsHandler",value:function withSyntheticMaskInputEventsHandler(e){return this.SyntheticMaskInputEventsHandler=e,this}},{key:"withSyntheticAutotabInputEventsHandler",value:function withSyntheticAutotabInputEventsHandler(e){return this.SyntheticAutotabInputEventsHandler=e,this}},{key:"withClickEvents",value:function withClickEvents(e,t){return this.ClickEvents=e,this.onClickSelectors=t,this}},{key:"withStandardOnClickEventsEmitter",value:function withStandardOnClickEventsEmitter(e){return this.StandardOnClickEventsEmitter=e,this}},{key:"withChangeEvents",value:function withChangeEvents(e,t){return this.ChangeEvents=e,this.onChangeSelectors=t,this}},{key:"withStandardOnChangeEventsEmitter",value:function withStandardOnChangeEventsEmitter(e){return this.StandardOnChangeEventsEmitter=e,this}},{key:"withFormEvents",value:function withFormEvents(e,t){return this.FormEvents=e,this.onFormSelectors=t,this}},{key:"withStandardOnFormEventsEmitter",value:function withStandardOnFormEventsEmitter(e){return this.StandardOnFormEventsEmitter=e,this}},{key:"build",value:function build(){return new ElementEventCollector(this)}}]),Builder}}]),r(ElementEventCollector,[{key:"stopFeature",value:function stopFeature(e){e=e||window.self,this._inputEvents.unbind(e),this._clickEvents.unbind(e),this._changeEvents.unbind(e),this._formEvents.unbind(e),this._jQueryElementListenerSiteMapper.stopTracking(),this._mutationEmitter.stopObserver(e)}},{key:"updateFeatureConfig",value:function updateFeatureConfig(e){e=e||window.self,this._configurationRepository.get("isMutationObserver")&&this._mutationEmitter&&(this._mutationEmitter.startObserver(e),this._jQueryElementListenerSiteMapper.onConfigUpdate(this._configurationRepository)),this._isHashedValue=this._configurationRepository.get("isElementHashedValue")!==undefined?this._configurationRepository.get("isElementHashedValue"):this._isHashedValue,this._hashTruncationLength=this._configurationRepository.get("elementHashTruncationLength")!==undefined?this._configurationRepository.get("elementHashTruncationLength"):this._hashTruncationLength,this._elements.updateFeatureConfig()}},{key:"sendToQueue",value:function sendToQueue(e,t){var n=this.getExports().EnumDefs.Events.isTrusted[e.isTrusted],r=this.getEventTimestamp(e),i=this.getTimestampFromEvent(e),s=this.getExports().EnumDefs.Events.elementEventType[e.type];this._utils.isUndefinedNull(s)&&(s=-1);var a=this._elements.getElement(e.target),o=this._utils.StorageUtils.getAndUpdateEventSequenceNumber();(t=t||{}).elementValues&&t.elementValues.length>this._maxElemValLength&&(t.elementValues="");var u=this._isHashedValue&&(e.target.value||e.target.innerHTML)?this._utils.getTruncatedHash(e.target.value,this._hashTruncationLength):"";Object.extend(t,{eventType:s,eventSequence:o,timestamp:r,elementHash:a,isTrusted:n,hashedValue:u,relativeTime:i}),this._dataQ.addToQueue("element_events",this._utils.convertToArrayByMap(this.getExports().DataMappingDefs.ELEMENT_EVENT_MAP,t),!0)}}]),ElementEventCollector);function ElementEventCollector(e){_classCallCheck(this,ElementEventCollector);var i=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ElementEventCollector.__proto__||Object.getPrototypeOf(ElementEventCollector)).call(this,e.perfMonitor));return i.mutationMessageHandler=function(e){e.frame&&(i._inputEvents.addOnLoadInputData(e.frame,!0),i._inputEvents.bind(e.frame),i._clickEvents.bind(e.frame),i._changeEvents.bind(e.frame),i._formEvents.bind(e.frame))},i.startFeature=function(e){e=e||window.self,i._inputEvents.addOnLoadInputData(e,!1),i._inputEvents.bind(e),i._clickEvents.bind(e),i._changeEvents.bind(e),i._formEvents.bind(e),i._configurationRepository.get(i.getExports().ConfigurationFields.isMutationObserver)&&i._mutationEmitter&&(i._mutationEmitter.startObserver(e),i._jQueryElementListenerSiteMapper.initTracking())},i._onSiteMapperMatch=function(e){var t=e.selector;if(t)try{var n=window.document.querySelector(t);if(!n)return void log.error("ElementEvents._onSiteMapperMatch - selector:"+JSON.stringify(t)+" not found on page");if(i._utils.DomUtils.matches(n,i._inputSelectors))i._jqueryEventHandler.bindInputEvents(n);else if(i._utils.DomUtils.matches(n,i._onClickSelectors))i._jqueryEventHandler.bindOnClickEvents(n);else if(i._utils.DomUtils.matches(n,i._onChangeSelectors))i._jqueryEventHandler.bindOnChangeEvents(n);else{if(!i._utils.DomUtils.matches(n,i._onFormSelectors))return void log.error("ElementEvents._onSiteMapperMatch - Unable to match the element with selector:\n                "+JSON.stringify(t)+" to any selectors group. Aborting jQuery element listening process.");i._jqueryEventHandler.bindOnFormsEvents(n)}}catch(r){log.error("ElementEvents._onSiteMapperMatch - "+r.message,r)}else log.warn("ElementEvents._onSiteMapperMatch - No selector defined for match. Aborting jQuery element listening process.")},i._configurationRepository=e.configurationRepository,i._utils=e.utils,i._dataQ=e.dataQ,i._perfMonitor=e.perfMonitor,i._elements=e.elements,i._jQueryElementListenerSiteMapper=e.jQueryElementListenerSiteMapper,i._jQueryElementListenerSiteMapper.updateObserver(i._onSiteMapperMatch),i._messageBus=e.messageBus,i._mutationEmitter=e.mutationEmitter,i._messageBus.subscribe(i._messageBus.getChannels().MUTATIONSINGLE,i.mutationMessageHandler),i._StandardInputEventsEmitter=e.StandardInputEventsEmitter,i._SyntheticMaskInputEventsHandler=e.SyntheticMaskInputEventsHandler,i._SyntheticAutotabInputEventsHandler=e.SyntheticAutotabInputEventsHandler,i._inputEvents=new e.InputEvents(i._perfMonitor,i._elements,i.sendToQueue.bind(i),i._utils,i._messageBus,i._StandardInputEventsEmitter,i._SyntheticMaskInputEventsHandler,i._SyntheticAutotabInputEventsHandler),i._inputSelectors=e.inputSelectors,i._StandardOnClickEventsEmitter=e.StandardOnClickEventsEmitter,i._clickEvents=new e.ClickEvents(i._perfMonitor,i.sendToQueue.bind(i),i._utils,i._messageBus,i._StandardOnClickEventsEmitter),i._onClickSelectors=e.onClickSelectors,i._StandardOnChangeEventsEmitter=e.StandardOnChangeEventsEmitter,i._changeEvents=new e.ChangeEvents(i._perfMonitor,i.sendToQueue.bind(i),i._utils,i._messageBus,i._StandardOnChangeEventsEmitter),i._onChangeSelectors=e.onChangeSelectors,i._StandardOnFormEventsEmitter=e.StandardOnFormEventsEmitter,i._formEvents=new e.FormEvents(i._perfMonitor,i.sendToQueue.bind(i),i._messageBus,i._StandardOnFormEventsEmitter),i._onFormSelectors=e.onFormSelectors,i._jqueryEventHandler=e.JqueryElementsHandler,i._maxElemValLength=200,i._isHashedValue=i._configurationRepository.get("isElementHashedValue")||!1,i._hashTruncationLength=i._configurationRepository.get("elementHashTruncationLength")||2,i}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s={defaultFeatures:{configKey:"isClipboardEvent",shouldRun:!0,isFrameRelated:!0,runInUns:!1,runInSlave:!0,isRunning:!1,instance:null}},a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ClipboardEventCollector,i["default"]),r(ClipboardEventCollector,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return s}},{key:"Builder",get:function get(){function Builder(e,t,n,r){_classCallCheck(this,Builder),this.utils=e,this.dataQueue=n,this.perfMonitor=r,this.elements=t}return r(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return this.messageBus=e,this}},{key:"withCutEventEmitter",value:function withCutEventEmitter(e){return this.cutEventEmitter=e,this}},{key:"withCopyEventEmitter",value:function withCopyEventEmitter(e){return this.copyEventEmitter=e,this}},{key:"withPasteEventEmitter",value:function withPasteEventEmitter(e){return this.pasteEventEmitter=e,this}},{key:"build",value:function build(){return new ClipboardEventCollector(this)}}]),Builder}}]),r(ClipboardEventCollector,[{key:"stopFeature",value:function stopFeature(e){try{var t=(e=e||window.self).document||e.contentDocument;this._cutEventEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().CUTEVENT,this._handleClipboardEvent),this._copyEventEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().COPYEVENT,this._handleClipboardEvent),this._pasteEventEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().PASTEEVENT,this._handleClipboardEvent)}catch(n){log.error("Failed stopping the ClipboardEvents feature. msg: "+n.message,n)}}}]),ClipboardEventCollector);function ClipboardEventCollector(e){_classCallCheck(this,ClipboardEventCollector);var o=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ClipboardEventCollector.__proto__||Object.getPrototypeOf(ClipboardEventCollector)).call(this,e.perfMonitor));return o.startFeature=function(e){try{var t=(e=e||window.self).document||e.contentDocument;o._cutEventEmitter.start(t),o._messageBus.subscribe(o._messageBus.getChannels().CUTEVENT,o._handleClipboardEvent),o._copyEventEmitter.start(t),o._messageBus.subscribe(o._messageBus.getChannels().COPYEVENT,o._handleClipboardEvent),o._pasteEventEmitter.start(t),o._messageBus.subscribe(o._messageBus.getChannels().PASTEEVENT,o._handleClipboardEvent)}catch(n){log.error("Failed starting the ClipboardEvents feature. msg: "+n.message,n)}},o._handleClipboardEvent=function(e){o._sendToQueue(e)},o._sendToQueue=function(e){try{var t=o.getEventTimestamp(e),n=o._elements.getElement(e.target),r=o._utils.StorageUtils.getAndUpdateEventSequenceNumber(),i=e.clipboardData?e.clipboardData.getData("text"):window.clipboardData?window.clipboardData.getData("text"):"";""!==(i=i||"")&&(i=i.replace(/[\d]/g,"1").replace(/[a-zA-Z]/g,"a").replace(/[^a-zA-Z\d]/g,"*"));var s=o.getExports().EnumDefs.Events.clipboardEventType[e.type];o._utils.isUndefinedNull(s)&&(s=-1),o._dataQueue.addToQueue("clipboard_events",o.getExports().CDUtils.convertToArrayByMap(o.getExports().DataMappingDefs.CLIPBOARD_EVENT_MAP,{eventSequence:r,timestamp:t,elementHash:n,copiedText:i,clipboardEventType:s}))}catch(a){log.error("Failed handling ClipboardEvent. msg: "+a.message,a)}},o._utils=e.utils,o._dataQueue=e.dataQueue,o._perfMonitor=e.perfMonitor,o._elements=e.elements,o._messageBus=e.messageBus,o._cutEventEmitter=e.cutEventEmitter,o._copyEventEmitter=e.copyEventEmitter,o._pasteEventEmitter=e.pasteEventEmitter,o}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0));var s={nonDefaultFeatures:{configKey:"isOrientationEvents",shouldRun:!0,isFrameRelated:!1,runInSlave:!1,runInUns:!1,isRunning:!1,instance:null}},a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(OrientationEventCollector,i["default"]),r(OrientationEventCollector,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return s}}]),r(OrientationEventCollector,[{key:"startFeature",value:function startFeature(){window.DeviceOrientationEvent&&(this._deviceOrientationEventEmitter.start(),this._messageBus.subscribe(this._messageBus.getChannels().DEVICEORIENATIONEVENT,this._handleDeviceOrientationEvent))}},{key:"stopFeature",value:function stopFeature(){window.DeviceOrientationEvent&&(this._deviceOrientationEventEmitter.stop(),this._messageBus.unsubscribe(this._messageBus.getChannels().DEVICEORIENATIONEVENT,this._handleDeviceOrientationEvent))}},{key:"updateFeatureConfig",value:function updateFeatureConfig(){var e=this._configurationRepository.get("orientationEventsSamplePeriod");this._samplePeriod=e!==undefined?e:this._samplePeriod}}]),OrientationEventCollector);function OrientationEventCollector(e,t,n,r,i,s){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,OrientationEventCollector);var o=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(OrientationEventCollector.__proto__||Object.getPrototypeOf(OrientationEventCollector)).call(this,r));return o._handleDeviceOrientationEvent=function(e){var t=o._utils.dateNow();if(e&&t-o._lastTime>o._samplePeriod){var n=e.absolute||!1,r=o._utils.isUndefinedNull(e.alpha)?0:o._utils.cutDecimalPointDigits(e.alpha,4),i=o._utils.isUndefinedNull(e.beta)?0:o._utils.cutDecimalPointDigits(e.beta,4),s=o._utils.isUndefinedNull(e.gamma)?0:o._utils.cutDecimalPointDigits(e.gamma,4);if(r!==o._lastAlpha||i!==o._lastBeta||s!==o._lastGamma){log.isDebug()&&log.debug("OrientationEvents:_onOrientationEvent, sending data: timestamp: "+t+"\n                alpha,betta,gamma: "+r+","+i+","+s+",prevTime:"+o._lastTime),o._lastTime=t,o._lastAlpha=r,o._lastBeta=i,o._lastGamma=s;var a=o._utils.StorageUtils.getAndUpdateEventSequenceNumber();o._dataQ.addToQueue("orientation_events",[null,a,t,n,r,i,s])}}},o._dataQ=n,o._configurationRepository=e,o._utils=t,o._samplePeriod=o._configurationRepository.get("orientationEventsSamplePeriod")||0,o._lastAlpha=0,o._lastBeta=0,o._lastGamma=0,o._lastTime=0,o._messageBus=i,o._deviceOrientationEventEmitter=s,o}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0));var s={nonDefaultFeatures:{configKey:"isBeforeInstallPrompt",shouldRun:!1,isFrameRelated:!1,runInUns:!1,isRunning:!1,instance:null}},a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(BeforeInstallPromptEventCollector,i["default"]),r(BeforeInstallPromptEventCollector,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return s}}]),r(BeforeInstallPromptEventCollector,[{key:"startFeature",value:function startFeature(){this._eventEmitter.start(window),this._messageBus.subscribe(this._messageBus.getChannels().BEFOREINSTALLPROMPTEVENT,this._onBeforeInstallPrompt)}},{key:"stopFeature",value:function stopFeature(){this._eventEmitter.stop(window),this._messageBus.unsubscribe(this._messageBus.getChannels().BEFOREINSTALLPROMPTEVENT,this._onBeforeInstallPrompt)}}]),BeforeInstallPromptEventCollector);function BeforeInstallPromptEventCollector(e,t,n,r){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,BeforeInstallPromptEventCollector);var s=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(BeforeInstallPromptEventCollector.__proto__||Object.getPrototypeOf(BeforeInstallPromptEventCollector)).call(this));return s._onBeforeInstallPrompt=function(e){var t=s._utils.StorageUtils.getAndUpdateEventSequenceNumber(),n=s.getEventTimestamp(),r=s.getTimestampFromEvent(e),i=e.platforms?e.platforms.join(","):"";s._dataQueue.addToQueue("before_install_prompt",s.getExports().CDUtils.convertToArrayByMap(s.getExports().DataMappingDefs.BEFORE_INSTALL_PROMPT_EVENT_MAP,{eventSequence:t,timestamp:n,platforms:i,relativeTime:r}))},s._messageBus=n,s._eventEmitter=r,s._dataQueue=e,s._utils=t,s}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s={defaultFeatures:{configKey:"isWindowEvents",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null}},a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(WindowEventCollector,i["default"]),r(WindowEventCollector,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return s}},{key:"Builder",get:function get(){function Builder(e,t,n,r){_classCallCheck(this,Builder),this.configurationRepository=e,this.utils=t,this.dataQueue=n,this.perfMonitor=r}return r(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return this.messageBus=e,this}},{key:"withFocusEventEmitter",value:function withFocusEventEmitter(e){return this.focusEventEmitter=e,this}},{key:"withBlurEventEmitter",value:function withBlurEventEmitter(e){return this.blurEventEmitter=e,this}},{key:"withResizeEventEmitter",value:function withResizeEventEmitter(e){return this.resizeEventEmitter=e,this}},{key:"withDOMContentLoadedEventEmitter",value:function withDOMContentLoadedEventEmitter(e){return this.domContentLoadedEventEmitter=e,this}},{key:"withVisibilityChangeEventEmitter",value:function withVisibilityChangeEventEmitter(e){return this.visibilityChangeEventEmitter=e,this}},{key:"withScrollEventEmitter",value:function withScrollEventEmitter(e){return this.scrollEventEmitter=e,this}},{key:"build",value:function build(){return new WindowEventCollector(this)}}]),Builder}}]),WindowEventCollector);function WindowEventCollector(e){_classCallCheck(this,WindowEventCollector);var a=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(WindowEventCollector.__proto__||Object.getPrototypeOf(WindowEventCollector)).call(this,e.perfMonitor));return a.startFeature=function(e){try{e=e||window.self,a._resizeEventEmitter.start(e),a._messageBus.subscribe(a._messageBus.getChannels().RESIZEEVENT,a._onWindowEvent),a._focusEventEmitter.start(e),a._messageBus.subscribe(a._messageBus.getChannels().FOCUSEVENT,a._onWindowEvent),a._blurEventEmitter.start(e),a._messageBus.subscribe(a._messageBus.getChannels().BLUREVENT,a._onWindowEvent),a._domContentLoadedEventEmitter.start(e.document),a._messageBus.subscribe(a._messageBus.getChannels().DOMCONTENTLOADEDEVENT,a._onWindowEvent),a._visibilityChangeEventEmitter.start(e.document),a._messageBus.subscribe(a._messageBus.getChannels().VISIBILITYCHANGEEVENT,a._onWindowEvent),a._configurationRepository.get("isScrollCollect")&&(a._scrollEventEmitter.start(e),a._messageBus.subscribe(a._messageBus.getChannels().SCROLLEVENT,a._onWindowEvent))}catch(t){log.error("Failed starting the WindowEventCollector. msg: "+t.message,t)}},a.stopFeature=function(e){try{e=e||window.self,a._resizeEventEmitter.stop(e),a._messageBus.unsubscribe(a._messageBus.getChannels().RESIZEEVENT,a._onWindowEvent),a._focusEventEmitter.stop(e),a._messageBus.unsubscribe(a._messageBus.getChannels().FOCUSEVENT,a._onWindowEvent),a._blurEventEmitter.stop(e),a._messageBus.unsubscribe(a._messageBus.getChannels().BLUREVENT,a._onWindowEvent),a._domContentLoadedEventEmitter.stop(e.document),a._messageBus.unsubscribe(a._messageBus.getChannels().DOMCONTENTLOADEDEVENT,a._onWindowEvent),a._visibilityChangeEventEmitter.stop(e.document),a._messageBus.unsubscribe(a._messageBus.getChannels().VISIBILITYCHANGEEVENT,a._onWindowEvent),a._configurationRepository.get("isScrollCollect")&&(a._scrollEventEmitter.stop(e),a._messageBus.unsubscribe(a._messageBus.getChannels().SCROLLEVENT,a._onWindowEvent))}catch(t){log.error("Failed stopping the ClipboardEvents feature. msg: "+t.message,t)}},a.updateFeatureConfig=function(e){e=e||window.self,a._configurationRepository.get("isScrollCollect")?a._configurationRepository.get("isScrollCollect")&&(a._scrollEventEmitter.start(e),a._messageBus.subscribe(a._messageBus.getChannels().SCROLLEVENT,a._onWindowEvent)):(a._scrollEventEmitter.stop(e),a._messageBus.unsubscribe(a._messageBus.getChannels().SCROLLEVENT,a._onWindowEvent))},a._onWindowEvent=function(e){return a._sendToQueue(e),!0},a._sendToQueue=function(e){var t=void 0,n=a.getExports().EnumDefs.Events.isTrusted[undefined];"DOMContentLoaded"===e.type?t=(new Date).getTime():(t=a.getEventTimestamp(e),n=a.getExports().EnumDefs.Events.isTrusted[e.isTrusted]),log.isDebug()&&(log.trace("got event "+e.type+" at time "+t),log.trace("adding to queue - screen(width,height): "+screen.width+","+screen.height+" window(width,height): "+window.innerWidth+","+window.innerHeight));var r=a._utils.StorageUtils.getAndUpdateEventSequenceNumber(),i="visibilitychange"!==e.type?e.type:"hidden"===document.visibilityState?"tabBlur":"tabFocus",s=a.getExports().EnumDefs.Events.windowEventType[i];null!=s&&s!==undefined||(s=-1),a._dataQueue.addToQueue("window_events",a.getExports().CDUtils.convertToArrayByMap(a.getExports().DataMappingDefs.WINDOW_EVENT_MAP,{eventType:s,eventSequence:r,timestamp:t,screenWidth:screen.width?Math.round(screen.width):-1,screenHeight:screen.height?Math.round(screen.height):-1,clientWidth:window.innerWidth?Math.round(window.innerWidth):-1,clientHeight:window.innerHeight?Math.round(window.innerHeight):-1,documentWidth:document.body&&document.body.clientWidth?Math.round(document.body.clientWidth):-1,documentHeight:document.body&&document.body.clientHeight?Math.round(document.body.clientHeight):-1,scrollTop:document.body&&document.body.scrollTop?Math.round(document.body.scrollTop):0,scrollLeft:document.body&&document.body.scrollLeft?Math.round(document.body.scrollLeft):0,windowInnerWidth:window.innerWidth?Math.round(window.innerWidth):-1,windowInnerHeight:window.innerHeight?Math.round(window.innerHeight):-1,windowOuterWidth:window.outerWidth?Math.round(window.outerWidth):-1,windowOuterHeight:window.outerHeight?Math.round(window.outerHeight):-1,isTrusted:n}))},a._configurationRepository=e.configurationRepository,a._utils=e.utils,a._dataQueue=e.dataQueue,a._perfMonitor=e.perfMonitor,a._messageBus=e.messageBus,a._focusEventEmitter=e.focusEventEmitter,a._blurEventEmitter=e.blurEventEmitter,a._resizeEventEmitter=e.resizeEventEmitter,a._domContentLoadedEventEmitter=e.domContentLoadedEventEmitter,a._visibilityChangeEventEmitter=e.visibilityChangeEventEmitter,a._scrollEventEmitter=e.scrollEventEmitter,a}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.inputSelectors=undefined;var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(1));var o=t.inputSelectors="input:not([type='color']):not([type='hidden']):not([type='file']):not([type='image']):not([type='button']):not([type='radio']):not([type='checkbox']), textarea",s=function s(a){return{applyAction:function _applyAction(e,t,n){if(!["start","stop"].includes(t))return!1;for(var r=[],i=((e=e||window.self).document||e.contentDocument).querySelectorAll(o),s=0;s<i.length;s++)r.push(i[s]);0<r.length&&a[t](r,e,n)}}},a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(InputEvents,i["default"]),r(InputEvents,[{key:"bind",value:function bind(e){e=e||window.self,this._messageBus.subscribe(this._messageBus.getChannels().STANDARDINPUTEVENTINPUT,this.handleInputEvents),this._messageBus.subscribe(this._messageBus.getChannels().STANDARDINPUTEVENTFOCUS,this.handleFocusBlurEvents),this._messageBus.subscribe(this._messageBus.getChannels().STANDARDINPUTEVENTBLUR,this.handleFocusBlurEvents),this._messageBus.subscribe(this._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,this.handleSyntheticInputEvents),s(this._StandardInputEventsEmitter).applyAction(e,"start"),s(this._SyntheticMaskInputEventsHandler).applyAction(e,"start"),s(this._SyntheticAutotabInputEventsHandler).applyAction(e,"start")}},{key:"unbind",value:function unbind(e){e=e||window.self,s(this._StandardInputEventsEmitter).applyAction(e,"stop"),s(this._SyntheticMaskInputEventsHandler).applyAction(e,"stop"),s(this._SyntheticAutotabInputEventsHandler).applyAction(e,"stop"),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDINPUTEVENTINPUT,this.handleInputEvents),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDINPUTEVENTFOCUS,this.handleFocusBlurEvents),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDINPUTEVENTBLUR,this.handleFocusBlurEvents),this._messageBus.unsubscribe(this._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,this.handleSyntheticInputEvents)}},{key:"addOnLoadInputData",value:function addOnLoadInputData(e,t){this.handlerProlog("t.EE_OnLoad");for(var n=(e=e||window.self).document.querySelectorAll(o),r=0;r<n.length;r++){var i=n[r];this._elements.isListed(i)?t||this._elements.resendElementPerContext(i):this._elements.getElement(i,!1)}this.handlerEpilog("t.EE_OnLoad")}}]),InputEvents);function InputEvents(e,t,n,r,i,s,a,o){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,InputEvents);var u=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(InputEvents.__proto__||Object.getPrototypeOf(InputEvents)).call(this,e));return u.handleInputEvents=function(e){"InputEvent"===e.constructor.name&&u._inputEventsPerElement.set(e.target,{}),u.handlerProlog("t.EE_InputChange");var t=e.target.value||"";""!==t&&(t=u._CDUtils.maskText(t)),u._sendToQueue(e,{length:t?t.length:0,elementValues:t,selected:-1}),u.handlerEpilog("t.EE_InputChange")},u.handleFocusBlurEvents=function(e){u.handlerProlog("t.EE_FocusBlurChange"),u._sendToQueue(e,{length:0,selected:-1,elementValues:""}),u.handlerEpilog("t.EE_FocusBlurChange")},u.handleSyntheticInputEvents=function(e){if(!u._inputEventsPerElement.has(e.target)||"undefined"!=typeof e.jQueryMask&&("autotab"===e.jQueryMask||"prasleyValidator"===e.jQueryMask)){u.handlerProlog("t.EE_InputChangeSynthetic");var t=e.target.value||"";""!==t&&(t=u._CDUtils.maskText(t)),u._sendToQueue(e,{length:t?t.length:0,elementValues:t,selected:-1}),u.handlerEpilog("t.EE_InputChangeSynthetic")}},u._elements=t,u._sendToQueue=n,u._messageBus=i,u._CDUtils=r,u._StandardInputEventsEmitter=s,u._SyntheticMaskInputEventsHandler=a,u._SyntheticAutotabInputEventsHandler=o,u._inputEventsPerElement=new WeakMap,u}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onFormSelectors=undefined;var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(1));var s=t.onFormSelectors="form",a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(FormEvents,i["default"]),r(FormEvents,[{key:"bind",value:function bind(e){var t=(e=e||window.self).document||e.contentDocument;this._messageBus.subscribe(this._messageBus.getChannels().STANDARDONFORMSUBMITEVENT,this.handleOnFormEvents),this.addListenersBySelector(t)}},{key:"unbind",value:function unbind(e){for(var t=[],n=((e=e||window.self).document||e.contentDocument).querySelectorAll(s),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnFormEventsEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDONFORMSUBMITEVENT,this.handleOnFormEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],n=e.querySelectorAll(s),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnFormEventsEmitter.start(t)}}]),FormEvents);function FormEvents(e,t,n,r){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,FormEvents);var i=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(FormEvents.__proto__||Object.getPrototypeOf(FormEvents)).call(this,e));return i.handleOnFormEvents=function(e){log.trace("ElementEvents:_onFormSubmitEvent"),i._sendToQueue(e,{length:0,selected:-1,elementValues:""})},i._perfMonitor=e,i._sendToQueue=t,i._messageBus=n,i._StandardOnFormEventsEmitter=r,i}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onClickSelectors=undefined;var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(1));var s=t.onClickSelectors="input[type='button'], input[type='radio'], input[type='checkbox'], button",a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ClickEvents,i["default"]),r(ClickEvents,[{key:"bind",value:function bind(e){var t=(e=e||window.self).document||e.contentDocument;this._messageBus.subscribe(this._messageBus.getChannels().STANDARDONCLICKEVENT,this.handleOnClickEvents),this.addListenersBySelector(t)}},{key:"unbind",value:function unbind(e){for(var t=[],n=((e=e||window.self).document||e.contentDocument).querySelectorAll(s),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnClickEventsEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDONCLICKEVENT,this.handleOnClickEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],n=e.querySelectorAll(s),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnClickEventsEmitter.start(t)}}]),ClickEvents);function ClickEvents(e,t,n,r,i){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ClickEvents);var s=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ClickEvents.__proto__||Object.getPrototypeOf(ClickEvents)).call(this,e));return s.handleOnClickEvents=function(e){s.handlerProlog("t.EE_Click");var t=e.target,n=t.value||t.innerHTML;n=s._CDUtils.clearTextFromNumbers(n),s._sendToQueue(e,{length:n.length,elementValues:n,selected:t.checked===undefined?-1:t.checked?1:0}),s.handlerEpilog("t.EE_Click")},s._perfMonitor=e,s._sendToQueue=t,s._CDUtils=n,s._messageBus=r,s._StandardOnClickEventsEmitter=i,s}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.onChangeSelectors=undefined;var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(1));var s=t.onChangeSelectors="select",a=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(ChangeEvents,i["default"]),r(ChangeEvents,[{key:"bind",value:function bind(e){var t=(e=e||window.self).document||e.contentDocument;this._messageBus.subscribe(this._messageBus.getChannels().STANDARDONCHANGEEVENT,this.handleOnChangeEvents),this.addListenersBySelector(t)}},{key:"unbind",value:function unbind(e){for(var t=[],n=((e=e||window.self).document||e.contentDocument).querySelectorAll(s),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnChangeEventsEmitter.stop(t),this._messageBus.unsubscribe(this._messageBus.getChannels().STANDARDONCHANGEEVENT,this.handleOnChangeEvents)}},{key:"addListenersBySelector",value:function addListenersBySelector(e){for(var t=[],n=e.querySelectorAll(s),r=0;r<n.length;r++)t.push(n[r]);this._StandardOnChangeEventsEmitter.start(t)}}]),ChangeEvents);function ChangeEvents(e,t,n,r,i){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,ChangeEvents);var s=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(ChangeEvents.__proto__||Object.getPrototypeOf(ChangeEvents)).call(this,e));return s.handleOnChangeEvents=function(e){s.handlerProlog("t.EE_Change");var t=s._CDUtils.getDropDownListValues(e.target).join(";");t=s._CDUtils.clearTextFromNumbers(t);var n=e.target.selectedIndex,r=e.target.value.length;s._sendToQueue(e,{length:r,selected:n,elementValues:t}),s.handlerEpilog("t.EE_Change")},s._perfMonitor=e,s._sendToQueue=t,s._CDUtils=n,s._messageBus=r,s._StandardOnChangeEventsEmitter=i,s}t["default"]=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);Object.defineProperty(t,"FeaturesListInitializer",{enumerable:!0,get:function get(){return function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(r)["default"]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(6);Object.defineProperty(t,"ElementEventCollector",{enumerable:!0,get:function get(){return _interopRequireDefault(r)["default"]}});var i=n(7);Object.defineProperty(t,"ClipboardEventCollector",{enumerable:!0,get:function get(){return _interopRequireDefault(i)["default"]}});var s=n(8);Object.defineProperty(t,"OrientationEventCollector",{enumerable:!0,get:function get(){return _interopRequireDefault(s)["default"]}});var a=n(9);Object.defineProperty(t,"BeforeInstallPromptEventCollector",{enumerable:!0,get:function get(){return _interopRequireDefault(a)["default"]}});var o=n(10);function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"WindowEventCollector",{enumerable:!0,get:function get(){return _interopRequireDefault(o)["default"]}})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=function JqueryElementsHandler(e,t,n,r){return i=e,s=t,a=n,o=r,{bindInputEvents:_bindInputEvents,bindOnClickEvents:_bindOnClickEvents,bindOnChangeEvents:_bindOnChangeEvents,bindOnFormsEvents:_bindOnFormsEvents}};var i=null,s=null,a=null,o=null;function _bindInputEvents(e){i.removeElementEvents(e),i.addElementEvents(e,!0)}function _bindOnClickEvents(e){s.removeElementEvents(e),s.addElementEvents(e,!0)}function _bindOnChangeEvents(e){a.removeElementEvents(e),a.addElementEvents(e,!0)}function _bindOnFormsEvents(e){o.removeElementEvents(e),o.addElementEvents(e,!0)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DOMAIN_STATES_PROPS=t.DOMAIN_REGEX=t.CSP_REGEX=undefined;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(0));function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o={nonDefaultFeatures:{configKey:"isCrossdomain",shouldRun:!0,isFrameRelated:!1,runInUns:!1,runInSlave:!1,isRunning:!1,instance:null}},u=t.CSP_REGEX=/(?=(child\-src)|(frame\-src))([^;]+)/gi,l=t.DOMAIN_REGEX=/http[s]?:\/\/([^\/]+)/gi,c=t.DOMAIN_STATES_PROPS={resource:null,iframeElement:!1,blockedByCSP:!1,iframeLoaded:!1,ACKMessageSent:!1,ACKMessageRecieved:!1,unavailable:!1},d=(function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(CrossDomain,a["default"]),s(CrossDomain,null,[{key:"getDefaultSettings",value:function getDefaultSettings(){return o}},{key:"generateRandomID",value:function generateRandomID(){for(var e="abcdefghijklmnopqrstuvwxyz0123456789",t="",n=0;n<16;n++)t+=e.charAt(Math.floor(Math.random()*e.length));return t}},{key:"Builder",get:function get(){function Builder(e,t,n,r,i,s,a){_classCallCheck(this,Builder),this.configurationRepository=e,this.dataQ=t,this.perfMonitor=n,this.utils=r,this.Map=i,this.dataMappingDefs=s,this.eventType=a}return s(Builder,[{key:"withMessageBus",value:function withMessageBus(e){return this.messageBus=e,this}},{key:"withWindowMessageEventEmitter",value:function withWindowMessageEventEmitter(e){return this.windowMessageEventEmitter=e,this}},{key:"build",value:function build(){return new CrossDomain(this)}}]),Builder}}]),CrossDomain);function CrossDomain(e){_classCallCheck(this,CrossDomain);var o=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(CrossDomain.__proto__||Object.getPrototypeOf(CrossDomain)).call(this,e.perfMonitor));return o.startFeature=function(e){e=e||window.self,o._domainsResources=o._configurationRepository.get("crossDomainsList"),o._crossDomainsTimeout=o._configurationRepository.get("crossDomainsTimeout"),Array.isArray(o._domainsResources)&&0<o._domainsResources.length&&(o._windowMessageEmitter.startObserver(e),o._domainsResources.map(function(e){var t=e.match(l);if(null!==t&&"string"==typeof t[0]){var n=t[0];if("object"===i(o._domainsStates[n]))return;o._domainsStates[n]=r({},c),o._domainsStates[n].resource=e,o._domains.push(n)}}),Array.isArray(o._domains)&&0<o._domains.length&&(o.isBlockedByCSP(e,o._domains),o._utils.DomUtils.onDocumentBody(e,function(){o.connectDomains(e)})))},o.stopFeature=function(e){e=e||window.self,o.clearFeaturesObjects(e)},o.clearFeaturesObjects=function(t){t=t||window.self,o._windowMessageEmitter.stopObserver(t),Array.isArray(o._domains)&&0<o._domains.length&&(o._domains.forEach(function(e){o.clearDomElements(t,e)}),o._domains=[],o._domainsStates={})},o.connectDomains=function(t){Array.isArray(o._domains)&&0<o._domains.length&&(o._domains.forEach(function(e){o._domainsStates[e].blockedByCSP||!1!==o._domainsStates[e].iframeElement||o.createIframe(t,e)}),setTimeout(function(){o._domains.forEach(function(e){"object"===i(o._domainsStates[e])&&!1===o._domainsStates[e].ACKMessageRecieved&&!1===o._domainsStates[e].unavailable&&(log.warn("Cross Domain feature - domain "+e+" is unavailable"),o._domainsStates[e].unavailable=!0,o.clearDomElements(t,e))})},o._crossDomainsTimeout))},o.createIframe=function(e,t){var n=e.document.createElement("iframe");n.onload=function(){o.postNextMessage(t)},n.id=CrossDomain.generateRandomID(),n.src=o._domainsStates[t].resource,n.style.display="none",n.style.opacity="0",n.width="1",n.height="1",e.document.body.appendChild(n),o._domainsStates[t].iframeElement=n},o.clearDomElements=function(e,t){e=e||window.self;var n=o._domainsStates[t].iframeElement;"object"===(void 0===n?"undefined":i(n))&&null!==e.document.getElementById(o._domainsStates[t].iframeElement.id)&&e.document.body.removeChild(n)},o.postNextMessage=function(e){if(!o._domainsStates[e].ACKMessageRecieved&&o._domainsStates[e].iframeElement){var t={muid:o._generatedMUID};o._domainsStates[e].iframeElement.contentWindow.postMessage(JSON.stringify(t),e),o._domainsStates[e].ACKMessageSent=!0}},o.isBlockedByCSP=function(e,n){if(!Array.isArray(n)||n.length<1)throw new Error("Domains are expected for content security policy assertion");e=e||window.self;var r=!1;[].slice.call(e.document.getElementsByTagName("meta")).forEach(function(e){if("Content-Security-Policy"===e.getAttribute("http-equiv")){r=!0;var t=e.getAttribute("content").match(u);n.forEach(function(e){t&&-1===t[0].indexOf(e)&&"object"===i(o._domainsStates[e])&&(o._domainsStates[e].blockedByCSP=!0,log.warn("Cross Domain feature - domain "+e+" is blocked by CSP"))})}if(r)return!1})},o.windowMessageHandler=function(e){var t=e.message.origin;if(o._domainsStates.hasOwnProperty(t)){if(!0===o._domainsStates[t].ACKMessageRecieved)return;o._domainsStates[t].ACKMessageRecieved=!0,o.clearDomElements(e.message.currentTarget,t);var n=e.message.data;o.sendToQueue(t,n)}},o.sendToQueue=function(e,s){var a=e.replace(/http[s]?:\/\//i,"");"object"===i(s.found)&&Object.keys(s.found).forEach(function(e){var t=o._utils.StorageUtils.getAndUpdateEventSequenceNumber(),n=a,r=s.found[e].split("__"),i={eventType:o._eventType.found,eventSequence:t,domainUrl:n,muid:r[0],timestamp:r[1]};o._dataQ.addToQueue("crossmuid_event",o._utils.convertToArrayByMap(o._dataMappingDefs,i),!0)}),"object"===i(s["new"])&&Object.keys(s["new"]).forEach(function(e){var t=o._utils.StorageUtils.getAndUpdateEventSequenceNumber(),n=a,r=s["new"][e].split("__"),i={eventType:o._eventType["new"],eventSequence:t,domainUrl:n,muid:r[0],timestamp:r[1]};o._dataQ.addToQueue("crossmuid_event",o._utils.convertToArrayByMap(o._dataMappingDefs,i))}),"object"===i(s.error_message)&&log.warn("Cross Domain feature - domain "+a+" error. Error Message: \n                "+s.error_message+" Code: "+s.error_code)},o.updateFeatureConfig=function(e){e=e||window.self,o._domainsResources=o._configurationRepository.get("crossDomainsList"),o.updateDomainStates(e)},o.updateDomainStates=function(e){Array.isArray(o._domainsResources)&&0<o._domainsResources.length&&(o._domains=[],o._domainsResources.map(function(e){var t=e.match(l);if(null!==t&&"string"==typeof t[0]){var n=t[0];"object"!==i(o._domainsStates[n])&&(o._domainsStates[n]=r({},c),o._domainsStates[n].resource=e),o._domains.push(n)}}),Array.isArray(o._domains)&&0<o._domains.length&&(o.isBlockedByCSP(e,o._domains),o._utils.DomUtils.onDocumentBody(e,function(){o.connectDomains(e)})))},o._configurationRepository=e.configurationRepository,o._dataQ=e.dataQ,o._perfMonitor=e.perfMonitor,o._utils=e.utils,o._dataMappingDefs=e.dataMappingDefs,o._eventType=e.eventType,o._messageBus=e.messageBus,o._windowMessageEmitter=e.windowMessageEventEmitter,o._messageBus.subscribe(o._messageBus.getChannels().WINDOWMESSAGEEVENT,o.windowMessageHandler),o._generatedMUID=o._utils.dateNow()+"-"+o._utils.generateUUID().toUpperCase(),o._domainsStates={},o._domainsResources=[],o._domains=[],o}t["default"]=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=!1;!function(){try{var e=Object.defineProperty({},"passive",{get:function get(){a=!0}});window.addEventListener("test",null,e)}catch(t){}}();var i=(r(EventAggregator,null,[{key:"addEventListener",value:function addEventListener(e,t,n){var r=3<arguments.length&&arguments[3]!==undefined&&arguments[3],i=!(4<arguments.length&&arguments[4]!==undefined)||arguments[4],s=5<arguments.length&&arguments[5]!==undefined&&arguments[5];a?e.addEventListener(t,n,{capture:r,passive:i,once:s}):e.addEventListener?e.addEventListener(t,n,r):e.attachEvent("on"+t,n)}},{key:"removeEventListener",value:function removeEventListener(e,t,n){var r=3<arguments.length&&arguments[3]!==undefined&&arguments[3];e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent("on"+t,n)}}]),EventAggregator);function EventAggregator(){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,EventAggregator)}t["default"]=i},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var a=function a(e){return!(!e.jQuery||!e.jQuery._data)},r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(SyntheticMaskInputEventsHandler,[{key:"start",value:function start(e,i){var s=this;i=i||window.self,e.forEach(function(e){if(a(i)&&s.hasMaskEventSupported(e,i)&&!s._elementBindingWMap.has(e)){var r={};s.defaultEventListener.forEach(function(t){var n=function n(e){t.handler(e,i)};r[t.event]=n,s._eventAggregator.addEventListener(e,t.event,n)}),s._elementBindingWMap.set(e,{isBinded:!0,listeners:r})}})}},{key:"stop",value:function stop(e){var r=this;e.forEach(function(t){var n=r._elementBindingWMap.get(t);n&&n.isBinded&&(r.defaultEventListener.forEach(function(e){r._eventAggregator.removeEventListener(t,e.event,n.listeners[e.event])}),r._elementBindingWMap["delete"](t))})}},{key:"hasMaskEventSupported",value:function hasMaskEventSupported(e,t){var n=t.jQuery._data(e,"events");if(void 0===n)return!1;for(var r=Object.keys(n),i=0;i<r.length;i++)if("unmask"===r[i])return!0;return!1}}]),SyntheticMaskInputEventsHandler);function SyntheticMaskInputEventsHandler(e,t,n){var i=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SyntheticMaskInputEventsHandler),this.handleKeypressEvents=function(e,t){if(a(t)&&i.hasMaskEventSupported(e.target,t)){var n=e.key,r=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:n,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:"insertText",isComposing:!1,isTrusted:!0,jQueryMask:"maskedInput",returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timeStamp:e.timeStamp,type:"input",view:null,which:0});i._messageBus.publish(i._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,r)}},this._messageBus=e,this._eventAggregator=t,this._elementBindingWMap=new WeakMap,this._utils=n,this.defaultEventListener=[{event:"keypress",handler:this.handleKeypressEvents}]}t["default"]=r},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var a=function a(e){return!(!e.jQuery||!e.jQuery._data)},r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(SyntheticAutotabInputEventsHandler,[{key:"start",value:function start(e,i){var s=this;i=i||window.self,e.forEach(function(e){if(a(i)&&s.hasjQueryAutoTab(e,i)&&!s._elementBindingWMap.has(e)){var r={};s.defaultEventListener.forEach(function(t){var n=function n(e){t.handler(e,i)};r[t.event]=n,s._eventAggregator.addEventListener(e,t.event,n)}),s._elementBindingWMap.set(e,{isBinded:!0,listeners:r})}})}},{key:"stop",value:function stop(e){var r=this;e.forEach(function(t){var n=r._elementBindingWMap.get(t);n&&n.isBinded&&(r.defaultEventListener.forEach(function(e){r._eventAggregator.removeEventListener(t,e.event,n.listeners[e.event])}),r._elementBindingWMap["delete"](t))})}},{key:"hasjQueryAutoTab",value:function hasjQueryAutoTab(e,t){if(void 0===t.jQuery._data(e,"events"))return!1;for(var n=Object.keys(t.jQuery._data(e,"events")),r=0;r<n.length;r++)if(-1!==n[r].indexOf("autotab"))return!0;return!1}}]),SyntheticAutotabInputEventsHandler);function SyntheticAutotabInputEventsHandler(e,t,n){var s=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SyntheticAutotabInputEventsHandler),this.handleKeypressEvents=function(e,t){if(a(t)&&s.hasjQueryAutoTab(e.target,t)){var n="insertText",r=e.key;if(8===e.keyCode)return n="deleteContentBackward",void(r=null);var i=Object.assign({},{bubbles:!0,cancelBubble:!1,cancelable:!1,composed:!0,currentTarget:null,data:r,dataTransfer:null,defaultPrevented:!1,detail:0,eventPhase:0,inputType:n,isComposing:!1,isTrusted:!0,jQueryMask:"autotab",returnValue:!0,sourceCapabilities:null,srcElement:Object.assign(e.target||e.srcElement,{}),target:Object.assign(e.target,{}),timeStamp:e.timeStamp,type:"input",view:null,which:0});s._messageBus.publish(s._messageBus.getChannels().SYNTHETICINPUTMASKEVENT,i)}},this._messageBus=e,this._eventAggregator=t,this._elementBindingWMap=new WeakMap,this._utils=n,this.defaultEventListener=[{event:"keypress",handler:this.handleKeypressEvents}]}t["default"]=r},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(StandardOnFormEventsEmitter,[{key:"start",value:function start(e){var n=this;e.forEach(function(t){n._elementBindingWMap.has(t)||(n.defaultOnFormEventListener.forEach(function(e){n._eventAggregator.addEventListener(t,e.event,e.handler)}),n._elementBindingWMap.set(t,{isBinded:!0,listeners:[n.handleOnFormSubmitEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultOnFormEventListener.forEach(function(e){n._eventAggregator.removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultOnFormEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultOnFormEventListener.forEach(function(e){n._eventAggregator.addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleOnFormSubmitEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultOnFormEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultOnFormEventListener.forEach(function(e){n._eventAggregator.removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardOnFormEventsEmitter);function StandardOnFormEventsEmitter(e,t,n){var r=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardOnFormEventsEmitter),this.handleOnFormSubmitEvents=function(e){r._messageBus.publish(r._messageBus.getChannels().STANDARDONFORMSUBMITEVENT,e)},this._messageBus=e,this._eventAggregator=t,this._elementBindingWMap=new WeakMap,this._utils=n,this.defaultOnFormEventListener=[{event:"submit",handler:this.handleOnFormSubmitEvents}]}t["default"]=r},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(StandardOnClickEventsEmitter,[{key:"start",value:function start(e){var n=this;e.forEach(function(t){n._elementBindingWMap.has(t)||(n.defaultOnClickEventListener.forEach(function(e){n._eventAggregator.addEventListener(t,e.event,e.handler)}),n._elementBindingWMap.set(t,{isBinded:!0,listeners:[n.handleOnClickEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultOnClickEventListener.forEach(function(e){n._eventAggregator.removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultOnClickEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultOnClickEventListener.forEach(function(e){n._eventAggregator.addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleOnClickEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultOnClickEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultOnClickEventListener.forEach(function(e){n._eventAggregator.removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardOnClickEventsEmitter);function StandardOnClickEventsEmitter(e,t,n){var r=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardOnClickEventsEmitter),this.handleOnClickEvents=function(e){r._messageBus.publish(r._messageBus.getChannels().STANDARDONCLICKEVENT,e)},this._messageBus=e,this._eventAggregator=t,this._elementBindingWMap=new WeakMap,this._utils=n,this.defaultOnClickEventListener=[{event:"click",handler:this.handleOnClickEvents}]}t["default"]=r},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(StandardOnChangeEventsEmitter,[{key:"start",value:function start(e){var n=this;e.forEach(function(t){n._elementBindingWMap.has(t)||(n.defaultOnChangeEventListener.forEach(function(e){n._eventAggregator.addEventListener(t,e.event,e.handler)}),n._elementBindingWMap.set(t,{isBinded:!0,listeners:[n.handleOnChangeEvents],isUsingJQuery:!1}))})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultOnChangeEventListener.forEach(function(e){n._eventAggregator.removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultOnChangeEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultOnChangeEventListener.forEach(function(e){n._eventAggregator.addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleOnChangeEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultOnChangeEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultOnChangeEventListener.forEach(function(e){n._eventAggregator.removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardOnChangeEventsEmitter);function StandardOnChangeEventsEmitter(e,t,n){var r=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardOnChangeEventsEmitter),this.handleOnChangeEvents=function(e){r._messageBus.publish(r._messageBus.getChannels().STANDARDONCHANGEEVENT,e)},this._messageBus=e,this._eventAggregator=t,this._elementBindingWMap=new WeakMap,this._utils=n,this.defaultOnChangeEventListener=[{event:"change",handler:this.handleOnChangeEvents}]}t["default"]=r},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(StandardInputEventsEmitter,[{key:"start",value:function start(e,r,i){var s=this;e.forEach(function(t){if(!s._elementBindingWMap.has(t)){var n=[];void 0!==i?"function"==typeof i.func&&Array.isArray(i.allowedEvents)&&0<i.allowedEvents.length&&(i.func(r,t)?s.defaultInputEventListener.forEach(function(e){i.allowedEvents.includes(e.event)&&n.push(e)}):n=Array.from(s.defaultInputEventListener)):n=Array.from(s.defaultInputEventListener),n.forEach(function(e){s._eventAggregator.addEventListener(t,e.event,e.handler)}),s._elementBindingWMap.set(t,{isBinded:!0,listeners:[s.handleInputEvents,s.handleFocusEvents,s.handleBlurEvents],isUsingJQuery:!1})}})}},{key:"stop",value:function stop(e){var n=this;e.forEach(function(t){var e=n._elementBindingWMap.get(t);e&&e.isBinded&&(n.defaultInputEventListener.forEach(function(e){n._eventAggregator.removeEventListener(t,e.event,e.handler)}),n._elementBindingWMap["delete"](t))})}},{key:"addElementEvents",value:function addElementEvents(t){var n=this,e=1<arguments.length&&arguments[1]!==undefined&&arguments[1];if(!this._elementBindingWMap.has(t)){if(e){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to add event listeners for element using jQuery because jQuery is not available");this.defaultInputEventListener.forEach(function(e){n._utils.JQueryUtils.addEventListener(t,e.event,e.handler)})}else this.defaultInputEventListener.forEach(function(e){n._eventAggregator.addEventListener(t,e.event,e.handler)});this._elementBindingWMap.set(t,{isBinded:!0,listeners:[this.handleInputEvents,this.handleFocusEvents,this.handleBlurEvents],isUsingJQuery:e})}}},{key:"removeElementEvents",value:function removeElementEvents(t){var n=this,e=this._elementBindingWMap.get(t);if(e&&e.isBinded){if(e.isUsingJQuery){if(!this._utils.JQueryUtils.isJQueryAvailable())return void log.error("Unable to remove event listeners for element using jQuery because jQuery is not available");this.defaultInputEventListener.forEach(function(e){n._utils.JQueryUtils.removeEventListener(t,e.event,e.handler)})}else this.defaultInputEventListener.forEach(function(e){n._eventAggregator.removeEventListener(elements,e.event,e.handler)});this._elementBindingWMap["delete"](t)}}}]),StandardInputEventsEmitter);function StandardInputEventsEmitter(e,t,n){var r=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,StandardInputEventsEmitter),this.handleInputEvents=function(e){r._messageBus.publish(r._messageBus.getChannels().STANDARDINPUTEVENTINPUT,e)},this.handleFocusEvents=function(e){r._messageBus.publish(r._messageBus.getChannels().STANDARDINPUTEVENTFOCUS,e)},this.handleBlurEvents=function(e){r._messageBus.publish(r._messageBus.getChannels().STANDARDINPUTEVENTBLUR,e)},this._messageBus=e,this._eventAggregator=t,this._elementBindingWMap=new WeakMap,this._utils=n,this.defaultInputEventListener=[{event:"input",handler:this.handleInputEvents},{event:"focus",handler:this.handleFocusEvents},{event:"blur",handler:this.handleBlurEvents}]}t["default"]=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(27));var a=(i(MutationEmitter,[{key:"startObserver",value:function startObserver(i){var s=this,e=(i=i||window.self).document||i.contentDocument;if(!this._documentObservers.has(e)){var t=new window.MutationObserver(function(e){try{for(var t=0;t<e.length;t++){var n=e[t];if(0<n.addedNodes.length){s.handleMutationEvent(n,i);break}}}catch(r){log.error("An error has occurred: "+r.message)}});t.observe(e,{childList:!0,subtree:!0}),this._documentObservers.set(e,{instance:t})}}},{key:"stopObserver",value:function stopObserver(e){var t=(e=e||window.self).document||e.contentDocument,n=void 0;this._documentObservers.has(t)&&(n=this._documentObservers.get(t))&&(n.instance&&n.instance.disconnect(),this._documentObservers["delete"](t))}}]),MutationEmitter);function MutationEmitter(e){var n=this;if(function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MutationEmitter),this.handleMutationEvent=function(e,t){return e&&t&&n._messageBus.publish(n._messageBus.getChannels().MUTATIONSINGLE,{mutation:e,frame:t})},this._messageBus=e,"object"!==r(this._messageBus))throw new Error("Bootstrap aborted! MessageBus missing for MutationEmitter");this._documentObservers=new WeakMap}t["default"]=(0,s["default"])(a)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t["default"]=function(e){return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(_class2,e),r(_class2,[{key:"hasInstance",value:function hasInstance(e){}},{key:"getInstance",value:function getInstance(e){}},{key:"deleteInstance",value:function deleteInstance(e){}}]),_class2;function _class2(){var e;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,_class2);for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(e=_class2.__proto__||Object.getPrototypeOf(_class2)).call.apply(e,[this].concat(n)));return i._frameInstances=new WeakMap,i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(n(29));var s=(r(MessageBus,[{key:"getChannels",value:function getChannels(){return i["default"]}},{key:"subscribe",value:function subscribe(e,t){var n=2<arguments.length&&arguments[2]!==undefined&&arguments[2],r=null,i=!1;this.subscribers.has(e)?(r=this.subscribers.get(e))&&r.forEach(function(e){t===e.handler&&(i=!0)}):(r=new this._SET,this.subscribers.set(e,r)),i||r.add({handler:t,isOneTime:n})}},{key:"unsubscribe",value:function unsubscribe(e,t){if(e&&this.subscribers.has(e)){var n=this.subscribers.get(e);n&&n.forEach(function(e){t===e.handler&&n["delete"](e)}),0===n.size&&this.subscribers["delete"](e)}}},{key:"publish",value:function publish(e,t){this.notifySubscribers({channel:e,data:t})}},{key:"notifySubscribers",value:function notifySubscribers(t){var e=t.channel;if(e&&this.subscribers.has(e)){var n=this.subscribers.get(e);n&&n.forEach(function(e){e.handler(t.data),e.isOneTime&&n["delete"](e)})}}}]),MessageBus);function MessageBus(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,MessageBus),this._MAP=e,this._SET=t,this.subscribers=new this._MAP}t["default"]=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={MUTATIONSINGLE:"mutation:single",MUTATIONALL:"mutation:all",CONFIGUPDATED:"config:loaded",CONFIGFAILED:"config:failed",STANDARDINPUTEVENTINPUT:"events:standardinputeventinput",STANDARDINPUTEVENTFOCUS:"events:standardinputeventfocus",STANDARDINPUTEVENTBLUR:"events:standardinputeventblur",STANDARDONCLICKEVENT:"events:standardonclickevent",STANDARDONCHANGEEVENT:"events:standardonchangeevent",STANDARDONFORMSUBMITEVENT:"events:standardoformsubmiteevent",SYNTHETICINPUTMASKEVENT:"events:syntheticinputmaskevent",CUTEVENT:"events:cutevent",COPYEVENT:"events:copyevent",PASTEEVENT:"events:pasteevent",DEVICEORIENATIONEVENT:"events:deviceorientationevent",BEFOREINSTALLPROMPTEVENT:"events:beforeinstallpromptevent",FOCUSEVENT:"events:focusevent",BLUREVENT:"events:blurevent",RESIZEEVENT:"events:resizeevent",DOMCONTENTLOADEDEVENT:"events:domcontentloadedevent",VISIBILITYCHANGEEVENT:"events:visibilitychangeevent",SCROLLEVENT:"events:scroll",WINDOWMESSAGEEVENT:"events:windowmessageevent"}},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(PasteEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");this._eventAggregator.addEventListener(e,"paste",this.handlePasteEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");this._eventAggregator.removeEventListener(e,"paste",this.handlePasteEvent)}}]),PasteEventEmitter);function PasteEventEmitter(e,t){var n=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,PasteEventEmitter),this.handlePasteEvent=function(e){n._messageBus.publish(n._messageBus.getChannels().PASTEEVENT,e)},this._messageBus=e,this._eventAggregator=t}t["default"]=r},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(CutEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");this._eventAggregator.addEventListener(e,"cut",this.handleCutEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");this._eventAggregator.removeEventListener(e,"cut",this.handleCutEvent)}}]),CutEventEmitter);function CutEventEmitter(e,t){var n=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CutEventEmitter),this.handleCutEvent=function(e){n._messageBus.publish(n._messageBus.getChannels().CUTEVENT,e)},this._messageBus=e,this._eventAggregator=t}t["default"]=r},function(e,t,n){"use strict";function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Object.defineProperty(t,"__esModule",{value:!0});var r=(function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}(CopyEventEmitter,[{key:"start",value:function start(e){if(!e)throw new Error("invalid document parameter");this._eventAggregator.addEventListener(e,"copy",this.handleCopyEvent)}},{key:"stop",value:function stop(e){if(!e)throw new Error("invalid document parameter");this._eventAggregator.removeEventListener(e,"copy",this.handleCopyEvent)}}]),CopyEventEmitter);function CopyEventEmitter(e,t){var n=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,CopyEventEmitter),this.handleCopyEvent=function(e){n._messageBus.publish(n._messageBus.getChannels().COPYEVENT,e)},this._messageBus=e,this._eventAggregator=t}t["default"]=r},,,,,,,,,,,,,,,function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(48),i=function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}(r);t["default"]={Application:i["default"],setExport:r.setExport}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e};function defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}t.setExport=function setExport(e){C=e,(0,u.injectExports)(C)};var i=n(2),s=_interopRequireDefault(n(4)),a=_interopRequireDefault(n(15)),o=_interopRequireDefault(n(5)),u=n(3),l=_interopRequireDefault(n(19)),c=_interopRequireDefault(n(20)),d=_interopRequireDefault(n(21)),f=_interopRequireDefault(n(22)),v=_interopRequireDefault(n(23)),h=_interopRequireDefault(n(24)),E=_interopRequireDefault(n(25)),p=_interopRequireDefault(n(26)),m=_interopRequireDefault(n(28)),_=_interopRequireDefault(n(30)),g=_interopRequireDefault(n(31)),y=_interopRequireDefault(n(32));function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}var b={};b.Index=a["default"],b.FeaturesList=o["default"];var C={};var w={MessageBus:m["default"],MutationEmitter:p["default"],CutEventEmitter:g["default"],CopyEventEmitter:y["default"],PasteEventEmitter:_["default"],StandardInputEventsEmitter:E["default"],StandardOnClickEventsEmitter:v["default"],StandardOnChangeEventsEmitter:h["default"],StandardOnFormEventsEmitter:f["default"],SyntheticMaskInputEventsHandler:c["default"],SyntheticAutotabInputEventsHandler:d["default"],EventAggregator:l["default"]},O=[{service:"MutationEmitter",deps:["MessageBus"],exportDeps:[]},{service:"CutEventEmitter",deps:["MessageBus","EventAggregator"],exportDeps:[]},{service:"CopyEventEmitter",deps:["MessageBus","EventAggregator"],exportDeps:[]},{service:"PasteEventEmitter",deps:["MessageBus","EventAggregator"],exportDeps:[]},{service:"StandardInputEventsEmitter",deps:["MessageBus","EventAggregator"],exportDeps:["CDUtils"]},{service:"StandardOnClickEventsEmitter",deps:["MessageBus","EventAggregator"],exportDeps:["CDUtils"]},{service:"StandardOnChangeEventsEmitter",deps:["MessageBus","EventAggregator"],exportDeps:["CDUtils"]},{service:"StandardOnFormEventsEmitter",deps:["MessageBus","EventAggregator"],exportDeps:["CDUtils"]},{service:"SyntheticMaskInputEventsHandler",deps:["MessageBus","EventAggregator"],exportDeps:["CDUtils"]},{service:"SyntheticAutotabInputEventsHandler",deps:["MessageBus","EventAggregator"],exportDeps:["CDUtils"]}],S=(r(Application,[{key:"initialize",value:function initialize(){try{this.registerServices()}catch(e){throw new Error("Bootstrap aborted! "+e.message)}this.registerFeatures()}},{key:"registerServices",value:function registerServices(){var e=new m["default"](C.Map,C.Set);(0,i.register)("MessageBus",e),(0,i.register)("EventAggregator",l["default"]),O.forEach(function(t){var n=[],r=[],e=w[t.service];t.deps.forEach(function(e){if(null===(0,i.inject)(e))throw new Error("Missing service dependency , "+e+", for service "+t.service);n.push((0,i.inject)(e))}),t.exportDeps.forEach(function(e){r.push(C[e])}),(0,i.register)(t.service,new(Function.prototype.bind.apply(e,[null].concat(n,r))))})}},{key:"registerFeatures",value:function registerFeatures(){Object.getOwnPropertyNames(b).forEach(function(e){"function"==typeof b[e]&&b[e](C,{runInSlave:!0})})}}]),Application);function Application(e,t){!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Application),this.configurations={},this.APP_CONTAINER=new s["default"],(0,i.serviceContainer)(this.APP_CONTAINER),"function"==typeof t&&t(this)}t["default"]=S}]),(Ue=Ye).MessageEventHandler=function(){function t(e){Je(this,t),this._channelPort=null,this._preHandshakeBuffer=[],this._enableBuffering=!0,this._configurationRepository=e}return Xe(t,[{key:"subscribeToMessageEvents",value:function(t,n){var i=this;setTimeout(this._clearBuffer,this._configurationRepository.get(Ue.ConfigurationFields.slaveChannelHandshakeTimeout)),Ue.CDUtils.addEventListener(window,"message",function(e){i._handleWindowPostMessage(e,n),i._handleChannelMessage(e,t)}),Ue.CDUtils.addEventListener(window,"beforeunload",function(){i._sendToChannel({msgType:Ue.EnumDefs.MasterSlaveMessage.onBeforeUnload})})}},{key:"sendToParent",value:function(e){window.parent.postMessage(e,"*"),this._sendToChannel(e)}},{key:"_handleWindowPostMessage",value:function(e,t){(e.source!==window||e.data&&e.data.isNative)&&t(e,e.data.msgType)}},{key:"_handleChannelMessage",value:function(e,t){this._isChannelMessage(e)&&(this._channelPort=e.ports[0],this._setPortEventHandlers(t),this._postMessageToChannel({msgType:Ue.EnumDefs.MasterSlaveMessage.slaveHandShake}),this._postMessageToChannel({msgType:Ue.EnumDefs.MasterSlaveMessage.registerSlave}),this._postMessageToChannel({msgType:Ue.EnumDefs.MasterSlaveMessage.slaveAlive}),setInterval(this._postSlaveAliveMessage,this._configurationRepository.get(Ue.ConfigurationFields.slaveAliveMessageInterval),this))}},{key:"_postSlaveAliveMessage",value:function(e){e._postMessageToChannel({msgType:Ue.EnumDefs.MasterSlaveMessage.slaveAlive})}},{key:"_setPortEventHandlers",value:function(e){this._channelPort.onmessage=this._portMessageHandler(e),this._channelPort.onmessageerror=function(e){console.log("port error"),console.log(e)}}},{key:"_isChannelMessage",value:function(e){return"undefined"!=typeof e.ports&&Array.isArray(e.ports)&&0<e.ports.length&&e.data===Ue.EnumDefs.MasterSlaveMessage.cdHandShake}},{key:"_portMessageHandler",value:function(n){var i=this;return function(e){if("undefined"!=typeof e.ports&&Array.isArray(e.ports)){var t=JSON.parse(e.data);t.msgType===Ue.EnumDefs.MasterSlaveMessage.updateSlaveConf&&(n(t),i._sendBufferedMessagesToChannel())}}}},{key:"_sendToChannel",value:function(e){this.portIsOpen()?this._postMessageToChannel(e):this._enableBuffering&&this._preHandshakeBuffer.push(e)}},{key:"portIsOpen",value:function(){return null!==this._channelPort&&"undefined"!=typeof this._channelPort}},{key:"_postMessageToChannel",value:function(e){e.data===undefined&&(e.data={}),this._channelPort.postMessage(JSON.stringify(e))}},{key:"_sendBufferedMessagesToChannel",value:function(){var t=this;this._preHandshakeBuffer.map(function(e){return t._postMessageToChannel(e)}),this._clearBuffer()}},{key:"_clearBuffer",value:function(){this._preHandshakeBuffer&&0<this._preHandshakeBuffer.length&&(this._preHandshakeBuffer=[],this._enableBuffering=!1)}}]),t}(),(xe=Ye).ParentCommunicator=function(e){function n(e){Je(this,n);var t=ze(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.setMessagingPort(t),t._slaves=[],t._msgRouter={dataFromSlave:t._onDataFromSlave,registerSlave:t._onRegisterSlave,updateSlaveConf:t._onUpdateSlaveConf,updateSlaveState:t._onUpdateSlaveState,updateMasterContext:t._onUpdateMasterContext,resetSessionTriggerFromSlave:t._onResetSessionTriggerFromSlave,mouseChallengeTriggerFromSlave:t._onMouseChallengeTriggerFromSlave},t.messageEventHandler=e,t}return Ze(n,xe.WorkerCommunicator),Xe(n,[{key:"setonmessage",value:function(e){this._workerCommCallback=e}},{key:"registerToParent",value:function(){log.info("ParentRegisterer:registerToParent - registering to parent from slave. url: "+window.location.href),this.messageEventHandler.subscribeToMessageEvents(this._getChannelMessageCallback(),this._getWindowMessageCallback()),this.messageEventHandler.sendToParent({msgType:xe.EnumDefs.MasterSlaveMessage.registerSlave})}},{key:"sendToParent",value:function(e){this.messageEventHandler.sendToParent(e)}},{key:"sendToSlaves",value:function(t){log.debug("ParentCommunicator:sendToSlaves"),this._slaves.forEach(function(e){e.source.postMessage(t,e.origin)})}},{key:"notifyContextChange",value:function(e){"slave_cd_auto"!==e.name&&this.sendAsync(xe.EnumDefs.MasterSlaveMessage.updateMasterContext,e)}},{key:"notifyResetSession",value:function(e){this.sendAsync(xe.EnumDefs.MasterSlaveMessage.resetSessionTriggerFromSlave,e)}},{key:"notifyMouseChallenge",value:function(e){this.sendAsync(xe.EnumDefs.MasterSlaveMessage.mouseChallengeTriggerFromSlave,e)}},{key:"sendAsync",value:function(e,t){this.sendToParent({msgType:e,data:t})}},{key:"_onDataFromSlave",value:function(e){this.sendToParent(e.data)}},{key:"_onRegisterSlave",value:function(e){log.debug("ParentCommunicator:_onRegisterSlave - registering a sub slave"),this._slaves.push({source:e.source,origin:e.origin}),this.sendToParent(e.data)}},{key:"_onUpdateSlaveConf",value:function(e){log.debug("ParentCommunicator:_onUpdateSlaveConf - got config"),this.sendToSlaves(e.data),this._workerCommCallback(e)}},{key:"_onUpdateSlaveState",value:function(e){log.debug("ParentCommunicator:_onUpdateSlaveState"),this.sendToSlaves(e.data),this._workerCommCallback(e)}},{key:"_onUpdateMasterContext",value:function(e){log.debug("ParentCommunicator:_onUpdateMasterContext"),this.sendToParent(e.data)}},{key:"_onResetSessionTriggerFromSlave",value:function(e){log.debug("ParentCommunicator:_onResetSessionTriggerFromSlave"),this.sendToParent(e.data)}},{key:"_onMouseChallengeTriggerFromSlave",value:function(e){log.debug("ParentCommunicator:_onMouseChallengeTriggerFromSlave"),this.sendToParent(e.data)}},{key:"_getWindowMessageCallback",value:function(){var n=this;return function(e,t){t&&n._msgRouter[t]&&n._msgRouter[t].call(n,e)}}},{key:"_getChannelMessageCallback",value:function(){var t=this;return function(e){t._msgRouter[e.msgType]&&t._msgRouter[e.msgType].call(t,{data:e})}}}]),n}(),Ie=Ye,Be=function(){function e(){Je(this,e),this._eventHandlers=[]}return Xe(e,[{key:"loadSystem",value:function(e,t){var n=this;function i(e){for(var t in e)e.hasOwnProperty(t)&&!e[t].runInSlave&&delete e[t]}i(e.defaultFeatures),i(e.nonDefaultFeatures),i(e.perSessionFeatures),i(e.perContextFeatures),i(e.perPageReloadFeatures),this._configurationRepository=new Ie.ConfigurationRepository,this._parentCommunicator=new Ie.ParentCommunicator(new Ie.MessageEventHandler(this._configurationRepository));var s=new Ie.DataQ(this._parentCommunicator,null,null,"logPerfSlave"),r=this._perfMonitor=new(function(e){function n(){return Je(this,n),ze(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,s))}return Ze(n,Ie.PerfMonitor),Xe(n,[{key:"stopMonitor",value:function(e){var t=1<arguments.length&&arguments[1]!==undefined?arguments[1]:"slave:"+self.location.href;(function $e(t,n,i){null===t&&(t=Function.prototype);var s=Object.getOwnPropertyDescriptor(t,n);if(s===undefined){var r=Object.getPrototypeOf(t);return null===r?undefined:$e(r,n,i)}if("value"in s)return s.value;var o=s.get;return o===undefined?undefined:o.call(i)})(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"stopMonitor",this).call(this,e,t)}}]),n}()),o=new Ie.SiteMapper(self.MutationObserver,Ie.CDUtils,"contextConfiguration"),a=this._contextMgr=new Ie.ContextMgr(Ie.CDUtils,o,this._parentCommunicator),u=new(function(){function e(){Je(this,e)}return Xe(e,[{key:"log",value:function log(e,t){s.addToQueue("log",{msg:"SLAVE: "+e,url:a.url,level:t,sn:this.sn++})}}]),e}());u.sn=0;var c=new Ie.Logger(u);t.setLogger(c),this._msgBus=new Ie.MessageBus(Ie.CDUtils),this._parentCommunicator.addMessageListener(Ie.EnumDefs.MasterSlaveMessage.updateSlaveConf,function(e){n._configurationRepository.loadConfigurations(e),n._msgBus.publish(Ie.MessageBusEventType.ConfigurationLoadedEvent,n._configurationRepository)}),this._dataQ=new Ie.DataQ(this._parentCommunicator,this._contextMgr,null,"dataFromSlave"),this._sensorDataQ=new Ie.SensorsDataQueue(this._configurationRepository,this._dataQ,this._msgBus),"undefined"!=typeof WeakMap&&window.Worker?this._elementsUtils=new Ie.Elements(this._configurationRepository,Ie.CDUtils,this._dataQ,this._contextMgr,r):(log.warn("slave moving to unsupported mode in slave since there is no weak map"),this._unsupportedMgr=new Ie.UnsupportedMgr(null),this._unsupportedMgr.adjustFeatureList(e)),this._framesCache=new Ie.FramesCache,this._framesDetector=new Ie.FramesDetector(self.MutationObserver,Ie.CDUtils),this._frameHandler=this._unsupportedMgr?this._unsupportedMgr.getUnsFrameHandler():new Ie.FramesHandler(this._framesCache,this._framesDetector,Ie.CDUtils),this._featureService=new Ie.FeatureService(e,this._frameHandler,this._configurationRepository),this._pauseResumeMgr=new Ie.PauseResumeManager(this._featureService,this._configurationRepository,this._dataQ),this._parentCommunicator.addMessageListener(Ie.EnumDefs.MasterSlaveMessage.updateSlaveState,this._pauseResumeMgr.onStateChange.bind(this._pauseResumeMgr)),this._scriptsRepository=new Ie.ScriptsRepository(Ie.CDUtils),this._featureBuilder=new Ie.FeaturesBuilder(e,this._configurationRepository,Ie.CDUtils,this._elementsUtils,self.MutationObserver,this._dataQ,null,null,r,this._sensorDataQ,this._msgBus,this._scriptsRepository),this._contextMgr.onContextChange.subscribe(this._featureService.runPerContextFeatures.bind(this._featureService)),this._contextMgr.onContextChange.subscribe(this._parentCommunicator.notifyContextChange.bind(this._parentCommunicator));var l=new Ie.SiteMapper(self.MutationObserver,Ie.CDUtils,"resetSessionConfig");this._slaveResetSessionDetector=new Ie.SlaveResetSessionDetector(l),this._slaveResetSessionDetector.onResetSession.subscribe(this._parentCommunicator.notifyResetSession.bind(this._parentCommunicator));var h=new Ie.SiteMapper(self.MutationObserver,Ie.CDUtils,"challengeConfig");this._slaveMouseChallengeDetector=new Ie.SlaveMouseChallengeDetector(h),this._slaveMouseChallengeDetector.onMouseChallengeTrigger.subscribe(this._parentCommunicator.notifyMouseChallenge.bind(this._parentCommunicator)),this._eventHandlers.push(new Ie.SlaveConfigurationLoadedEventHandler(this._msgBus,this._featureService,this._dataQ,this._pauseResumeMgr,c,this._contextMgr,this._slaveResetSessionDetector,this._slaveMouseChallengeDetector)),this._contextMgr.changeContext("slave_cd_auto")}},{key:"getConfigurationRepository",value:function(){return this._configurationRepository}},{key:"getFeatureBuilder",value:function(){return this._featureBuilder}},{key:"getFeatureService",value:function(){return this._featureService}},{key:"getContextMgr",value:function(){return this._contextMgr}},{key:"getParentCommunicator",value:function(){return this._parentCommunicator}}]),e}(),Ie.SlaveSystemLoader=Be,(We=Ye).startSlave=function(){We.CDWPTCD["default"].setExport(We);var e=new We.CDWPTCD["default"].Application,t=new We.SlaveSystemLoader;return t.loadSystem(We.FeaturesList,We.log),e.initialize(!1),t.getFeatureService().buildFrameRelatedLists(),t.getFeatureBuilder().buildFeatures(We.FeaturesBuilder.BUILD_ALL),t.getFeatureService().runDefault(),t.getContextMgr().initContextHandling(),log.info("Started default features collection"),t.getParentCommunicator().registerToParent(),t},He=Ye,Qe=function(){function t(e){Je(this,t),this._resetSessionSiteMapper=e,this._resetSessionSiteMapper.updateObserver(this._onSiteMapperMatch.bind(this)),this.onResetSession=new He.CDEvent}return Xe(t,[{key:"onConfigUpdate",value:function(e){e.get("isSlaveResetSessionDetectionEnabled")===undefined||e.get("isSlaveResetSessionDetectionEnabled")?this._resetSessionSiteMapper.onConfigUpdate(e):this._resetSessionSiteMapper.stopTracking()}},{key:"_onSiteMapperMatch",value:function(){log.info("Slave detected a reset session from configuration."),this.onResetSession.publish({resetReason:He.EnumDefs.SNUM_CHANGE_TYPE.configurationFromSlave})}}]),t}(),He.SlaveResetSessionDetector=Qe,je=Ye,Ke=function(){function t(e){Je(this,t),this._mouseChallengeSiteMapper=e,this._mouseChallengeSiteMapper.updateObserver(this._onSiteMapperMatch.bind(this)),this.onMouseChallengeTrigger=new je.CDEvent}return Xe(t,[{key:"onConfigUpdate",value:function(e){e.get("isSlaveMouseChallengeDetectionEnabled")===undefined||e.get("isSlaveMouseChallengeDetectionEnabled")?this._mouseChallengeSiteMapper.onConfigUpdate(e):this._mouseChallengeSiteMapper.stopTracking()}},{key:"_onSiteMapperMatch",value:function(e){log.info("Slave detected a mouse challenge required from configuration."),e.timers&&this.onMouseChallengeTrigger.publish(e.timers)}}]),t}(),je.SlaveMouseChallengeDetector=Ke,qe=Ye,Ve=function(){function u(e,t,n,i,s,r,o,a){Je(this,u),this._messageBus=e,this._featureService=t,this._dataQ=n,this._pauseResumeMgr=i,this._logger=s,this._contextMgr=r,this._slaveResetSessionDetector=o,this._slaveMouseChallengeDetector=a,this._messageBus.subscribe(qe.MessageBusEventType.ConfigurationLoadedEvent,this._handle.bind(this))}return Xe(u,[{key:"_handle",value:function(e){this._featureService.updateRunByConfig(e),this._dataQ.updateWithConfig(e),this._pauseResumeMgr.onConfigUpdate(e),this._logger.updateLogConfig(e),this._contextMgr.onConfigUpdate(e),this._slaveResetSessionDetector.onConfigUpdate(e),this._slaveMouseChallengeDetector.onConfigUpdate(e)}}]),u}(),qe.SlaveConfigurationLoadedEventHandler=Ve;var log=Ye.log;Ye.startSlave()};