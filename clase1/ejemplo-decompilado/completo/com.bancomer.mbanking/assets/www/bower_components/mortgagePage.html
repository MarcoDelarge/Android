<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="glomo-opx-mortgage-certificated-dm" assetpath="glomo-opx-mortgage-certificated-dm/"><template><cells-dm-global-apis-loans id="apiLoans" offer-id="[[offerId]]" host="[[host]]" loans-api-version="[[loanApiVersion]]" on-set-offer-detail="processOfferDetail" on-get-offer-detail-quotations-simulate="responseSimulate" on-error-on-post-loan-offer-detail-quotations-simulate="processErrorSimulate" on-error-on-get-loan-offer-detail="processErrorOfferDetail"></cells-dm-global-apis-loans><cells-glomo-dm-loans id="dmLoan" on-success-response-proposals="successResponseProposals" on-proposals-error-from-dm="errorResponseProposals" global-server-config="[[globalServerConfig]]"></cells-glomo-dm-loans><cells-glomo-dm-customers id="dmCustomers" on-return-user-email="setUserEmail" global-server-config="[[globalServerConfig]]" global-cache-storage="[[globalCacheStorage]]"></cells-glomo-dm-customers></template><script>/*global moment */var GlomoOpxMortgageCertificatedDm=/*#__PURE__*/function(_Polymer$mixinBehavio){babelHelpers.inherits(GlomoOpxMortgageCertificatedDm,_Polymer$mixinBehavio);function GlomoOpxMortgageCertificatedDm(){babelHelpers.classCallCheck(this,GlomoOpxMortgageCertificatedDm);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(GlomoOpxMortgageCertificatedDm).apply(this,arguments))}babelHelpers.createClass(GlomoOpxMortgageCertificatedDm,[{key:"_offerIdComputed",/** @desc computed to get offerId by offerData */value:function _offerIdComputed(offerData){return offerData&&offerData.offerId?offerData.offerId:""}/**
   * @desc observer to itemSelected to generate simulate
   * @param currentValue
   * @param oldValue
   * @private
   */},{key:"_itemSelectedObserver",value:function _itemSelectedObserver(currentValue,oldValue){if(currentValue&&oldValue){if(currentValue!==oldValue){this.set("amountSelected",0);this.set("oldAmount",1)}this._updatedRequest(this.itemSelected,this.sliderSelected)}}/**
   * @desc observer to amountSelected to generate simulate
   * @param currentValue, oldValue
   * @private
   */},{key:"_sliderSelectedObserver",value:function _sliderSelectedObserver(currentValue,oldValue){if(currentValue&&oldValue){if(currentValue!==oldValue){this.set("amountSelected",0)}this._updatedRequest(this.itemSelected,this.sliderSelected)}}/**
   * @desc observer function validate the properties to generate the simulation request
   * @param {*} amountSelected, itemSelected, sliderSelected
   */},{key:"_updatedRequest",value:function _updatedRequest(){var itemSelected=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},sliderSelected=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,amountSelected=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if(itemSelected&&itemSelected.id&&sliderSelected&&!this.waitSimulation){this._generateSimulator()}}/**
   * @desc this function generate the request by bgadb admin
   * @private
   */},{key:"_requestOfferDetail",value:function _requestOfferDetail(){this._genericDispatchEvent("show-spinner");var apiLoans=this.shadowRoot.querySelector("cells-dm-global-apis-loans");apiLoans.getOfferDetail()}/**
   * @desc get payload by responseSuccess from apiLoans dm
   * @param payload
   */},{key:"processOfferDetail",value:function processOfferDetail(payload){if(payload&&payload.detail){var offerDetail=payload.detail;this._itemSelectedGenerate(offerDetail.details);this._amountDataGenerate(offerDetail.details);this._sliderPropertyGenerate(offerDetail.details);this._keyInfoGenerate(offerDetail.rates,offerDetail.fees);this._customMessageGenerate(offerDetail.rates,offerDetail.period);this._stickyDataGenerate(offerDetail.details);this.limitOffer(offerDetail.period);this._genericDispatchEvent("hide-spinner")}}/**
   * @desc return itemSelected array from offerDetail.details
   * @param details
   * @returns {[]}
   * @private
   */},{key:"_itemSelectedGenerate",value:function _itemSelectedGenerate(details){var _this=this;if(details&&details.allowedSubproducts){var translation="",newList=details.allowedSubproducts.map(function(item){if("TERRENO"===item.subproductType.name){translation="GROUND"}else if("ADQUISICION"===item.subproductType.name){translation="ACQUISITION"}else if("LIQUIDEZ"===item.subproductType.name){translation="LIQUIDITY"}else if("PAGOHIPOTECA"===item.subproductType.name){translation="PAYMENTPAYMENT"}else{translation="REMODELING"}return{id:item.subproductType.id,name:_this.t("offer-mortgage-certificated-modal-selected-title-")+translation.toLowerCase(),description:_this.t("offer-mortgage-certificated-modal-selected-")+translation.toLowerCase()}});this.set("items",newList);this.set("itemSelected",this.items[0])}}/**
   * @desc computed amountData object from offerDetails.details
   * @param details
   * @returns {{amountMax: *, amountDefault: *, amountMin: *, iconSize: string, iconCode: string, label: string}}
   * @private
   */},{key:"_amountDataGenerate",value:function _amountDataGenerate(details){if(details&&details.suggestedAmount){var data={amountDefault:this._truncatedDecimals(details.suggestedAmount.amount),amount:this._truncatedDecimals(details.suggestedAmount.amount),amountMin:Math.ceil(details.minimumAmount.amount),amountMax:this._truncatedDecimals(details.maximumAmount.amount),iconSize:"icon-size-26",iconCode:"coronita:close",label:"glomo-loan-offer-input-label-mortgage"};this.set("amountData",data);this.set("amountSelected",this._truncatedDecimals(details.suggestedAmount.amount));this.set("oldAmount",this._truncatedDecimals(details.suggestedAmount.amount));this.set("currency",details.suggestedAmount.currency);this.set("amountResult",this._truncatedDecimals(details.suggestedAmount.amount))}}/**
   * @desc function that helps to save the amount of the amountSelecter
   * @param {*} newAmount
   */},{key:"_amountSelected",value:function _amountSelected(newAmount){this.set("oldAmount",this.amountSelected);this.set("amountSelected",this._truncatedDecimals(newAmount))}/**
   * @desc function to show the sticky after doing the focus on the input
   */},{key:"inputFocus",value:function inputFocus(){this._genericDispatchEvent("hidden-sticky","sticky-detached")}/**
   * function to save the value of sliderSelected
   * @param {*} newAmount
   */},{key:"_sliderSelected",value:function _sliderSelected(newAmount){this.set("oldAmountSlider",this.sliderSelected);this.set("sliderSelected",newAmount)}/**
   * @desc generate sliderSelected by offerDetails
   * @param details
   * @private
   */},{key:"_sliderPropertyGenerate",value:function _sliderPropertyGenerate(details){if(details&&details.allowedTerms){var snaps=details.allowedTerms.sort(function(itemA,itemB){return itemA.number-itemB.number}).map(function(item){return item.number}),snapsConvert=snaps.map(function(item){return{month:item,year:Math.round(item/12)}}),years=snaps.map(function(item){return Math.round(item/12)}),stepYears=years[1]-years[0],suggestedTerm=details.suggestedTerm?details.suggestedTerm.number:details.allowedTerms[details.allowedTerms.length-1],indexSuggestedTerm=snaps.indexOf(suggestedTerm),data={sliderDescription:"glomo-loan-offer-slider-description-mortgage",min:years[0],max:years[years.length-1],step:stepYears,snaps:years,unit:"".concat(this.t("offer-mortgage-certificated-slider-unit")),sliderValue:years[indexSuggestedTerm]};this.set("snapsConvert",snapsConvert);this.set("sliderProperty",data);this.set("sliderSelected",data.sliderValue)}}/**
   * @desc generate keyInfo object from offerDetail.rates
   * @param rates
   * @returns {[]}
   * @private
   */},{key:"_keyInfoGenerate",value:function _keyInfoGenerate(rates,fees){var _this2=this,dataList=[],listRates=[],listFees=[];if(rates&&rates.length){var list=rates.map(function(item){var rateType=item.rateType.id;switch(rateType){case"CAT":return{key:"glomo-loan-offer-taxes-text-1-mortgage",value:"".concat(item.unit.percentage.toFixed(1),"%"),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:item.rateType.id,eventModal:"event-modal-info-".concat(item.rateType.id),classInfoValue:"values-bold"};case"TASA_MENSUAL":_this2.set("rateValue",item.unit.percentage);return{key:"glomo-loan-offer-taxes-text-2-mortgage",value:"".concat(item.unit.percentage.toFixed(2),"%"),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:item.rateType.id,eventModal:"event-modal-info-".concat(item.rateType.id),classInfoValue:"values-bold"};default:return!1;}});listRates=list.filter(Boolean)}if(fees&&fees.itemizeFees.length){var itemizeFees=fees.itemizeFees,_list=itemizeFees.map(function(item){var feeType=item.feeType.id;switch(feeType){case"COMISION APERTURA":return{key:"glomo-loan-offer-costs-text-one-mortgage",value:"".concat(item.percentage.toFixed(2),"%"),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:item.feeType.id,eventModal:"event-modal-info-".concat(item.feeType.id)};case"COMISION DIFERIDA":return{key:"glomo-loan-offer-costs-text-two-mortgage",value:"".concat(item.percentage.toFixed(2),"%"),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:item.feeType.id,eventModal:"event-modal-info-".concat(item.feeType.id)};default:return!1;}}),listOrder=_list.slice(0);listOrder.sort(function(firstCost,secondCost){var deferred=firstCost.id,opening=secondCost.id;return deferred<opening?-1:deferred>opening?1:0});listFees=listOrder.filter(Boolean)}else{var percentage=[];if(0===this.keyInfo.length){percentage=["0.00%","0.30%"]}else{percentage=[this.keyInfo[0].keyValues[0].value,this.keyInfo[0].keyValues[1].value]}var _list2=[{key:"glomo-loan-offer-costs-text-one-mortgage",value:"".concat(percentage[0]),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:"COMISION_UNO",eventModal:"event-modal-info-COMISION APERTURA"},{key:"glomo-loan-offer-costs-text-two-mortgage",value:"".concat(percentage[1]),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:"COMISION_DOS",eventModal:"event-modal-info-COMISION DIFERIDA"}];listFees=_list2}dataList.push({title:"glomo-loan-offer-principal-list-costs",keyValues:listFees},{title:"offer-mortgage-certificated-key-info-title",keyValues:listRates});this.set("keyInfo",dataList)}/**
   * @desc generate stickyData from some
   * @param details
   * @returns {{monthlyPayment: number, secondPaymentText: string, hasStickyAmount: boolean, paymentText: string}}
   * @private
   */},{key:"_stickyDataGenerate",value:function _stickyDataGenerate(detail){var _this3=this;if(detail&&detail.loanBreakDown){detail.loanBreakDown.find(function(item){if("INSTALLMENT"===item.id&&item.amount){_this3.set("stickyData",{monthlyPayment:item.amount,currency:item.currency,hasStickyAmount:!0,paymentText:_this3.t("offer-mortgage-certificated-sticky-amount-top"),secondPaymentText:"".concat(_this3.t("offer-mortgage-certificated-sticky-amount-bottom"))})}})}}/**
   * @desc return customElement from some response
   * @param details
   * @private
   */},{key:"_customMessageGenerate",value:function _customMessageGenerate(rates,period){var _this4=this;if(rates&&rates.length){var startDate="";if(!period){startDate=this.validityDate}else{this.set("validityDate",period.startDate);startDate=this.validityDate}rates.find(function(item){if("CAT"===item.rateType.id){var catDecimals=item.unit.percentage.toFixed(1);_this4.set("customMessage",{message:"<div><strong>*".concat(item.rateType.id," ").concat(catDecimals,"%</strong>\n            ").concat(_this4.t("offer-mortgage-certificated-custom-label")," ").concat(_this4._getTimeFormat(item.calculationDate),".\n            ").concat(_this4.t("offer-mortgage-certificated-custom-validity")," ").concat(_this4._getTimeFormat(startDate),".\n            </div><br><span>").concat(_this4.t("offer-mortgage-certificated-custom-info"),"</span>"),button:!0})}})}}/**
   * @desc initialize mortgage offer detail start
   * @param payload
   */},{key:"init",value:function init(){if(this.offerData&&this.offerId){this.lastActiveStep=null;this.canExecute=!1;this.hasFinished=!1;this._lastResponse=null;this.currentStep=1;this._requestOfferDetail();this._getUserEmail();this._genericDispatchEvent("hidden-sticky","")}}/**
   * @desc get the response object error
   * @param payload
   */},{key:"processErrorOfferDetail",value:function processErrorOfferDetail(event){this._genericDispatchEvent("hide-spinner");this._errorOffer(event.detail)}/**
   * @desc show error modal when offer api fail
   */},{key:"_errorOffer",value:function _errorOffer(errorMessage){var modalPayload={code:"offer-error",selectedConfig:{className:"header--white-navy-blue error mortgage-confirm",openMaximized:!0,iconOnlyFullHeight:!0,title:"offer-mortgage-certificated-header-title",acceptBtLabel:"offer-mortgage-certificated-button-exit",heroImage:"./images/general_error.svg",template:{type:"iconMessage",values:{type:"error",message:"cells-product-summary-deposit-error"}}}};this._genericDispatchEvent("error-offer",modalPayload)}/** @desc generate the simulation request */},{key:"_generateSimulator",value:function _generateSimulator(){var _this5=this;this.snapsConvert.find(function(item){if(item.year===_this5.sliderSelected){_this5.set("termMonth",item.month)}});var requestBody={initialAmount:{amount:this.amountSelected,currency:this.currency},terms:{number:this.termMonth,frequency:"MONTHLY"},product:{subproduct:{id:this.itemSelected.id}}},apiLoans=this.shadowRoot.querySelector("cells-dm-global-apis-loans");this.set("waitSimulation",!0);this._genericDispatchEvent("show-spinner");apiLoans.postOfferDetailQuotationsSimulate(requestBody);if(this.oldAmount!==this.amountSelected){this.set("oldAmount",this.amountSelected)}else{this._genericDispatchEvent("hide-spinner")}this._genericDispatchEvent("hidden-sticky","")}/**
   * @desc recived succes response by simulation
   * @param {*} payload
   */},{key:"responseSimulate",value:function responseSimulate(payload){if(payload&&payload.detail){var groosAmount=payload.detail.loanBreakDown;if(groosAmount&&groosAmount.length){this.set("amountResult",groosAmount[1].amount)}this.set("waitSimulation",!1);var terms=+(payload.detail.terms.number+"").substring(1),selectedSimulated=this._fountYearTerms(terms);if(selectedSimulated.year===this.sliderSelected){var simulate=payload.detail;this._keyInfoGenerate(simulate.rates,simulate.fees);this._stickyDataGenerate(simulate);this._customMessageGenerate(simulate.rates,simulate.period);this._updatedAmountMaxSimulate(simulate.loanBreakDown,simulate.minimumAmount);this._sliderPropertyGenerate(simulate);this._genericDispatchEvent("hide-spinner")}else{this.set("sliderSelected",selectedSimulated.year)}}}/**
   * @desc updated amountMax in amountData by simulate response
   * @param loanBreakDown
   * @private
   */},{key:"_updatedAmountMaxSimulate",value:function _updatedAmountMaxSimulate(loanBreakDown,minimumAmount){var _this6=this;if(loanBreakDown&&loanBreakDown.length){var minAmount=0;if(minimumAmount){minAmount=this._truncatedDecimals(minimumAmount.amount)}loanBreakDown.find(function(item){if("GROSS_AMOUNT"===item.id&&item.amount!==_this6.amountSelected){_this6.set("amountData",{amountMin:minAmount,amountDefault:_this6._truncatedDecimals(item.amount),amount:_this6._truncatedDecimals(item.amount),amountMax:_this6._truncatedDecimals(item.amount),iconSize:"icon-size-26",iconCode:"coronita:close",label:"glomo-loan-offer-input-label-mortgage"});_this6.set("oldAmount",_this6.amountSelected)}})}}/**
   * @desc recived error response by simulation
   * @param {*} payload
   */},{key:"processErrorSimulate",value:function processErrorSimulate(event){this._genericDispatchEvent("hide-spinner");this.set("waitSimulation",!1);this._pageErrorResponse(event.detail)}/**
   * @desc return the date with format
   * @param time
   */},{key:"_getTimeFormat",value:function _getTimeFormat(time){return moment(time).format("D [de] MMMM [de] YYYY")}/**
   * @desc function to display text in different manners
   * @param (payload)
   * @private
   */},{key:"_modalsInfo",value:function _modalsInfo(payload){var textModal={};switch(payload){case"event-modal-info-COMISION APERTURA":textModal={titleHeader:"offer-mortgage-certificated-title-cost-open",typeIcon:"coronita:help",text:"offer-mortgage-certificated-text-cost-open",buttonAcepted:"offer-mortgage-certificated-button-modal"};this._genericDispatchEvent("register-apertura");this._customEvent("modals-event",textModal);break;case"event-modal-info-COMISION DIFERIDA":textModal={titleHeader:"offer-mortgage-certificated-title-comission",typeIcon:"coronita:help",text:this.t("offer-mortgage-certificated-text-cost-comission-charge")+this.t("offer-mortgage-certificated-text-cost-comission-generation")+"".concat(this.t("offer-mortgage-certificated-text-cost-comission-payment"),"<br><br>")+this.t("offer-mortgage-certificated-text-cost-comission-amount")+this.t("offer-mortgage-certificated-text-cost-comission-information-brochure"),buttonAcepted:"offer-mortgage-certificated-button-modal"};this._genericDispatchEvent("register-diferida");this._customEvent("modals-event",textModal);break;case"event-modal-info-CAT":textModal={titleHeader:"offer-mortgage-certificated-title-cat",typeIcon:"coronita:help",text:"offer-mortgage-certificated-text-cat",buttonAcepted:"offer-mortgage-certificated-button-modal"};this._genericDispatchEvent("register-cat");this._customEvent("modals-event",textModal);break;case"event-modal-info-TASA_MENSUAL":textModal={titleHeader:"offer-mortgage-certificated-title-rate",typeIcon:"coronita:help",text:"".concat(this.t("offer-mortgage-certificated-text-rate-description"),"<br><br>")+this.t("offer-mortgage-certificated-text-rate-iva"),buttonAcepted:"offer-mortgage-certificated-button-modal"};this._genericDispatchEvent("register-tasa");this._customEvent("modals-event",textModal);break;case"event-modal-conditions":textModal={titleHeader:"offer-mortgage-certificated-conditions",typeIcon:"coronita:info",title:"offer-mortgage-certificated-title-certificated",text:this.t("offer-mortgage-certificated-text-get-certificate")+"<strong class='strong'>".concat(this.t("offer-mortgage-certificated-text-modifications"),"</strong>")+"".concat(this.t("offer-mortgage-certificated-text-adjust-conditions"),"<br><br>")+this.t("offer-mortgage-certificated-text-generate-certificate")+this.t("offer-mortgage-certificated-text-remember"),buttonAcepted:"offer-mortgage-certificated-button-modal"};this._customEvent("modal-contiditons",textModal);break;case"terms-conditions-modals":textModal={titleHeader:"offer-mortgage-certificated-terms-conditions-title",typeIcon:"coronita:info",text:"".concat(this.t("offer-mortgage-certificated-terms-conditions-text-know"),"<br><br>")+"".concat(this.t("offer-mortgage-certificated-terms-conditions-text-binding-offer"),"<br><br>")+"".concat(this.t("offer-mortgage-certificated-terms-conditions-text-amount-credit"),"<br><br>")+"".concat(this.t("offer-mortgage-certificated-terms-conditions-text-query"),"<br><br>")+this.t("offer-mortgage-certificated-terms-conditions-text-more-info"),buttonAcepted:"offer-mortgage-certificated-button-modal"};this._customEvent("terms-modals",textModal);break;case"burea-credit-modal":textModal={titleHeader:"offer-mortgage-certificated-bureau-credit-title",typeIcon:"coronita:info",title:"offer-mortgage-certificated-bureau-credit-subtitle",text:"".concat(this.t("offer-mortgage-certificated-bureau-credit-text-authorization"),"<br><br>")+this.t("offer-mortgage-certificated-bureau-credit-text-scope-info"),buttonAcepted:"offer-mortgage-certificated-button-modal"};this._customEvent("terms-modals",textModal);break;case"open-simulated-error":textModal={titleHeader:"offer-mortgage-certificated-header-title",subTitle:"offer-mortgage-certificated-title-error-simulated",text:this.t("offer-mortgage-certificated-text-error-simulated"),heroImage:"./images/general_error.svg",buttonAcepted:"offer-mortgage-certificated-button-retry",onAcceptEvent:"reload-button",cancelar:"offer-mortgage-certificated-button-exit",onCancelEvent:"out-page"};this._customEvent("simulate-error",textModal);break;default:break;}}/**
   * @desc creation of the modal under its components
   * @private
   */},{key:"_customEvent",value:function _customEvent(name,data){var detail={code:"HELP_INFO",selectedConfig:{hideCloseIcon:!1,className:"info mortgage-header",title:this.t(data.titleHeader),heroImage:data.heroImage,openMaximized:!0,acceptBtLabel:this.t(data.buttonAcepted),onAcceptEvent:"",cancelBtLabel:this.t(data.cancelar),onCancelEvent:"",template:{type:"paragraphs",values:[{title:this.t(data.subTitle),class:"spacing"},{icon:this.t(data.typeIcon)},{text:this.t(data.title),class:"mortgage-modal-title"},{text:this.t(data.text)}]}}};this._genericDispatchEvent(name,detail)}/**
   * @desc function that dispatch modal when the simulate failed
   * @private
   */},{key:"_pageErrorResponse",value:function _pageErrorResponse(){var errorResponse=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},isBlockingError=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,detail={icon:"glomo:general-error",headerTitleText:"offer-mortgage-certificated-header-title",isBlockingError:isBlockingError,failureText:errorResponse&&errorResponse.errorCode&&errorResponse.errorMessage?"".concat(errorResponse.errorCode," ").concat(errorResponse.errorMessage):this.t("cells-product-summary-deposit-error"),primaryButtonText:"glomo-service-box-error-screen-btn"};this._genericDispatchEvent("error-response",detail)}/** @desc function that gives name to the shot of terms and conditions step */},{key:"_modalConditions",value:function _modalConditions(){this._modalsInfo("terms-conditions-modals")}/** @desc function that gives name to the credit bureau shot step */},{key:"_modalBurea",value:function _modalBurea(){this._modalsInfo("burea-credit-modal")}/**
   * @desc generate a CustomEvent Generic
   * @param nameEvent, detail
   * @private
   */},{key:"_genericDispatchEvent",value:function _genericDispatchEvent(nameEvent){var detail=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;this.dispatchEvent(new CustomEvent(nameEvent,{detail:detail}))}/**
   * @desc clean up properties when the page is out
   * @private
   */},{key:"_cleanUp",value:function _cleanUp(){this.set("items",[]);this.set("itemSelected",{});this.set("amountData",{});this.set("sliderProperty",{});this.set("keyInfo",[]);this.set("stickyData",{});this.set("customMessage","");this.set("amountSelected",0);this.set("sliderSelected",0);this.set("snapsConvert",[]);this.reset();this.resetChecks();var data={selected:0,itemSelected:""};this.set("headerClass","");this._headerColorChange();this.initSteps();this.onAnyStepCollapsedChanged();this._genericDispatchEvent("reset-modal-selected",data)}/**
   * @desc this function send a event when this flow is closed
   */},{key:"_mortgageClosed",value:function _mortgageClosed(){this._genericDispatchEvent("mortgage-certificated-closed");this._cleanUp()}/**
   * @desc generate a CustomEvent to step
   * @param currentStepKey
   */},{key:"goNextStep",value:function goNextStep(currentStepKey){this.set("headerClass","mortgage-step-header");this.currentStep=currentStepKey;this.setSteps();this.onAnyStepCollapsedChanged();var payload={currency:this.currency,amount:this.amountSelected,rate:this.rateValue,paymentAmount:this.stickyData.monthlyPayment,typeLoan:this.t(this.itemSelected.name),laps:this.sliderSelected};if(1===currentStepKey){this.loadTerms(payload)}if(2===currentStepKey){this.loadFinalStep(payload)}}/** @desc set propertie to show header of collapsed */},{key:"_showHeader",value:function _showHeader(){this._genericDispatchEvent("show-header",{hideHeader:!1})}/** @desc  set propertie to show hide of collapsed */},{key:"_hideHeader",value:function _hideHeader(){this._genericDispatchEvent("hide-header",{hideHeader:!0})}/** @desc function to collapse and change the header color */},{key:"_headerColorChange",value:function _headerColorChange(){this._hideHeader();this.set("headerClass","mortgage-certificated")}/** @desc  set the object with the custom preferences */},{key:"resultSuccess",value:function resultSuccess(response){if(response&&response.id){var timeToday=new Date,segundos="0"+timeToday.getSeconds(),time="".concat(timeToday.getHours(),":").concat(timeToday.getMinutes(),":").concat(segundos.slice(-2)),resultObject=response,certificate={title:"offer-mortgage-certificated-success-title",date:"".concat(resultObject.creationDate,"T").concat(time),amountLabel:"offer-mortgage-certificated-amount-label",chargeAmount:{amount:"".concat(resultObject.requestedAmount.amount),currency:"$",class:"amount-huge-decimals",decimalsHidden:!0},headerListInfo:[{key:"glomo-step-loan-offer-monthly-payment",value:"$ ".concat(resultObject.installmentPlan.installmentAmount.amount.toLocaleString("en-US"))},{key:"glomo-loan-offer-costs-text-one-mortgage",value:"".concat(this.keyInfo[0].keyValues[0].value),class:"spacing"},{key:"glomo-loan-offer-costs-text-two-mortgage",value:"".concat(this.keyInfo[0].keyValues[1].value),class:"spacing"},{key:"offer-mortgage-certificated-cat-vat",value:"".concat(this.keyInfo[1].keyValues[0].value),class:"bold spacing mortgage-success-value"},{key:"offer-mortgage-certificated-interest-rate",value:"".concat(this.keyInfo[1].keyValues[1].value),class:"bold spacing mortgage-success-value"}],origin:{avatar:{src:"./images/mortgage-success.svg",type:"receipt"},product:{name:" "}},topInfo:[{key:"offer-mortgage-certificated-term",value:"".concat(this.get("sliderSelected")," ").concat(this.t("offer-mortgage-certificated-slider-unit")),class:"bold spacing mortgage-spacing-top"},{key:"offer-mortgage-certificated-type-credit",value:this.get("itemSelected.name"),class:"bold spacing lg"},{key:"offer-mortgage-certificated-date-limit",value:"".concat(this._getTimeFormat(resultObject.expirationDate)),class:"bold spacing"},{key:"offer-mortgage-certificated-folio",value:"".concat(resultObject.id),class:"bold"}],message:{type:"info",text:"offer-mortgage-certificated-message-text",icon:"coronita:info"},bottomInfo:[{key:"offer-mortgage-certificated-email",value:this.userEmail,class:"bold spacing mortgage-spacing-bottom"},{value:"offer-mortgage-certificated-consultation-cancellation",class:"spacing mortgage-spacing-bottom italics"}],buttons:{primary:{hidden:!0},secondary:{hidden:!0}},operations:[{label:"offer-mortgage-certificated-branch-offices",id:"place",icon:"coronita:place"},{label:"offer-mortgage-certificated-center-attention",id:"share",icon:"coronita:telephone",phoneNumber:"5535470494",showConfirmation:!0}]},payload={currency:this.currency,amount:this.amountSelected,rate:this.rateValue,paymentAmount:this.stickyData.monthlyPayment,typeLoan:this.t(this.itemSelected.name),laps:this.sliderSelected};this._genericDispatchEvent("show-certificate-success",certificate);this._genericDispatchEvent("tag-load-success",payload)}}/** @desc open modal to confirm before exit */},{key:"openModalConfirm",value:function openModalConfirm(){var modalAlert={code:"MC-LOAN",selectedConfig:{className:"alert-modal mortgage-confirm",openMaximized:!1,iconOnlyFullHeight:!0,acceptBtLabel:"glomo-oc-loan-error-button-text",cancelBtLabel:"glomo-oc-loan-error-button2-text",template:{type:"iconMessage",values:{icon:"coronita:alert",type:"error",message:"".concat(this.t("glomo-oc-loan-error-text")," <br/> ").concat(this.t("glomo-oc-loan-error2-text"))}}}};this._genericDispatchEvent("open-modal-exit",modalAlert)}/** @desc Reset all steps when the page becomes inactive */},{key:"reset",value:function reset(pageStatus){this._hideHeader();if(pageStatus&&!pageStatus.value){this.resetSteps()}}/** @desc Reset checks of terms and conditions */},{key:"resetChecks",value:function resetChecks(){var clean=[{checked:!1,label:"offer-mortgage-certificated-terms-accepted"},{checked:!1,label:"offer-mortgage-certificated-terms-accepted-bureau"}];this._genericDispatchEvent("reset-checks",clean)}/** @desc function to truncate the decimals */},{key:"_truncatedDecimals",value:function _truncatedDecimals(amount){return Math.trunc(amount)}/** @desc function to tag when load terms and conditions */},{key:"loadTerms",value:function loadTerms(payload){this._genericDispatchEvent("register-check-terms",payload)}/** @desc function to tag when load cta-container, final step */},{key:"loadFinalStep",value:function loadFinalStep(payload){this._genericDispatchEvent("register-final-step",payload)}/** @desc generate proposals object */},{key:"generateProposals",value:function generateProposals(){this._genericDispatchEvent("show-spinner");var truncateAmount=this._truncatedDecimals(this.amountResult),proposalsObject={requestedAmount:{amount:truncateAmount.toString(),currency:this.currency},product:{id:"0HIP",subproduct:{id:this.itemSelected.id}},installmentPlan:{terms:{number:this.termMonth.toString(),frequency:"MONTHLY"}},loanType:{id:"MORTGAGE"}},dmLoan=this.shadowRoot.querySelector("cells-glomo-dm-loans");dmLoan.requestPostProposal(proposalsObject);var payload={currency:this.currency,amount:this.amountSelected,rate:this.rateValue,paymentAmount:this.stickyData.monthlyPayment,typeLoan:this.t(this.itemSelected.name),laps:this.sliderSelected};this._genericDispatchEvent("tag-load-softoken",payload)}/**
   * @desc get success response by native request to loan && customer DM component
   * @param response
   */},{key:"successResponseHandler",value:function successResponseHandler(response){var dmLoan=this.shadowRoot.querySelector("cells-glomo-dm-loans");dmLoan.successResponseHandler(response);var dmCustomers=this.shadowRoot.querySelector("cells-glomo-dm-customers");dmCustomers.successResponseHandler(response)}/**
   * @desc get error response by native request to loan && customer DM component
   * @param errorResponse
   */},{key:"errorResponseHandler",value:function errorResponseHandler(errorResponse){var dmLoan=this.shadowRoot.querySelector("cells-glomo-dm-loans"),dmCustomers=this.shadowRoot.querySelector("cells-glomo-dm-customers");dmLoan.errorResponseHandler(errorResponse);dmCustomers.errorResponseHandler(errorResponse)}/**
   * @desc get success response from loan DM component
   * @param response
   */},{key:"successResponseProposals",value:function successResponseProposals(response){if(response&&response.detail){var detail=response.detail;this._genericDispatchEvent("hide-spinner");this.resultSuccess(detail)}}/** @desc get error response from loan DM component */},{key:"errorResponseProposals",value:function errorResponseProposals(event){this._genericDispatchEvent("hide-spinner");this._pageErrorResponse(event.detail,!0)}/** @desc request user email from customer DM component */},{key:"_getUserEmail",value:function _getUserEmail(){var dmCustomers=this.shadowRoot.querySelector("cells-glomo-dm-customers");dmCustomers.getUserEmail()}/**
   * @desc get user email response from customer DM component
   * @param payload
   */},{key:"setUserEmail",value:function setUserEmail(payload){if(payload&&payload.detail){this.set("userEmail",payload.detail)}}/** @desc Funtion to calculate limit of offer */},{key:"limitOffer",value:function limitOffer(period){if(period&&period.endDate){var limit=this._getTimeFormat(period.endDate);this.set("dateOfferLimit",limit)}}/**
   * @desc gets year by simulationResponse.terms.number
   * @param {*} sliderSelected
   */},{key:"_fountYearTerms",value:function _fountYearTerms(sliderSelected){var itemSnap=this.snapsConvert.find(function(item){if(item.month===sliderSelected){return item}});return itemSnap?itemSnap:this.snapsConvert[this.snapsConvert.length-1]}}],[{key:"is",get:function get(){return"glomo-opx-mortgage-certificated-dm"}},{key:"properties",get:function get(){return{/** @desc Principal Object */offerData:{type:Array,value:function value(){return[]}},/** @desc allowedSubproducts from offerDetail */items:{type:Array,value:function value(){return[]},notify:!0},/** @desc Object to catch type of loans */itemSelected:{type:Object,value:function value(){return{}},notify:!0,observer:"_itemSelectedObserver"},/** @desc min, max and suggested amount from offerDetail */amountData:{type:Object,value:function value(){return{}},notify:!0},/** @desc slider items */sliderProperty:{type:Object,value:function value(){return{}},notify:!0},/** @desc slider items */keyInfo:{type:Array,value:function value(){return[]},notify:!0},/** @desc sticky object from offerData */stickyData:{type:Object,value:function value(){return{}},notify:!0},/** @desc customElement rates */customMessage:{type:String,value:"",notify:!0},/** @desc offerId from offer in dashboard */offerId:{type:String,value:"",computed:"_offerIdComputed(offerData)"},/** @desc amountSelected select by user to simulate */amountSelected:{type:Number,value:0,notify:!0},/** @desc  */oldAmount:{type:Number,value:0,notify:!0},/** @desc  */oldAmountSlider:{type:Number,value:0,notify:!0},/** @desc sliderSelected by user to simulate */sliderSelected:{type:Number,value:0,notify:!0,observer:"_sliderSelectedObserver"},/** @desc save the snaps to months and years */snapsConvert:{type:Array,value:function value(){return[]}},/** @desc class for app header */headerClass:{type:String,value:"mortgage-certificated",notify:!0},/** @desc host from app config */host:{type:String,value:""},/** @desc Loan services version */loanApiVersion:{type:Number,value:0},/** @desc Property to save rate anual */rateValue:{type:Number,value:0},termMonth:{type:Number,value:0},/** @desc currency local */currency:{type:String,value:"MXN"},/** @desc user email **/userEmail:{type:String,value:""},/** @desc save enable status simulate  */waitSimulation:{type:Boolean,value:!1},/** chache storage to reduce nertwork calls */globalCacheStorage:{type:Object},/** global server config retived from native */globalServerConfig:{type:Object},/** @desc certificate validation deadline */dateOfferLimit:{type:String,value:"",notify:!0},/** @desc CAT validation date */validityDate:{type:String,value:""},/** @desc property to save the amountSelected */amountResult:{type:Number,value:0}}}}]);return GlomoOpxMortgageCertificatedDm}(Polymer.mixinBehaviors([CellsBehaviors.StepManagerBehavior,CellsBehaviors.i18nBehavior],Polymer.Element));customElements.define(GlomoOpxMortgageCertificatedDm.is,GlomoOpxMortgageCertificatedDm);</script></dom-module></div></body></html>