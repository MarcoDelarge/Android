<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="glomo-opx-payroll-advance-dm" assetpath="glomo-opx-payroll-advance-dm/"><template><cells-glomo-dm-loans id="dmLoan" global-server-config="[[globalServerConfig]]"></cells-glomo-dm-loans><cells-glomo-dm-customers id="dmCustomers" global-server-config="[[globalServerConfig]]" global-cache-storage="[[globalCacheStorage]]"></cells-glomo-dm-customers><cells-glomo-dm-accounts id="dmAccounts" global-server-config="[[globalServerConfig]]" global-cache-storage="[[globalCacheStorage]]"></cells-glomo-dm-accounts></template><script>var GlomoOpxPayrollAdvanceDm=/*#__PURE__*/function(_Polymer$mixinBehavio){babelHelpers.inherits(GlomoOpxPayrollAdvanceDm,_Polymer$mixinBehavio);function GlomoOpxPayrollAdvanceDm(){babelHelpers.classCallCheck(this,GlomoOpxPayrollAdvanceDm);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(GlomoOpxPayrollAdvanceDm).apply(this,arguments))}babelHelpers.createClass(GlomoOpxPayrollAdvanceDm,[{key:"ready",value:function ready(){var _this=this;babelHelpers.get(babelHelpers.getPrototypeOf(GlomoOpxPayrollAdvanceDm.prototype),"ready",this).call(this);this.addEventListener("loan-data-from-dm",function(evt){return _this._handleOfferData(evt.detail)});this.addEventListener("loan-offer-data-error",function(evt){return _this._loanInitialDataErrorHandler(evt.detail)});this.addEventListener("loan-simulate-success",function(evt){return _this._onLoanSimulateResponse(evt.detail)});this.addEventListener("loan-offer-simulate-error",function(evt){return _this._loanSimulateErrorHandler(evt.detail)});this.addEventListener("post-loan-success",function(evt){return _this._onLoanPostResponse(evt.detail)});this.addEventListener("post-loan-error",function(evt){return _this._loanPostErrorHandler(evt.detail)});this.addEventListener("return-user-email",function(evt){return _this.userEmail=evt.detail});this.addEventListener("number-account-data-from-cache",function(evt){return _this._handleAccountInfo(evt.detail.accountDetails)})}/**
   * Initialize the steps manager when the page becomes active
   */},{key:"init",value:function init(){this.lastActiveStep=null;this.canExecute=!1;this.hasFinished=!1;this._lastResponse=null;this.currentStep=1;this.initSteps();this._requestPayrollAdvanceOffer(this.requestOfferData);this.$.dmCustomers.getUserEmail()}/**
   * Reset all steps when the page becomes inactive
   */},{key:"reset",value:function reset(pageStatus){if(pageStatus&&!pageStatus.value){this.unregisterSteps()}}/**
   * @desc get offer id from payroll advance and request api call
   * @type {String} offerId
   */},{key:"_setEmailConstantCustomer",value:function _setEmailConstantCustomer(emailConstant){this.$.dmCustomers.EMAIL_CONTACT_TYPE_CONSTANT=emailConstant}/**
   * @desc get offer id from oc-offer and request api call
   * @type {String} offerId
   */},{key:"_requestPayrollAdvanceOffer",value:function _requestPayrollAdvanceOffer(offer){if(offer&&offer.offerId){this.dispatchEvent(new CustomEvent("payroll-advance-get-loan-request"));this.set("offerId",offer.offerId);this.$.dmLoan.requestOffer(offer.offerId)}}/**
   * get request Payload from payroll-advance and request an api call for simulate offer
   * @param {Object}  updatedAmount
   */},{key:"simulateRequest",value:function simulateRequest(updatedAmount){this.dispatchEvent(new CustomEvent("payroll-advance-simulate-loan-request"));var terms=this.get("offerData.details.suggestedTerm"),requestData={terms:terms,initialAmount:updatedAmount};this.$.dmLoan.requestSimulateOffer(requestData)}/**
   * get request Payload from payroll-advance and request an api call for posting a loan
   */},{key:"requestPostLoan",value:function requestPostLoan(){this.dispatchEvent(new CustomEvent("payroll-advance-post-loan-request"));var terms=this.get("offerData.details.suggestedTerm"),amount=this.get("offerData.details.suggestedAmount"),todayDate=new Date().toISOString().slice(0,10),requestData={offerId:this.get("offerId"),contractingDate:todayDate,initialAmounts:[amount],terms:terms,purposeGroup:this.get("offerData.purposeGroup")};this.$.dmLoan.requestPostLoan(requestData)}/**
   * @desc success response handler
   * @type {Object}
   */},{key:"_successResponseHandler",value:function _successResponseHandler(response){this.$.dmLoan.successResponseHandler(response);this.$.dmCustomers.successResponseHandler(response);this.$.dmAccounts.successResponseHandler(response)}/**
   * @desc error response handler
   * @type {Object}
   */},{key:"_errorResponseHandler",value:function _errorResponseHandler(errorResponse){this.$.dmLoan.errorResponseHandler(errorResponse);this.$.dmCustomers.errorResponseHandler(errorResponse);this.$.dmAccounts.errorResponseHandler(errorResponse)}/**
   * @desc error handler for loan initial data API failures
   * @type {Object}
   */},{key:"_loanInitialDataErrorHandler",value:function _loanInitialDataErrorHandler(errorResponse){this.dispatchEvent(new CustomEvent("payroll-advance-api-error"));var errorMsg=errorResponse&&errorResponse["error-code"]&&errorResponse["error-message"]?"".concat(errorResponse["error-code"]," ").concat(errorResponse["error-message"]):"payroll-advance-contract-error-message";this.dispatchEvent(new CustomEvent("payroll-advance-loan-initial-data-error",{detail:{code:"payroll-advance-initial-data-error",selectedConfig:{className:"info header--white-light-grey",openMaximized:!0,title:"payroll-advance-contract-error-header-title",acceptBtLabel:"payroll-advance-contract-error-retry-text",cancelBtLabel:"payroll-advance-contract-error-cancel-text",template:{type:"paragraphs",values:[{icon:"glomo:general-error",iconClass:"payroll-advance-error"},{title:"payroll-advance-contract-error-content-title",class:"spacing"},{text:errorMsg}]}}}}))}/**
   * @desc error handler for loan simulate API failures
   * @type {Object}
   */},{key:"_loanSimulateErrorHandler",value:function _loanSimulateErrorHandler(errorResponse){this.dispatchEvent(new CustomEvent("payroll-advance-api-error"));var errorMsg=errorResponse&&errorResponse["error-code"]&&errorResponse["error-message"]?"".concat(errorResponse["error-code"]," ").concat(errorResponse["error-message"]):"payroll-advance-contract-error-message";this.dispatchEvent(new CustomEvent("payroll-advance-loan-simulate-error",{detail:{code:"payroll-advance-simulate-error",selectedConfig:{hideCloseIcon:!0,className:"info payroll-advance-simulate-error",acceptBtLabel:"payroll-advance-contract-error-understood-text",template:{type:"paragraphs",values:[{icon:"coronita:error"},{title:"payroll-advance-contract-error-content-title",class:"spacing"},{text:errorMsg}]}}}}))}/**
   * @desc error handler for loan post API failures
   * @type {Object}
   */},{key:"_loanPostErrorHandler",value:function _loanPostErrorHandler(errorResponse){this.dispatchEvent(new CustomEvent("payroll-advance-api-error"));var errorMsg=errorResponse&&errorResponse["error-code"]&&errorResponse["error-message"]?"".concat(errorResponse["error-code"]," ").concat(errorResponse["error-message"]):"payroll-advance-contract-error-message";this.dispatchEvent(new CustomEvent("payroll-advance-post-loan-error",{detail:{code:"payroll-advance-post-loan-error",selectedConfig:{className:"info header--white-navy-blue",openMaximized:!0,title:"payroll-advance-contract-error-header-title",acceptBtLabel:"payroll-advance-contract-error-retry-text",cancelBtLabel:"payroll-advance-contract-error-cancel-text",template:{type:"paragraphs",values:[{icon:"glomo:general-error",iconClass:"payroll-advance-error"},{title:"payroll-advance-contract-error-content-title",class:"spacing"},{text:errorMsg}]}}}}))}/**
   * Collapses the current step, opens the next step and scrolls the page to it.
   * @param {Number} currentStepKey the current active step
   */},{key:"goNextStep",value:function goNextStep(currentStepKey){this.currentStep=currentStepKey;this.setSteps()}/**
   * handles loan offer data from loans-dm response
   * @param {Object} offerData
   */},{key:"_handleOfferData",value:function _handleOfferData(offerData){this.dispatchEvent(new CustomEvent("payroll-advance-get-loan-response"));this.offerData=offerData;this.applicationAmount=this.get("offerData.details.suggestedAmount.amount");this.receiptFrequency=this.get("offerData.details.subproduct.id");var data={suggestedAmount:this.get("offerData.details.suggestedAmount"),subProductId:this.receiptFrequency,minimumAmount:this.get("offerData.details.minimumAmount"),maximumAmount:this.get("offerData.details.maximumAmount")};this.dispatchEvent(new CustomEvent("loan-offer-initial-data",{detail:data,bubbles:!0,composed:!0}))}/**
   * @desc getting loan simulated response from dm-loans
   * @param {Object} data
   */},{key:"_onLoanSimulateResponse",value:function _onLoanSimulateResponse(data){this.dispatchEvent(new CustomEvent("payroll-advance-simulate-loan-response"));this.set("offerData.details.suggestedAmount",data.initialAmount);this.set("offerData.details.suggestedTerm",data.terms);this.set("offerData.details.loanBreakDown",data.loanBreakDown);this.dispatchEvent(new CustomEvent("loan-simulate-offer-success"))}/**
   * @desc getting post loan response from dm-loans
   * @param {Object} data
   */},{key:"_onLoanPostResponse",value:function _onLoanPostResponse(data){var reason=data.status.reason.id,eventName="",status="",link={};this.offerNotify={productType:this.campaignsType,productNumber:this.offerData.offerId};switch(reason){case"ACCEPTED":eventName="payroll-advance-accepted";this._fireAppStepEvent("app-completed",data);this._handleAcceptedLoanPayload(data);data=this.result;break;case"PENDING":eventName="payroll-advance-pending";break;case"DECLINED":eventName="payroll-advance-declined";status="rejected";data=this._setAlertBoxPayload(status,link);break;case"INCOMPLETE":eventName="payroll-advance-incomplete";status="incomplete";link={link:"payroll-advance-contract-incomplete-location-text",linkIcon:"place",iconClass:"payroll-advance-incomplete-place-icon"};data=this._setAlertBoxPayload(status,link);break;}this.dispatchEvent(new CustomEvent(eventName,{detail:data}))}/**
   * @desc getting post loan response from dm-loans
   * @param {Object} data
   */},{key:"_handleAcceptedLoanPayload",value:function _handleAcceptedLoanPayload(data){if(data){if(data.relatedContracts&&data.relatedContracts[0]&&data.relatedContracts[0].number){this.$.dmAccounts.getAccountDataByNumberFromCache(data.relatedContracts[0]);this.offerNotify={productType:this.accountType,productNumber:data.relatedContracts[0].number}}this.receiptDate=data.contractingDate;this.receiptCurrency=data.initialAmounts[0].currency;this.receiptAmount=data.initialAmounts[0].amount;this.isMajor=data.currencies[0].isMajor;var interestItem=data.rates.find(function(currentItem){return currentItem.rateType.id===this.interestId}.bind(this));this.interestRate=interestItem.unit.percentage+"%";this.operationNumber=data.operationNumber;this._successResultData()}}/**
   * @desc method to set payload for Alert Box Incomplete and Declined status
   */},{key:"_setAlertBoxPayload",value:function _setAlertBoxPayload(status,link){var payload={code:"payroll-advance-".concat(status),selectedConfig:{className:"header--white-navy-blue",openMaximized:!0,title:"payroll-advance-title",acceptBtLabel:"payroll-advance-contract-".concat(status,"-button-text"),template:{type:"paragraphs",values:[{icon:"glomo:payroll_".concat(status),iconClass:"payroll-advance-".concat(status)},{title:"payroll-advance-contract-".concat(status,"-header"),class:"content-header"},{text:"payroll-advance-contract-".concat(status,"-content1"),class:"content-text"},{text:"payroll-advance-contract-".concat(status,"-content2"),class:"content-text"}]}}};if(link){payload.selectedConfig.template.values.push(link)}return payload}/**
   * handles account info from accounts-dm response
   * @param {Object} accountInfo
   */},{key:"_handleAccountInfo",value:function _handleAccountInfo(accountInfo){if(accountInfo){this.accountNumber=accountInfo.number?accountInfo.number:"";if(accountInfo.alias&&""!==accountInfo.alias){this.accountName=accountInfo.alias}else if(accountInfo.product&&accountInfo.product.name){this.accountName=accountInfo.product.name}else{this.accountName=""}this._successResultData()}}/**
   * used to assign relevant text based on the frequency type
   * @param {String} receiptFrequency
   */},{key:"_checkFrequencyType",value:function _checkFrequencyType(receiptFrequency){switch(receiptFrequency){case"CD02":this.messageText=this.t("payroll-advance-success-month-info-text");this.frequencyText1=this.t("payroll-advance-success-monthly-data-text1");this.frequencyText2=this.t("payroll-advance-success-monthly-data-text2");this.infoMessageText=this.t("payroll-advance-success-month-info-text");this.paymentDuration=2;break;case"CD01":this.messageText=this.t("payroll-advance-success-fortnights-info-text");this.frequencyText1=this.t("payroll-advance-success-fortnights-data-text1");this.frequencyText2=this.t("payroll-advance-success-fortnights-data-text2");this.infoMessageText=this.t("payroll-advance-success-fortnights-info-text");this.paymentDuration=4;break;case"WEEKLY":this.messageText=this.t("payroll-advance-success-weekly-info-text");break;case"DAILY":this.messageText=this.t("payroll-advance-success-daily-info-text");break;}}/**
   * prepares a payload using the properties, which is used in cells-successful-response component
   */},{key:"_successResultData",value:function _successResultData(){this.result={receiptCurrency:this.receiptCurrency,infoMessageText:this.infoMessageText,date:this.receiptDate,title:"contract--success-header-title-text",origin:{avatar:{src:"resources/illustrations/ill_bbva_card_oval_gray_background.svg"},product:{name:" "}},amountLabel:"contract-success-amount-deposited-text",chargeAmount:{amount:this.receiptAmount,currency:this.receiptCurrency,isMajor:this.isMajor},topInfo:[{key:"contract-success-bottom-info-text1",value:this.accountName,class:"bold spacing md"},{musk:{value:this.accountNumber,chars:5,simbol:"\u2022"}},{key:"contract-success-folio-text",value:this.operationNumber,class:"inline secondary separator"},{key:"",value:"contract-success-bottom-info-text2",class:"secondary"},{key:"",value:"contract-success-bottom-info-text5",class:"secondary"},{key:"",value:this.userEmail,class:"bold spacing"}],/** Do not delete this, Ver documentation is temporarily removed for GLOMOCS4-13422
       operations: [
       {
              label: 'contract-success-document-text',
              id: 'download',
              icon: 'coronita:pdf'
            }
       ],
       */headerAdditionalListInfo:[{key:this.t("payroll-advance-success-monthly-key-text1")+" "+this.frequencyText1,value:{amount:this.installmentAmount.amount,currencyCode:this.installmentAmount.currency},localCurrency:this.installmentAmount.currency,language:"en",class:"bold"}],headerListInfo:[{key:"contract-success-monthly-key-text2",value:this.paymentDuration+" "+this.frequencyText2},{key:"contract-success-monthly-key-text3",value:this.interestRate},{key:"contract-success-monthly-key-text4",value:this.commissionFee.percentage+"%"}],headerMessage:{icon:{name:"coronita:info",size:16},message:this.infoMessageText}}}/**
   * @desc find specific installment payment in array
   * @param {Array} items
   * @param {String} installmentId
   * @return {Object}
   */},{key:"_getInstallmentAmount",value:function _getInstallmentAmount(items,installmentId){return items&&items.length?items.filter(function(item){return item.id===installmentId})[0]:null}/**
   * @desc get card offer's CAT rate
   * @param {Array} rates
   * @param {String} catRateId
   * @type {Object}
   */},{key:"_getCATRate",value:function _getCATRate(rates,catRateId){return rates&&rates.length?rates.filter(function(item){return item.rateType.id===catRateId})[0]:null}/**
   * @desc get card offer's annual rate
   * @param {Array} rates
   * @param {String} rateId
   * @type {Object}
   */},{key:"_getRate",value:function _getRate(rates,rateId){return rates&&rates.length?rates.filter(function(item){return item.rateType.id===rateId})[0]:null}/**
   * @desc get card offer's anual fee
   * @param {Array} fees
   * @param {String} commissionId
   * @return {Object}
   */},{key:"_getCommissionFee",value:function _getCommissionFee(fees,commissionId){return fees&&fees.length?fees.filter(function(item){return item.feeType.id===commissionId})[0]:null}/**
   * @desc method dispatches step events with updated suggested and payment amount
   */},{key:"_fireAppStepEvent",value:function _fireAppStepEvent(eventName){var data=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},payload={applicationAmount:this.get("offerData.details.suggestedAmount.amount"),applicationPaymentAmount:this.get("installmentAmount.amount"),operationNumber:data&&data.operationNumber?data.operationNumber:0};this.dispatchEvent(new CustomEvent(eventName,{detail:payload}))}/**
   * Fires the app step analytics
   * @param {Boolean} allStepsCollapsed True if all the steps are collapsed
   */},{key:"fireStepAnalytics",value:function fireStepAnalytics(allStepsCollapsed){var _this2=this,eventName="";if(allStepsCollapsed){eventName="app-last-step"}else{var unCollapsedSteps=Object.keys(this._steps).filter(function(stepNumber){return!_this2._steps[stepNumber].collapsed});if(unCollapsedSteps.length&&1<unCollapsedSteps[0]){eventName="app-step-"+unCollapsedSteps[0]}}this._fireAppStepEvent(eventName)}}],[{key:"is",get:function get(){return"glomo-opx-payroll-advance-dm"}},{key:"properties",get:function get(){return{/**
       * @desc global server config retrieved from native
       * @type {Object}
       */globalServerConfig:Object,/**
       * @desc global cache data retrieved from native
       * @type {Object}
       */globalCacheStorage:Object,/**
       * @desc bind to channel to get offer id
       * @type {Object}
       */requestOfferData:{type:Object},/**
       * Observer to check frequency type
       * @type {String}
       */receiptFrequency:{type:String,value:"",observer:"_checkFrequencyType"},/**
       * @desc constant for email type contact
       * @type {String}
       */emailTypeConstant:{type:String,observer:"_setEmailConstantCustomer"},/**
       * @desc constant for campaigns type
       * @type {String}
       */campaignsType:{type:String},/**
       * @desc constant for installment id
       * @type {String}
       */installmentId:{type:String},/**
       * @desc constant for interest id
       * @type {String}
       */interestId:{type:String},/**
       * @desc constant for commission id
       * @type {String}
       */commissionId:{type:String},/**
       * @desc constant for commission id
       * @type {String}
       */catRateId:{type:String},/**
       * @desc constant for commission id
       * @type {String}
       */rateId:{type:String},/**
       * @desc constant for account type
       * @type {String}
       */accountType:{type:String},/**
       * @desc offer data fetched from DM
       * @type {Object}
       */offerNotify:{type:Object,notify:!0},/**
       * @desc offer data fetched from DM
       * @type {Object}
       */offerData:{type:Object,notify:!0,value:{}},/**
       * @desc payroll advance installment amount
       * @type {Object}
       */installmentAmount:{type:Object,value:{},computed:"_getInstallmentAmount(offerData.details.loanBreakDown, installmentId)",notify:!0},/**
       * @desc payroll advance suggested amount
       * @type {Object}
       */suggestedAmount:{type:Object,value:{},notify:!0},/**
       * @desc payroll advance suggested term
       * @type {Object}
       */suggestedTerm:{type:Object,value:{},notify:!0},/**
       * @desc payroll advance offer's CAT rate
       * @type {Object} - DM
       */catRate:{type:Object,value:{},computed:"_getCATRate(offerData.rates, catRateId)",notify:!0},/**
       * @desc payroll advance offer's anual rate
       * @type {Object} - DM
       */rate:{type:Object,value:{},computed:"_getRate(offerData.rates, rateId)",notify:!0},/**
       * @desc payroll advance offer's commission fee
       * @type {Object} -DM
       */commissionFee:{type:Object,value:{},computed:"_getCommissionFee(offerData.fees.itemizeFees, commissionId)",notify:!0}}}}]);return GlomoOpxPayrollAdvanceDm}(Polymer.mixinBehaviors([CellsBehaviors.StepManagerBehavior,CellsBehaviors.i18nBehavior],Polymer.Element));customElements.define(GlomoOpxPayrollAdvanceDm.is,GlomoOpxPayrollAdvanceDm);</script></dom-module><dom-module id="glomo-payroll-advance-step-styles" assetpath="glomo-payroll-advance-step/"><template><style>:host{display:block;box-sizing:border-box;font-family:var(--cells-fontDefault, sans-serif);@apply --glomo-payroll-advance-step;}:host([hidden]), [hidden]{display:none !important;}*, *:before, *:after{box-sizing:inherit;}.content-wrapper{text-align:center;color:white;@apply --glomo-payroll-advance-step-content-wrapper;}cells-glomo-offer-edit{padding-top:8px;padding-bottom:30px;--cells-glomo-offer-edit-content-icon-padding-bottom:23px;@apply --glomo-payroll-advance-step-offer-edit;}cells-glomo-offer-edit .content-header-text{font-size:18px;font-weight:normal;font-style:normal;font-stretch:normal;line-height:1.22;letter-spacing:normal;padding-bottom:30px;@apply --glomo-payroll-advance-step-offer-edit-content-header-text;}.content-input{padding-bottom:50px;@apply --glomo-payroll-advance-step-content-input;}.content-term{padding-top:30px;padding-bottom:30px;font-size:14px;font-weight:normal;font-style:normal;font-stretch:normal;line-height:1.43;letter-spacing:normal;@apply --glomo-payroll-advance-step-content-term;}.content-term p{margin:10px;font-size:20px;font-weight:500;line-height:1;@apply --glomo-payroll-advance-step-content-term-p;}.offer-fees{display:flex;font-size:14px;padding-bottom:30px;@apply --glomo-payroll-advance-step-offer-fees;}.offer-fees .offer-fee-key{flex:1;text-align:left;@apply --glomo-payroll-advance-step-offer-fee-key;}.offer-fees .offer-fee-value{display:flex;@apply --glomo-payroll-advance-step-offer-fee-value;}.offer-fees .offer-fee-value .offer-fee-value-right-icon{margin-left:4px;@apply --glomo-payroll-advance-step-offer-fee-value-right-icon;}.content-message{padding-bottom:30px;font-size:14px;font-weight:normal;font-style:normal;font-stretch:normal;line-height:1.43;letter-spacing:normal;@apply --glomo-payroll-advance-step-content-message;}.content-reminder{font-size:14px;font-weight:normal;font-style:normal;font-stretch:normal;line-height:1.43;letter-spacing:normal;text-align:center;@apply --glomo-payroll-advance-step-content-reminder;}.filled{padding-bottom:0.875rem;border-bottom:1px solid rgba(250, 255, 255, 0.2);@apply --glomo-payroll-advance-step-filled;}.small-amount{padding-bottom:20px;@apply --glomo-payroll-advance-step-small-amount;}.small-amount cells-atom-amount.amount-huge{padding-top:10px;font-size:20px;--cells-atom-amount-huge-fractional-font-size:14px;--cells-atom-amount-currency-left:{font-size:14px;};@apply --glomo-payroll-advance-step-atom-amount-amount-huge;}.amount-huge{display:block;font-size:36px;font-weight:normal;font-style:normal;font-stretch:normal;line-height:1;letter-spacing:normal;color:var(--bbva-white, #ffffff);--cells-atom-amount-fractional:{font-size:23px;};--cells-atom-amount-currency-left:{font-size:23px;};@apply --glomo-payroll-advance-step-amount-huge;}#overlay{width:100%;height:100%;top:0;left:0;right:0;bottom:0;background-color:rgba(0, 0, 0, 0.5);z-index:2;cursor:pointer;@apply --glomo-payroll-advance-step-overlay;}cells-key-values{padding-bottom:10px;--cells-key-values-key-color:var(--bbva-white);--cells-key-values-color:var(--bbva-white);--cells-key-values-value-font-size:14px;@apply --glomo-payroll-advance-step-key-values;}cells-key-values:first-of-type{padding-bottom:30px;@apply --glomo-payroll-advance-step-key-values-first-item;}.note{display:flex;font-style:italic;@apply --glomo-payroll-advance-step-note;}.note cells-atom-icon{margin-right:8px;@apply --glomo-payroll-advance-step-note-atom-icon;}cells-molecule-link-icon{--iron-icon-fill-color:#ffffff;@apply --glomo-payroll-advance-step-molecule-link-icon;}cells-step{--cells-step-iron-collapse-expanded-resume-padding:0;@apply --glomo-payroll-advance-step-cells-step;}.amount-label{margin-top:0;margin-bottom:0;@apply --glomo-payroll-advance-step-amount-label;}.horizontal-line{margin:20px 0px;width:40px;opacity:0.2;background-color:#ffffff;@apply --glomo-payroll-advance-step-horizontal-line;}</style></template></dom-module><dom-module id="glomo-payroll-advance-step" assetpath="glomo-payroll-advance-step/"><template><style include="glomo-payroll-advance-step-styles glomo-payroll-advance-step-shared-styles"></style><cells-step id="stepContainer" active="[[active]]" step-title="[[stepTitle]]" max-steps="[[maxSteps]]" change-label="[[changeLabel]]" collapsed="{{collapsed}}" class-to-toggle="step-active" decorated="[[decorated]]" hide-header="[[hideStepHeader]]" click-disabled="[[stepClickDisable]]"><div slot="full" class="full"><cells-glomo-offer-edit id="payrollAdvanceOfferEdit" class="content-wrapper" image="[[offerImage]]" input-amount="{{offerData.suggestedAmount}}" input-min-amount="[[offerData.minimumAmount]]" input-max-amount="[[offerData.maximumAmount]]" input-label="[[t('payroll-advance-offer-user-request-text')]]" invalid-amount="{{invalidAmount}}" numeral-positive-only="" local-currency="[[localCurrency]]" show-input-hint="" show-input="" disable-decimal=""><div slot="offerDescription" class="content-header-text">[[t('payroll-advance-offer-title')]]<br><strong>[[rate.unit.percentage]] [[t('payroll-advance-offer-subtitle')]]</strong></div><div slot="offerNotes"><div class="content-term">[[t('payroll-advance-offer-timeline-text')]]<br><p>[[paymentTerm]] [[termText]]</p></div><div class="offer-fees"><div class="offer-fee-key">[[t('payroll-advance-offer-iva-text')]]</div><div class="offer-fee-value"><span>[[commissionFee.percentage]]%</span> <a class="offer-fee-value-right-icon" on-tap="_helpIconClicked"><cells-molecule-link-icon icon="coronita:help" class="icon-size-16 cells-molecule-link-icon--block" is="cells-molecule-link-icon"></cells-molecule-link-icon></a></div></div><div class="content-message">[[t('payroll-advance-offer-automatic-payment-text')]]</div><div class="content-reminder">[[paymentReminderText]]</div></div></cells-glomo-offer-edit><cells-glomo-offer-footer id="footer" payment-text="[[paymentText]]" monthly-payment="[[installmentAmount]]" language="[[language]]" local-currency="[[localCurrency]]" vat-text="[[t('payroll-advance-offer-notication-text')]]" primary-button-text="[[t('payroll-advance-offer-footer-button-text')]]" disabled-primary-button="[[submitButtonDisabled]]" has-error="[[submitButtonDisabled]]" scroll="[[templateContentScroll]]" calculation-text="<strong>[[t('payroll-advance-offer-cat-percentage-text')]] [[catRate.unit.percentage]]%</strong>
                  [[t('payroll-advance-offer-iva-percentage-bold-text')]]
                  <br>[[t('payroll-advance-offer-iva-percentage-second-text')]]" calculated-date="[[catRate.calculationDate]]" preceding-height="[[offerEditHeight]]" enable-sticky="[[enableSticky]]" show-primary-button="" show-payment-text="" show-seperator="" show-calculation="" show-vat=""></cells-glomo-offer-footer></div><div slot="filled" class="filled"><div><p class="amount-label">[[t('payroll-advance-offer-amount-required-text')]]</p><cells-atom-amount class="amount-huge" amount="[[offerData.suggestedAmount.amount]]" currency-code="[[offerData.suggestedAmount.currency]]" local-currency="[[offerData.suggestedAmount.currency]]" language="[[language]]"></cells-atom-amount><hr class="horizontal-line"></div><div class="small-amount">[[summaryPaymentText]]<cells-atom-amount class="amount-huge" amount="[[installmentAmount.amount]]" currency-code="[[installmentAmount.currency]]" local-currency="[[installmentAmount.currency]]" language="[[language]]"></cells-atom-amount></div><cells-key-values class="inline" key="[[t('payroll-advance-offer-term-text')]]" value="[[paymentTerm]] [[termText]]"></cells-key-values><br><cells-key-values class="inline" key="[[t('paryoll-advance-offer-intrest-rate-text')]]" value="[[rate.unit.percentage]]%"></cells-key-values><cells-key-values class="inline" key="[[t('payroll-advance-offer-iva-text')]]" value="[[commissionFee.percentage]]%"></cells-key-values><p class="note"><cells-atom-icon icon="coronita:info" class="icon-size-16"></cells-atom-icon>[[t('payroll-advance-offer-credit-approve-text')]]</p></div></cells-step></template><script>{var _Polymer=Polymer,html=_Polymer.html,GlomoPayrollAdvanceStep=/*#__PURE__*/function(_Polymer$mixinBehavio){babelHelpers.inherits(GlomoPayrollAdvanceStep,_Polymer$mixinBehavio);function GlomoPayrollAdvanceStep(){babelHelpers.classCallCheck(this,GlomoPayrollAdvanceStep);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(GlomoPayrollAdvanceStep).apply(this,arguments))}babelHelpers.createClass(GlomoPayrollAdvanceStep,[{key:"ready",value:function ready(){babelHelpers.get(babelHelpers.getPrototypeOf(GlomoPayrollAdvanceStep.prototype),"ready",this).call(this);this.addEventListener("button-clicked",this.offerFooterBtnClicked.bind(this));this.addEventListener("valid-amount-input-focus-out",this._onAmountInputFocusOut.bind(this));this.addEventListener("amount-input-focus",this._onAmountInputFocusIn.bind(this));this.addEventListener("change-pressed",this.payrollAdvanceStepchangePressed.bind(this));this.addEventListener("collapsed-changed",this._onCollapseChanged.bind(this))}/**
     * @desc Observer for bridge page is active and inactive
     */},{key:"init",value:function init(){this.initialize();this.dispatchEvent(new CustomEvent("page-loaded"));this.changeHeaderColor("oc-offer");this.set("hideStepHeader",!0);this.set("stepClickDisable",!0);this.set("enableSticky",!0)}},{key:"reset",value:function reset(event){if(!event.value){this.set("stepClickDisable",!1);this.set("enableSticky",!1);this.set("prevAmount","");this.dispatchEvent(new CustomEvent("oc-offer-clean"));this.dispatchEvent(new CustomEvent("keyboard-collapse-clean"))}}/**
     * @desc on collapse property change
     * @param {boolean} 'event' collapse event
     */},{key:"_onCollapseChanged",value:function _onCollapseChanged(){this.dispatchEvent(new CustomEvent("step-collapsed-changed"))}/**
     * @desc is the step header hidden based on 'collapsed' property
     * @param 'collapsed' collapsed property
     * @return {Boolean}
     */},{key:"_isStepHeaderHidden",value:function _isStepHeaderHidden(collapsed){return!collapsed}/**
     * @desc set scroll height
     */},{key:"_templateContentScrollChanged",value:function _templateContentScrollChanged(){this.set("offerEditHeight",this.$$("cells-glomo-offer-edit").scrollHeight)}/**
     * @desc triggering on blur when keyboard is collapsed on respective page
     * @param {Object} pageActive
     * @param {Boolean} keyboardCollapse
     */},{key:"_triggerOnBlur",value:function _triggerOnBlur(keyboardCollapse){if(keyboardCollapse&&this.$$("#payrollAdvanceOfferEdit")){this.$$("#payrollAdvanceOfferEdit")._inputBlur()}}/**
     * @desc getting offer data from dm and setting it to properites
     * @param {Object} data
     */},{key:"offerDataLoad",value:function offerDataLoad(data){var _this=this;this.set("offerData",data);this.set("prevAmount",this.get("offerData.suggestedAmount.amount"));var frequency=this.get("offerData.subProductId");this._updateLocalesByFrequency(frequency);this.async(function(){_this.$$("#payrollAdvanceOfferEdit")._inputBlur()},1)}/**
     * @desc Function to open alert modal with message data
     */},{key:"_helpIconClicked",value:function _helpIconClicked(){this.dispatchEvent(new CustomEvent("show-help-modal",{detail:{code:"HELP_INFO",selectedConfig:{hideCloseIcon:!0,className:"info",openMaximized:!1,acceptBtLabel:this.t("payroll-advance-offer-alert-button-text"),template:{type:"paragraphs",values:[{icon:"coronita:help"},{title:this.t("payroll-advance-offer-alert-title-text"),class:"no-bold-title spacing"},{text:this.feeAlertText}]}}}}))}/**
     * @desc Function to open terms and conditions page
     */},{key:"openTermsAndConditions",value:function openTermsAndConditions(){this.dispatchEvent(new CustomEvent("open-terms-and-conditions-pdf",{detail:{title:this.t("payroll-advance-terms-and-conditions-title"),productId:this.termsAndConditionsProductId,subProductId:this.termsAndConditionsSubProductId}}))}/**
     * @desc function that hides the footer during the on-focus of amount-input
     * @param {Object} event
     */},{key:"_onAmountInputFocusIn",value:function _onAmountInputFocusIn(event){this.set("enableSticky",!1);this.set("submitButtonDisabled",!0)}/**
     * @desc change the header style when offer footer button is clicked and go next step
     */},{key:"offerFooterBtnClicked",value:function offerFooterBtnClicked(){this.changeHeaderColor("oc-offer-step");this.dispatchEvent(new CustomEvent("offer-footer-button-pressed"));this.dispatchEvent(new CustomEvent("go-next-step",{detail:this.currentStep}))}/**
     * @desc show half modal when trying to exit the offer
     */},{key:"confirmationAlertModal",value:function confirmationAlertModal(){this.dispatchEvent(new CustomEvent("modal-open"))}/**
     * @desc update locale values based on frequency
     * @param {String} frequency
     */},{key:"_updateLocalesByFrequency",value:function _updateLocalesByFrequency(frequency){var frequencyLabel=frequency.toUpperCase()===this.FREQUENCY_CONSTANT?this.BIWEEKLY_CONSTANT:this.MONTHLY_CONSTANT;this.termText=this.t("payroll-advance-offer-freq-text-".concat(frequencyLabel));this.paymentReminderText=this.t("payroll-advance-offer-reminder-text-".concat(frequencyLabel));this.paymentText=this.t("payroll-advance-offer-payment-text-".concat(frequencyLabel));this.feeAlertText=this.t("payroll-advance-offer-alert-text1-".concat(frequencyLabel))+this.get("commissionFee.percentage")+this.t("payroll-advance-offer-alert-text2-".concat(frequencyLabel));this.summaryPaymentText=this.t("payroll-advance-offer-summary-payment-text-".concat(frequencyLabel));this.paymentTerm=frequencyLabel===this.BIWEEKLY_CONSTANT?4:2}/**
     * @desc watch for the amount changes in input and shows the footer on focus-out
     */},{key:"_onAmountInputFocusOut",value:function _onAmountInputFocusOut(input){this.set("enableSticky",!0);if(input.detail!==this.prevAmount){this.dispatchEvent(new CustomEvent("request-simulation",{detail:this.get("offerData.suggestedAmount"),bubbles:!0,composed:!0}));this.set("prevAmount",input.detail)}this.set("submitButtonDisabled",this.invalidAmount)}/**
     * @desc launch the event for change header color
     * @param {Object} event
     */},{key:"payrollAdvanceStepchangePressed",value:function payrollAdvanceStepchangePressed(){this.set("collapsed",!1);this.set("decorated",!1);this.changeHeaderColor("oc-offer");if(!this.termsCollapsed){this.dispatchEvent(new CustomEvent("toggle-terms-step",{detail:!1}))}}/**
     * @desc changes the color of the header on button click
     * @param 'className'
     */},{key:"changeHeaderColor",value:function changeHeaderColor(className){this.dispatchEvent(new CustomEvent("change-header-color",{detail:className}))}/**
     * @desc method dispatches navigate to atm branch locator event.
     */},{key:"_navigateToAtmBranchLocator",value:function _navigateToAtmBranchLocator(){this.dispatchEvent(new CustomEvent("navigate-to-atm-branch-locator",{bubbles:!0,composed:!0}))}/**
     * @desc method dispatches navigate to back step event.
     */},{key:"_navigateBackStep",value:function _navigateBackStep(){this.dispatchEvent(new CustomEvent("back-button-pressed",{bubbles:!0,composed:!0}))}/**
     * @desc deactivates terms and conditions if first step is full
     */},{key:"changeTermsAndConditions",value:function changeTermsAndConditions(){if(!this.collapsed){this.dispatchEvent(new CustomEvent("toggle-terms-step",{detail:!1}))}}}],[{key:"is",get:function get(){return"glomo-payroll-advance-step"}},{key:"properties",get:function get(){return{/**
         * @desc enable and disable the click event inside cells-step
         * @type {Boolean}
         */stepClickDisable:Boolean,/**
         * @desc Check for if the keyboard is active or inactive
         * @type {Boolean}
         */keyboardCollapse:{type:Boolean,observer:"_triggerOnBlur"},/**
         * @desc language for locales
         * @type {String}
         */language:String,/**
         * @desc show and hide sticky footer
         * @type {Boolean}
         */enableSticky:Boolean,/**
         * @desc scroll
         * @type {Object}
         */templateContentScroll:{type:"Object",observer:"_templateContentScrollChanged"},/**
         * @desc scroll height of edit offer component
         * @type {Number}
         */offerEditHeight:Number,/**
         * @desc offer data from DM
         * @type {Object}
         */offerData:{type:Object,notify:!0},/**
         * @desc installment amount
         * @type {Object}
         */installmentAmount:{type:Object,notify:!0},/**@desc previously entered value in the amount input
         * @type {String}
         */prevAmount:String,/**
         * @desc CAT rate from DM
         * @type {Object}
         */catRate:{type:Object,notify:!0},/**
         * @desc Annual rate from DM
         * @type {Object}
         */rate:{type:Object,notify:!0},/**
         * @desc Commission fee from DM
         * @type {Object}
         */commissionFee:{type:Object,notify:!0},/**
         * @desc text for the term
         * @type {String}
         */termText:{type:String,value:""},/**
         * @desc Payment reminder text
         * @type {String}
         */paymentReminderText:{type:String,value:""},/**
         * @desc Payment text
         * @type {String}
         */paymentText:{type:String,value:""},/**
         * @desc Payment term
         * @type {Number}
         */paymentTerm:Number,/**
         * @desc Offer fee alert text
         * @type {String}
         */feeAlertText:{type:String,value:""},/**
         * @desc Summary payment text
         * @type {String}
         */summaryPaymentText:{type:String,value:""},/**
         * @desc is submit button disable
         * @type {Boolean}
         */submitButtonDisabled:{type:Boolean,notify:!0},/**
         * @desc flag to enable and disable footer submit button
         * @type {Boolean}
         */invalidAmount:Boolean,/**
         * @desc Constant for subProductId bi-weekly
         * @type {String}
         */FREQUENCY_CONSTANT:{type:String,value:"CD01"},/**
         * @desc String constant for biweekly
         * @type {String}
         */BIWEEKLY_CONSTANT:{type:String,value:"biweekly"},/**
         * @desc String constant for monthly
         * @type {String}
         */MONTHLY_CONSTANT:{type:String,value:"monthly"},/**
         * @desc Terms and conditions step collapsed status
         * @type {Boolean}
         */termsCollapsed:Boolean,/**
         * @desc hide step header
         * @type {Boolean}
         */hideStepHeader:{type:Boolean,computed:"_isStepHeaderHidden(collapsed)",readOnly:!0},/**
         * @desc product Id for requesting terms and conditions document
         * @type {String}
         */termsAndConditionsProductId:{type:String},/**
         * @desc SubProduct Id for requesting terms and conditions document
         * @type {String}
         */termsAndConditionsSubProductId:{type:String}}}}]);return GlomoPayrollAdvanceStep}(Polymer.mixinBehaviors([CellsBehaviors.i18nBehavior,CellsBehaviors.StepBehavior,CellsBehaviors.CellsGlomoUtilsBehavior],Polymer.Element));/**
    `<glomo-payroll-advance-step>` Description.

    Example:

    ```html
    <glomo-payroll-advance-step></glomo-payroll-advance-step>
    ```

    ## Styling
    The following custom properties and mixins are available for styling:

    ### Custom Properties
    | Custom Property     | Selector | CSS Property | Value       |
    | ------------------- | -------- | ------------ | ----------- |
    | --cells-fontDefault | :host    | font-family  |  sans-serif |
    ### @apply
    | Mixins    | Selector | Value |
    | --------- | -------- | ----- |
    | --glomo-payroll-advance-step | :host | {} |
    | --glomo-payroll-advance-step-content-wrapper | :host .content-wrapper | {} |
    | --glomo-payroll-advance-step-offer-edit | :host cells-glomo-offer-edit | {} |
    | --glomo-payroll-advance-step-offer-edit-content-header-text | :host cells-glomo-offer-edit.content-header-text | {} |
    | --glomo-payroll-advance-step-content-input | :host .content-input | {} |
    | --glomo-payroll-advance-step-content-term | :host .content-term | {} |
    | --glomo-payroll-advance-step-content-term-p | :host .content-term p | {} |
    | --glomo-payroll-advance-step-offer-fees | :host .offer-fees | {} |
    | --glomo-payroll-advance-step-offer-fee-key | :host .offer-fee-key | {} |
    | --glomo-payroll-advance-step-offer-fee-value | :host .offer-fee-value | {} |
    | --glomo-payroll-advance-step-offer-fee-value-right-icon | :host .offer-fee-value-right-icon | {} |
    | --glomo-payroll-advance-step-content-message | :host .content-message | {} |
    | --glomo-payroll-advance-step-content-reminder | :host .content-reminder | {} |
    | --glomo-payroll-advance-step-filled | :host .filled | {} |
    | --glomo-payroll-advance-step-small-amount | :host .small-amount | {} |
    | --glomo-payroll-advance-step-atom-amount-amount-huge | :host .small-amount cells-atom-amount.amount-huge | {} |
    | --glomo-payroll-advance-step-amount-huge | :host .amount-huge | {} |
    | --glomo-payroll-advance-step-overlay | :host #overlay | {} |
    | --glomo-payroll-advance-step-key-values | :host cells-key-values | {} |
    | --glomo-payroll-advance-step-key-values-first-item | :host cells-key-values &:first-of-type | {} |
    | --glomo-payroll-advance-step-note | :host .note | {} |
    | --glomo-payroll-advance-step-note-atom-icon | :host .note cells-atom-icon | {} |
    | --glomo-payroll-advance-step-molecule-link-icon | :host cells-molecule-link-icon | {} |
    | --glomo-payroll-advance-step-cells-step | :host cells-step | {} |
    | --glomo-payroll-advance-step-amount-label | :host .amount-label | {} |
    | --glomo-payroll-advance-step-horizontal-line | :host .horizontal-line | {} |

    * @customElement
    * @polymer
    * @extends {Polymer.Element}
    * @demo demo/index.html
  */customElements.define(GlomoPayrollAdvanceStep.is,GlomoPayrollAdvanceStep)}</script></dom-module></div></body></html>