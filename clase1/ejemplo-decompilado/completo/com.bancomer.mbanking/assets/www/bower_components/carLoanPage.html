<html><head></head><body><div hidden="" by-polymer-bundler=""><dom-module id="glomo-opx-car-loan-dm" assetpath="glomo-opx-car-loan-dm/"><template><cells-dm-global-apis-loans id="apiLoans" offer-id="[[offerIdCar]]" host="[[hostOfferCar]]" loans-api-version="[[loansVersion]]" on-set-offer-detail="offerDetailsProcess" on-get-offer-detail-quotations-simulate="processSimulate" on-error-on-get-loan-offer-detail="processError" on-error-on-post-loan-offer-detail-quotations-simulate="errorSimulate"></cells-dm-global-apis-loans></template><script>/*global moment */var GlomoOpxCarLoanDm=/*#__PURE__*/function(_Polymer$mixinBehavio){babelHelpers.inherits(GlomoOpxCarLoanDm,_Polymer$mixinBehavio);function GlomoOpxCarLoanDm(){babelHelpers.classCallCheck(this,GlomoOpxCarLoanDm);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(GlomoOpxCarLoanDm).apply(this,arguments))}babelHelpers.createClass(GlomoOpxCarLoanDm,[{key:"_offerIdCarComputed",/**
   * @desc computed to get offerId by offerData
   */value:function _offerIdCarComputed(offerDataCar){return offerDataCar&&offerDataCar.offerId?offerDataCar.offerId:""}/**
   * radioSelected value from user interaction
   * @param newValue
   * @param oldValue
   * @private
   */},{key:"_radioSelectedObserver",value:function _radioSelectedObserver(currentValue,oldValue){if(currentValue.id&&oldValue.id){if(currentValue!==oldValue){this.set("amountSelectedCar",0);this.set("oldAmount",1)}this._updatedOfferDetail(this.radioSelected,this.sliderSelectedCar)}}/**
   * slider selected value from user interaction
   * @param newValue
   * @param oldValue
   * @private
   */},{key:"_sliderSelectedCarObserver",value:function _sliderSelectedCarObserver(newValue,oldValue){if(newValue&&oldValue){if(newValue!==oldValue){this.set("amountSelectedCar",0)}this._updatedOfferDetail(this.radioSelected,this.sliderSelectedCar)}}/**
   * @desc observer function validate the properties to generate the simulation request
   * @param {*} amountSelectedCar, radioSelected, sliderSelectedCar
   */},{key:"_updatedOfferDetail",value:function _updatedOfferDetail(){var radioSelected=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},sliderSelectedCar=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,amountSelectedCar=2<arguments.length&&arguments[2]!==void 0?arguments[2]:0;if(radioSelected&&radioSelected.id&&sliderSelectedCar&&!this.waitSimulation){this._generateRequestSimulator()}}/**
   * @desc generate offerDetail by loans dm bgadp
   * @private
   */},{key:"_offerRequestDetail",value:function _offerRequestDetail(){this._genericDispatchEvent("show-spinner");var apiLoans=this.shadowRoot.querySelector("cells-dm-global-apis-loans");apiLoans.getOfferDetail()}/**
   * @desc get payload by responseSuccess from apiLoans dm
   * @param payload
   */},{key:"offerDetailsProcess",value:function offerDetailsProcess(payload){if(payload&&payload.detail){var offerDetail=payload.detail;this._autoDataGenerate(offerDetail.details);this._amountDataCarGenerate(offerDetail.details);this._sliderPropertyCarGenerate(offerDetail.details);this._keyInfoCarGenerate(offerDetail.rates,offerDetail.fees);this._customMessageCarGenerate(offerDetail.rates,offerDetail.period);this._stickyDataCarGenerate(offerDetail.details);this._genericDispatchEvent("hide-spinner")}}/**
   * @desc return autoData array from offerDetail.details
   * @param details
   * @returns {[]}
   * @private
   */},{key:"_autoDataGenerate",value:function _autoDataGenerate(details){var _this=this;if(details&&details.allowedSubproducts){var radioList=details.allowedSubproducts.map(function(item){if("NUEVO"===item.subproductType.name){return{id:item.subproductType.id,oficialName:item.subproductType.name,name:"offer-loan-offer-radio-selected-title-".concat(item.subproductType.name)}}else{return{id:item.subproductType.id,oficialName:item.subproductType.name,name:"offer-loan-offer-radio-selected-title-".concat(item.subproductType.name),message:_this.t("glomo-loan-offer-info-message-radio"),icon:"coronita:info"}}}),radioOrder=radioList.slice(0);radioOrder.sort(function(firstRadio,secondRadio){var initialRadio=firstRadio.oficialName.toLowerCase(),finalRadio=secondRadio.oficialName.toLowerCase();return initialRadio<finalRadio?-1:initialRadio>finalRadio?1:0});this.set("autoData",{description:"glomo-loan-offer-title-radio-modal",radioAuto:radioOrder});this.set("radioSelected",this.autoData.radioAuto[0])}}/**
   * @desc computed amountData object from offerDetails.details
   * @param details
   * @returns {{amountMax: *, amountDefault: *, amountMin: *, iconSize: string, iconCode: string, label: string}}
   * @private
   */},{key:"_amountDataCarGenerate",value:function _amountDataCarGenerate(details){if(details&&details.suggestedAmount){var dataAmount={amountDefault:this._truncatedDecimals(details.suggestedAmount.amount),amount:this._truncatedDecimals(details.suggestedAmount.amount),amountMin:Math.ceil(details.minimumAmount.amount),amountMax:this._truncatedDecimals(details.maximumAmount.amount),iconSize:"icon-size-26",iconCode:"coronita:close",label:"glomo-loan-offer-input-label-car"};this.set("amountDataCar",dataAmount);this.set("amountSelectedCar",this._truncatedDecimals(details.suggestedAmount.amount));this.set("oldAmount",this._truncatedDecimals(details.suggestedAmount.amount));this.set("currencyLocal",details.suggestedAmount.currency);this.set("resultAmount",this._truncatedDecimals(details.suggestedAmount.amount))}}// NUEVA FUNCIONALIDAD
},{key:"_amountSelectedCar",value:function _amountSelectedCar(newAmount){this.set("oldAmount",this.amountSelectedCar);this.set("amountSelectedCar",this._truncatedDecimals(newAmount))}},{key:"inputFocus",value:function inputFocus(){this._genericDispatchEvent("hidden-sticky","sticky-detached")}},{key:"_sliderSelectedCar",value:function _sliderSelectedCar(newAmount){this.set("oldAmountSlider",this.sliderSelectedCar);this.set("sliderSelectedCar",newAmount)}/**
   * @desc generate sliderSelectedCar by offerDetails
   * @param details
   * @private
   */},{key:"_sliderPropertyCarGenerate",value:function _sliderPropertyCarGenerate(details){if(details&&details.allowedTerms){var snaps=details.allowedTerms.sort(function(itemA,itemB){return itemA.number-itemB.number}).map(function(item){return item.number}),suggestedTerm=details.suggestedTerm?details.suggestedTerm.number:details.allowedTerms[details.allowedTerms.length-1],indexSuggestedTerm=snaps.indexOf(suggestedTerm),stepSnaps=snaps[1]-snaps[0],data={sliderDescription:"glomo-loan-offer-slider-description-car",min:snaps[0],max:snaps[snaps.length-1],step:stepSnaps,snaps:snaps,unit:"".concat(this.t("offer-car-loan-slider-unit")),sliderValue:snaps[indexSuggestedTerm]};this.set("sliderPropertyCar",data);this.set("sliderSelectedCar",data.sliderValue)}}/**
   * @desc generate keyInfoCar object from offerDetail.rates
   * @param rates
   * @returns {[]}
   * @private
   */},{key:"_keyInfoCarGenerate",value:function _keyInfoCarGenerate(rates,fees){var _this2=this,dataList=[],listRates=[],listFees=[];if(rates&&rates.length){var list=rates.map(function(item){var rateType=item.rateType.id;switch(rateType){case"CAT":return{key:"offer-car-loan-cat-iva",value:"".concat(item.unit.percentage.toFixed(1),"%"),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:item.rateType.id,eventModal:"event-modal-info-".concat(item.rateType.id),classInfoValue:"values-bold"};case"TASA_MENSUAL":_this2.set("rateValue",item.unit.percentage);return{key:"glomo-loan-offer-custom-element-taxes-interest",value:"".concat(item.unit.percentage.toFixed(2),"%"),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:item.rateType.id,eventModal:"event-modal-info-".concat(item.rateType.id),classInfoValue:"values-bold"};default:return!1;}});listRates=list.filter(Boolean)}if(fees&&fees.itemizeFees.length){var _list=fees.itemizeFees.map(function(item){var listObject={key:"offer-car-loan-title-cost-open",value:"".concat(item.percentage.toFixed(2),"%"),showCollapsedView:!0,showOpenView:!0,keyIcon:"coronita:help",id:item.feeType.id,eventModal:"event-modal-info-".concat(item.feeType.id)};return listObject});listFees=_list.filter(Boolean)}else{listFees=this.keyInfoCar[0].keyValues}listRates.unshift(listFees[0]);dataList.push({title:"glomo-loan-offer-principal-list-costs",keyValues:listRates});this.set("keyInfoCar",dataList)}/**
   * @desc generate stickyDataCar from some response!!!!!
   * @param details
   * @returns {{monthlyPayment: number, secondPaymentText: string, hasStickyAmount: boolean, paymentText: string}}
   * @private
   */},{key:"_stickyDataCarGenerate",value:function _stickyDataCarGenerate(detail){var _this3=this;if(detail&&detail.loanBreakDown){detail.loanBreakDown.find(function(item){if("INSTALLMENT"===item.id&&item.amount){_this3.set("stickyDataCar",{monthlyPayment:item.amount,currency:item.currency,hasStickyAmount:!0,paymentText:"offer-car-loan-sticky-amount-top",secondPaymentText:"glomo-loan-offer-sticky-amount-bottom-mortgage"})}})}}/**
   * @desc return customElement from some response
   * @param details
   * @private
   */},{key:"_customMessageCarGenerate",value:function _customMessageCarGenerate(rates,period){var _this4=this;if(rates&&rates.length){var dateStart="";if(!period){dateStart=this.dateValidation}else{this.set("dateValidation",period.startDate);dateStart=this.dateValidation}rates.find(function(item){if("CAT"===item.rateType.id){var catDecimals=item.unit.percentage.toFixed(1);_this4.set("customMessageCar",{message:"<div><strong>*".concat(item.rateType.id," ").concat(catDecimals,"%</strong>\n            ").concat(_this4.t("offer-car-loan-custom-label")," ").concat(_this4._getTimeFormat(item.calculationDate),".\n            ").concat(_this4.t("offer-car-loan-custom-validity")," ").concat(_this4._getTimeFormat(dateStart),".\n            </div><br><span>").concat(_this4.t("offer-car-loan-custom-info"),"</span>"),button:!0})}})}}/**@desc initialize car offer detail start
   * @param payload
   */},{key:"init",value:function init(){if(this.offerDataCar&&this.offerIdCar){this.lastActiveStep=null;this.canExecute=!1;this.hasFinished=!1;this._lastResponse=null;this.currentStep=1;this._offerRequestDetail();this._genericDispatchEvent("hidden-sticky","")}}/**
   * gets a response error from loans api
   * @param event
   */},{key:"processError",value:function processError(event){this._genericDispatchEvent("hide-spinner");this._errorDetailCar(event.detail)}/**
   * @desc show error modal when offer api fail
   * @type {Object}
   */},{key:"_errorDetailCar",value:function _errorDetailCar(errorMessage){var modalPayload={code:"offer-error",selectedConfig:{className:"header--white-navy-blue error",openMaximized:!0,iconOnlyFullHeight:!0,title:"glomo-loan-offer-title-main-car",acceptBtLabel:"error-button-go-out-text",heroImage:"./images/general_error.svg",template:{type:"iconMessage",values:{type:"error",message:"cells-product-summary-deposit-error"}}}};this._genericDispatchEvent("car-offer-error",modalPayload)}/**
   * generate simulator by user interaction
   * @param radioSelected
   * @param sliderSelectedCar
   * @param amountSelectedCar
   * @private
   */},{key:"_generateRequestSimulator",value:function _generateRequestSimulator(){var requestBody={initialAmount:{amount:this.amountSelectedCar,currency:this.currencyLocal},terms:{number:this.sliderSelectedCar,frequency:"MONTHLY"},product:{subproduct:{id:this.radioSelected.id}}},apiLoans=this.shadowRoot.querySelector("cells-dm-global-apis-loans");this.set("waitSimulation",!0);this._genericDispatchEvent("show-spinner");apiLoans.postOfferDetailQuotationsSimulate(requestBody);if(this.oldAmount!==this.amountSelectedCar){this.set("oldAmount",this.amountSelectedCar)}else{this._genericDispatchEvent("hide-spinner")}this._genericDispatchEvent("hidden-sticky","")}/**
   * response payload from quotations simulate loans api
   * @param payload
   */},{key:"processSimulate",value:function processSimulate(payload){if(payload&&payload.detail){var monto=payload.detail.loanBreakDown;if(monto&&monto.length){this.set("resultAmount",monto[1].amount)}this.set("waitSimulation",!1);var terms=+(payload.detail.terms.number+"").substring(1);if(terms===this.sliderSelectedCar){var simulate=payload.detail;this._keyInfoCarGenerate(simulate.rates,simulate.fees);this._stickyDataCarGenerate(simulate);this._customMessageCarGenerate(simulate.rates,simulate.period);this._sliderPropertyCarGenerate(simulate);this._updatedAmountDataSimulate(simulate.loanBreakDown,simulate.minimumAmount);this._genericDispatchEvent("hide-spinner")}else{this.set("sliderSelectedCar",terms)}}}/**
   * updated amount data property from simulate response loans api
   * @param loanBreakDown
   * @private
   */},{key:"_updatedAmountDataSimulate",value:function _updatedAmountDataSimulate(loanBreakDown,minimumAmount){var _this5=this;if(loanBreakDown&&loanBreakDown.length){loanBreakDown.find(function(item){if("GROSS_AMOUNT"===item.id&&item.amount!==_this5.amountSelectedCar){_this5.set("amountDataCar",{amountMin:minimumAmount.amount,amountDefault:_this5._truncatedDecimals(item.amount),amount:_this5._truncatedDecimals(item.amount),amountMax:_this5._truncatedDecimals(item.amount),iconSize:"icon-size-26",iconCode:"coronita:close",label:"glomo-loan-offer-input-label-mortgage"});_this5.set("oldAmount",_this5.amountSelectedCar)}})}}},{key:"errorSimulate",value:function errorSimulate(event){this._genericDispatchEvent("hide-spinner");this._errorPageResponse(event.detail);this.set("waitSimulation",!1)}/**
   * @desc return the date with format
   * @param time
   * @private
   */},{key:"_getTimeFormat",value:function _getTimeFormat(time){return moment(time).format("D [de] MMMM [de] YYYY")}/**
   * @desc function to display text in different manners
   * @param (payload)
   * @private
   */},{key:"_informativeModals",value:function _informativeModals(payload){var textModal={},TEXT_BUTTON="offer-car-loan-button-modal",EVENT_MODAL_INFO="info-modals-event";switch(payload){case"event-modal-info-COMISION APERTURA":textModal={titleHeader:"offer-car-loan-title-cost-open",typeIcon:"coronita:help",text:"".concat(this.t("offer-car-loan-text-cost-open-pay"),"<br><br> ").concat(this.t("offer-car-loan-text-cost-open-monthly")),buttonAcepted:TEXT_BUTTON};this._customModalsEvent(EVENT_MODAL_INFO,textModal);break;case"event-modal-info-CAT":textModal={titleHeader:"offer-car-loan-title-cat",typeIcon:"coronita:help",text:"".concat(this.t("offer-car-loan-text-cat-annual"),"<br><br> ").concat(this.t("offer-car-loan-text-cat-indicator")),buttonAcepted:TEXT_BUTTON};this._customModalsEvent(EVENT_MODAL_INFO,textModal);break;case"event-modal-info-TASA_MENSUAL":textModal={titleHeader:"offer-car-loan-title-text-rate",typeIcon:"coronita:help",text:"".concat(this.t("offer-car-loan-text-rate-fixed"),"<br><br> ").concat(this.t("offer-car-loan-text-rate-variant-payments")),buttonAcepted:TEXT_BUTTON};this._customModalsEvent(EVENT_MODAL_INFO,textModal);break;case"terms-conditions-modals":textModal={classList:"ul-li--text-left",classListModal:"car-loan-header-list",titleHeader:"offer-car-loan-title-header-terms",typeIcon:"coronita:info",listText:"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-credit-approval"),"</p></li></ul>")+"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-sign-contract"),"</p></li></ul>")+"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-credit-situation"),"</p></li></ul>")+"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-modifications"),"</p></li></ul>")+"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-generate-certificates"),"</p></li></ul>")+"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-validate-certificate"),"</p></li></ul>")+"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-both-safe"),"</p></li></ul>")+"<ul><li><p>".concat(this.t("offer-car-loan-terms-conditions-text-warranty"),"</p></li></ul>"),text:"<br>".concat(this.t("offer-car-loan-terms-conditions-text-know-terms")),buttonAcepted:TEXT_BUTTON};this._customModalsEvent("terms-modals",textModal);break;case"credit-history-modal":textModal={classListModal:"car-loan-header-list",titleHeader:"offer-car-loan-credit-history-title-header",typeIcon:"coronita:info",principalText:"".concat(this.t("offer-car-loan-credit-history-subtitle")),text:"".concat(this.t("offer-car-loan-credit-history-authorization"),"<br><br>")+"".concat(this.t("offer-car-loan-credit-history-information")),buttonAcepted:TEXT_BUTTON};this._customModalsEvent("terms-modals",textModal);break;default:break;}}/**
  * @desc creation of the modal under its components
  * @param (object)
  * @private
  */},{key:"_customModalsEvent",value:function _customModalsEvent(name,data){var detail={code:"HELP_INFO",selectedConfig:{hideCloseIcon:!1,className:"info car-loan-header ".concat(data.classListModal),title:this.t(data.titleHeader),heroImage:data.heroImage,openMaximized:!0,acceptBtLabel:this.t(data.buttonAcepted),onAcceptEvent:"",cancelBtLabel:this.t(data.cancelar),onCancelEvent:"",template:{type:"paragraphs",values:[{title:this.t(data.subTitle),class:"spacing"},{icon:this.t(data.typeIcon)},{text:this.t(data.listText),class:data.classList},{text:this.t(data.principalText),class:"principal-text"},{text:this.t(data.text),class:data.classText}]}}};this._genericDispatchEvent(name,detail)}/**
   * @desc function that gives name to the shot of terms and conditions step
   * @private
   */},{key:"_modalTermsConditions",value:function _modalTermsConditions(){this._informativeModals("terms-conditions-modals")}/**
   * @desc function that gives name to the credit bureau shot step
   * @private
   */},{key:"_modalCreditHistory",value:function _modalCreditHistory(){this._informativeModals("credit-history-modal")}/**
   * generate page error from any functional error
   * @param errorResponse
   * @private
   */},{key:"_errorPageResponse",value:function _errorPageResponse(){var errorResponse=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},isBlockingError=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!1,detail={icon:"glomo:general-error",headerTitleText:"offer-car-loan-header-title",isBlockingError:isBlockingError,failureText:errorResponse&&errorResponse.errorCode&&errorResponse.errorMessage?"".concat(errorResponse.errorCode," ").concat(errorResponse.errorMessage):this.t("cells-product-summary-deposit-error"),primaryButtonText:"offer-car-loan-button-retry"};this._genericDispatchEvent("error-response-car-loan",detail)}/**
   * generate dispatchEvent
   * @param eventName
   * @param detail
   * @param bubbles
   * @param composed
   * @private
   */},{key:"_genericDispatchEvent",value:function _genericDispatchEvent(){var eventName=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",detail=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0,bubbles=2<arguments.length&&arguments[2]!==void 0?arguments[2]:!0,composed=3<arguments.length&&arguments[3]!==void 0?arguments[3]:!0;if(eventName){this.dispatchEvent(new CustomEvent(eventName,{bubbles:bubbles,composed:composed,detail:detail}))}}/**
   * @desc clean up properties when the page is out
   * @private
   */},{key:"_cleanUpPage",value:function _cleanUpPage(){this.set("autoData",{});this.set("radioSelected",{});this.set("amountDataCar",{});this.set("sliderPropertyCar",{});this.set("keyInfoCar",[]);this.set("stickyDataCar",{});this.set("customMessageCar","");this.set("amountSelectedCar",0);this.set("sliderSelectedCar",0);this.resetPage();this.resetChecksCar();this.set("resulAmount",0);this.initSteps();this.onAnyStepCollapsedChanged()}/**
   * @desc this function send a event when this flow is closed
   * @private
   */},{key:"_closingFlow",value:function _closingFlow(){this._genericDispatchEvent("car-loan-certificated-closed");this._cleanUpPage()}/**
   * @desc Function to register the steps anchenage
   * @private
   */},{key:"goNextStep",value:function goNextStep(currentStepKey){this.currentStep=currentStepKey;this.setSteps();this.onAnyStepCollapsedChanged();var payload={currency:this.currency,amount:this.amountSelected,rate:this.rateValue,paymentAmount:this.stickyDataCar.monthlyPayment,typeLoan:this.t(this.radioSelected.name),laps:this.sliderSelected};if(1===currentStepKey){this.loadTerms(payload)}if(2===currentStepKey){this.loadFinalStep(payload)}}/**
   * @desc set propertie to show header of collapsed
   * @param detail
   */},{key:"_showHeader",value:function _showHeader(){this._genericDispatchEvent("show-header",{hideHeader:!1})}/**
   * @desc  set propertie to show hide of collapsed
   * @param detail
   */},{key:"_hideHeader",value:function _hideHeader(){this._genericDispatchEvent("hide-header",{hideHeader:!0})}/**
   * @desc function to collapse and change the header color
   */},{key:"_headerColorChange",value:function _headerColorChange(){this._hideHeader();this.set("headerClass","mortgage-certificated")}/**
   * @desc open modal to confirm before exit
   */},{key:"openModalConfirmCar",value:function openModalConfirmCar(){var modalAlert={code:"CAR-LOAN",selectedConfig:{className:"alert-modal car-loan-confirm",openMaximized:!1,iconOnlyFullHeight:!0,acceptBtLabel:"glomo-oc-loan-error-button-text",cancelBtLabel:"glomo-oc-loan-error-button2-text",template:{type:"iconMessage",values:{icon:"coronita:alert",type:"error",message:"".concat(this.t("glomo-oc-loan-error-text")," <br/> ").concat(this.t("glomo-oc-loan-error2-text"))}}}};this._genericDispatchEvent("open-modal-exit",modalAlert)}/**
   * @desc Reset all steps when the page becomes inactive
   */},{key:"resetPage",value:function resetPage(pageStatus){this._hideHeader();if(pageStatus&&!pageStatus.value){this.resetSteps()}}/**
   * RESET CHECKS
   */},{key:"resetChecksCar",value:function resetChecksCar(){var clean=[{checked:!1,label:"offer-car-loan-terms-accepted"},{checked:!1,label:"offer-car-loan-terms-accepted-bureau"}];this._genericDispatchEvent("reset-checks",clean)}/**
   * @desc function to truncate the decimals
   */},{key:"_truncatedDecimals",value:function _truncatedDecimals(amount){return Math.trunc(amount)}/** @desc function to tag when load terms and conditions */},{key:"loadTerms",value:function loadTerms(payload){this._genericDispatchEvent("register-check-terms",payload)}/** @desc function to tag when load cta-container, final step */},{key:"loadFinalStep",value:function loadFinalStep(payload){this._genericDispatchEvent("register-final-step",payload)}/**
   * @desc get success response from loan DM component
   * @param response
   */},{key:"successResponseProposals",value:function successResponseProposals(response){if(response){this._genericDispatchEvent("hide-spinner");this.successResult(response)}}/** @desc get error response from loan DM component */},{key:"errorResponseProposals",value:function errorResponseProposals(event){this._genericDispatchEvent("hide-spinner");this._errorPageResponse(event.detail,!0)}},{key:"successResult",value:function successResult(response){if(response&&response.id&&"APPROVED"===response.status.id){var timeToday=new Date,segundos="0"+timeToday.getSeconds(),time="".concat(timeToday.getHours(),":").concat(timeToday.getMinutes(),":").concat(segundos.slice(-2)),objectResult=response,certificate={title:"offer-car-loan-succes-title",date:"".concat(objectResult.creationDate,"T").concat(time),amountLabel:"offer-car-loan-amount-label",chargeAmount:{amount:"".concat(this.resultAmount),currency:"$",class:"amount-huge-decimals",decimalsHidden:!0},headerListInfo:[{key:"glomo-step-loan-offer-monthly-payment",value:"$ ".concat(this.stickyDataCar.monthlyPayment.toLocaleString("es-US"),".00")},{key:"offer-car-loan-title-cost-open",value:"".concat(this.keyInfoCar[0].keyValues[0].value),class:"spacing"},{key:"glomo-loan-offer-taxes-text-1-mortgage",value:"".concat(this.keyInfoCar[0].keyValues[1].value),class:"spacing"},{key:"glomo-loan-offer-custom-element-taxes-interest",value:"".concat(this.keyInfoCar[0].keyValues[2].value),class:"bold spacing mortgage-success-value"}],headerMessage:{icon:{name:"coronita:info",size:16},message:"offer-car-loan-success-message-header"},origin:{avatar:{src:"./images/mortgage-success.svg",type:"receipt"},product:{name:" "}},topInfo:[{key:"offer-car-loan-term",value:"".concat(this.get("sliderSelectedCar")," ").concat(this.t("offer-car-loan-terms-months")),class:"bold spacing mortgage-spacing-top"},{key:"offer-car-loan-type-car",value:this.get("radioSelected.name"),class:"bold spacing lg"},{key:"offer-mortgage-certificated-folio",value:"".concat(objectResult.id),class:"bold"}],message:{type:"info",text:"".concat(this.t("offer-car-loan-message-text-success-download"),"<br><br> ")+"".concat(this.t("offer-car-loan-message-text-success-call"),"<br><br> ").concat(this.t("offer-car-loan-message-text-success-valid")),icon:"coronita:info"},operations:[{label:"offer-car-loan-download",id:"share",icon:"coronita:download",share:!1,height:1520,download:!0}],buttons:{primary:{text:"offer-car-loan-button-exit",action:"go-to-next"},secondary:{hidden:!0}}};this._genericDispatchEvent("show-certificate-car-loan-success",certificate)}else{this.openModalNotApproved()}}/**
   * generate proposals object
   */},{key:"proposalsGenerate",value:function proposalsGenerate(){this._genericDispatchEvent("show-spinner");var truncateAmount=this._truncatedDecimals(this.resultAmount),proposalsObject={id:"0",requestedAmount:{amount:truncateAmount,currency:this.currencyLocal},downPayment:{amount:0,currency:"MXN"},loanType:{id:"CONSUME_CAR"},participants:[{id:this.offerIdCar,participantType:{id:"HOLDER"}}],installmentPlan:{terms:{frequency:"MONTHLY",number:this.sliderSelectedCar}},product:{id:this.radioSelected.oficialName}},payload={currency:this.currencyLocal,amount:this.amountSelectedCar,rate:this.rateValue,paymentAmount:this.stickyDataCar.monthlyPayment,typeLoan:this.t(this.radioSelected.name),laps:this.sliderSelectedCar};this._genericDispatchEvent("tag-load-softoken",payload);this._genericDispatchEvent("proposal-generate",proposalsObject)}},{key:"openModalNotApproved",value:function openModalNotApproved(){var modalAlert={code:"car-loan-proposal",selectedConfig:{className:"full-height-error car-not-approved",openMaximized:!0,heroImage:"./images/ccl_document_fetch_error.svg",title:"offer-car-loan-title-certificated",acceptBtLabel:"offer-car-loan-button-modal",template:{type:"paragraphs",values:[{title:"offer-car-loan-not-approved-title",class:"simple-title"},{text:"offer-car-loan-not-approved-authorize",class:"simple-text"},{text:"offer-car-loan-not-approved-visit-us",class:"simple-text"}]}}};this._genericDispatchEvent("open-modal-exit-not-approved",modalAlert)}}],[{key:"is",get:function get(){return"glomo-opx-car-loan-dm"}},{key:"properties",get:function get(){return{/** @desc Principal Object */offerDataCar:{type:Array,value:function value(){return[]}},/** @desc offerId from offer in dashboard */offerIdCar:{type:String,value:"",computed:"_offerIdCarComputed(offerDataCar)"},/** @desc host from app config */hostOfferCar:{type:String,value:""},/** @desc currency local */currencyLocal:{type:String,value:"MXN"},/** loans api version from glomo app **/loansVersion:{type:Number,value:0},/** require token from glomo app **/requiredToken:{type:String,value:"tsec"},/** @desc allowedSubproducts from offerDetail */autoData:{type:Object,value:function value(){return{}},notify:!0},/**@des selected type of car */radioSelected:{type:Object,value:function value(){return{}},observer:"_radioSelectedObserver",notify:!0},/** @desc min, max and suggested amount from offerDetail */amountDataCar:{type:Object,value:function value(){return{}},notify:!0},/** @desc slider items */sliderPropertyCar:{type:Object,value:function value(){return{}},notify:!0},/** @desc list additional info */keyInfoCar:{type:Array,value:function value(){return[]},notify:!0},/** @desc sticky object from offerData */stickyDataCar:{type:Object,value:function value(){return{}},notify:!0},/** @desc customElement rates */customMessageCar:{type:Object,value:"",notify:!0},/** @desc amountSelectedCar select by user to simulate */amountSelectedCar:{type:Number,value:0,notify:!0},/** @desc sliderSelectedCar by user to simulate */sliderSelectedCar:{type:Number,value:0,notify:!0,observer:"_sliderSelectedCarObserver"},/** @desc object for the result of success */certificateBody:{type:Object,value:function value(){return{}}},/** @desc class for app header */headerClass:{type:String,value:"mortgage-certificated",notify:!0},/** @desc Property to save rate anual */rateValue:{type:Number,value:0},/**@des termMonth */termMonth:{type:Number,value:0},/** @desc user email **/userEmail:{type:String,value:""},/** save enable status simulate  */waitSimulation:{type:Boolean,value:!1},/**@desc dateValidation */dateValidation:{type:String,value:""},/** global server config retived from native */globalServerConfig:{type:Object},/** @desc property to save the amountSelected  */resultAmount:{type:Number,value:0},/** NUEVAS PROPIEDADES */ /** @desc  */oldAmount:{type:Number,value:0,notify:!0},/** @desc  */oldAmountSlider:{type:Number,value:0,notify:!0}}}}]);return GlomoOpxCarLoanDm}(Polymer.mixinBehaviors([CellsBehaviors.StepManagerBehavior,CellsBehaviors.i18nBehavior],Polymer.Element));customElements.define(GlomoOpxCarLoanDm.is,GlomoOpxCarLoanDm);</script></dom-module></div></body></html>